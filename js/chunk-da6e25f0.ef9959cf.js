(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-da6e25f0","chunk-6dc74a21","chunk-184baf46","chunk-c3390372","chunk-3c4fabde"],{"0104":function(e,t,i){"use strict";i("b62b")},"090c":function(e,t,i){"use strict";i("999b")},"0ac9":function(e,t,i){"use strict";i("b801")},"0db8":function(e,t,i){},"0fb2":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("article-manager",{attrs:{"page-title":e.pageTitle,"new-article-text":e.newArticleText,"alone-page":""}})],1)},n=[],s=i("b0d9"),o={name:"alonePageManager",components:{ArticleManager:s["default"]},data:function(){return{pageTitle:"管理獨立頁面",newArticleText:"新增頁面"}},computed:{},created:function(){},mounted:function(){},watch:{},methods:{}},r=o,l=(i("bb40"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"5b599770",null);t["default"]=c.exports},1:function(e,t){},1e3:function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return o}));i("5df3"),i("f400"),i("ac6a");var a=i("33f9"),n={simText:["vue","asp","jsp","TXT","xml","xsl","iml","m","bas","prg","cmd","sass","sas","php","lst","key","pem","log","cmake","db","gradle","bat","","conf","dart","plist"],compressedFile:["zip","tar","jar","tar.gz","tgz","tar.bz2"]};a["languages"].getLanguages().forEach((function(e){e.extensions.forEach((function(e){n.simText.push(e.substring(1,e.length))}))}));var s=["txt"],o=new Map;o.set("php","file-php"),o.set("js","file-js"),o.set("vue","file-vue"),o.set("xml","file-xml"),o.set("dart","file-dart"),o.set("html","file-html"),o.set("md","file-md"),o.set("txt","file-txt"),o.set("TXT","file-txt"),o.set("css","file-css"),o.set("scss","file-css"),o.set("java","file-java"),o.set("go","file-go"),o.set("DS_Store","file-Ds-store"),o.set("jar","file-jar"),o.set("properties","file-properties"),o.set("conf","file-conf"),o.set("factories","file-factories"),o.set("class","file-class"),o.set("excel","file-excel"),o.set("xls","file-excel"),o.set("xlsx","file-excel"),o.set("gitignore","file-gitignore"),o.set("ncm","file-ncm"),o.set("dmg","file-dmg"),o.set("pkg","file-pkg"),o.set("mpkg","file-pkg"),o.set("exe","file-exe"),o.set("word","file-word"),o.set("doc","file-word"),o.set("docx","file-word"),o.set("docxf","file-docxf"),o.set("ppt","file-ppt"),o.set("pptx","file-ppt"),o.set("drawio","file-drawio"),o.set("csv","file-csv"),o.set("pdf","file-pdf"),o.set("mind","file-mind"),o.set("zip","zip"),o.set("rar","zip"),o.set("iml","file-idea"),o.set("key","file-key"),o.set("pem","file-pem"),o.set("gz","file-gzip"),o.set("json","file-json"),o.set("tar","file-tar"),o.set("sh","file-shell"),o.set("log","file-log"),o.set("py","file-python"),o.set("cpp","file-cpp"),o.set("h","file-h"),o.set("xsl","file-xsl"),o.set("cmake","file-cmake"),o.set("db","file-db"),o.set("sql","file-db"),o.set("gradle","file-gradle"),o.set("bat","file-bat"),o.set("swift","file-swift"),o.set("yml","file-yml"),o.set("plist","file-plist"),o.set("iso","file-iso")},1044:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{attrs:{title:"分享:"+e.shareFileName,visible:e.shareDialog,center:""},on:{"update:visible":function(t){e.shareDialog=t}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.generateShareLinkLoading,expression:"generateShareLinkLoading"}]},[i("el-input",{attrs:{readonly:"readonly"},model:{value:e.shareLink,callback:function(t){e.shareLink=t},expression:"shareLink"}}),e._v(" "),i("div",{staticClass:"dialog-footer share-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"tag-share-link",attrs:{type:"primary","data-clipboard-text":e.shareLink},on:{click:e.copyShareLink}},[e._v("複製鏈接")])],1)],1)]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.fileList.length>0,expression:"fileList.length > 0"}],style:{width:"100%",height:e.clientHeight+"px"}},[i("pl-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"fileListTable",staticStyle:{width:"100%",margin:"20px 0 0 0"},attrs:{"max-height":e.clientHeight,"default-sort":e.sortable,"highlight-current-row":!1,"empty-text":"無文件","use-virtual":!1,"row-height":50,border:!1,"excess-rows":3,"cell-style":e.rowRed,"height-change":!1,"row-class-name":e.tableRowClassName,"element-loading-text":"文件加載中","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{"selection-change":e.handleSelectionChange,"cell-click":e.cellClick,"cell-mouse-enter":e.cellMouseEnter,"cell-mouse-leave":e.cellMouseLeave,"sort-change":e.sortChange,"table-body-scroll":e.tableBodyScroll}},[e._l(e.tableHead,(function(t,a){return[0===a?i("pl-table-column",{key:a,attrs:{index:a,type:"selection","min-width":"50"}}):e._e(),e._v(" "),1===a?i("pl-table-column",{key:a,attrs:{prop:t.name,label:t.label,index:a,width:"60","header-align":"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("icon-file",{attrs:{item:t.row,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl}})]}}],null,!0)},[i("template",{slot:"header"},[""!==t.label?i("div",[i("span",{staticClass:"header-font"},[e._v(e._s(t.label))])]):e._e()])],2):e._e(),e._v(" "),2===a?i("pl-table-column",{key:a,attrs:{"show-overflow-tooltip":!0,"max-width":"200",index:a,prop:t.name,label:t.label,"sort-orders":["ascending","descending"],sortable:t.sortable,"header-align":"left"},on:{click:function(t){return t.stopPropagation(),e.fileClick(e.scope.row)}},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"table-file-name"},[e._v(e._s(t.row.fileName))])]}}],null,!0)},[i("template",{slot:"header"},[""===t.label?i("div",{staticClass:"cancel-share-header"},[i("span",{staticClass:"header-font"},[e._v(e._s(e.sumFileAndFolder))]),i("el-button",{attrs:{icon:"el-icon-my-export",size:"small"},on:{click:function(t){return e.cancelShare(!1)}}},[e._v("取消分享")])],1):e._e()])],2):e._e(),e._v(" "),4===a?i("pl-table-column",{key:a,attrs:{width:"50",index:a,align:"center","header-align":"center","tooltip-effect":"dark"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.cellMouseIndex?i("svg-icon",{staticClass:"button-class",attrs:{title:"分享","icon-class":"cancel-share"},on:{click:function(i){return e.cancelShare(t.row)}}}):e._e()]}}],null,!0)}):e._e(),e._v(" "),5===a?i("pl-table-column",{key:a,attrs:{width:"250",prop:t.name,index:a,label:t.label,"sort-orders":["ascending","descending"],sortable:t.sortable,"show-overflow-tooltip":!0,align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createDate))])]}}],null,!0)}):e._e(),e._v(" "),6===a?i("pl-table-column",{key:a,attrs:{width:"250",prop:t.name,label:t.label,index:a,"sort-orders":["ascending","descending"],sortable:t.sortable,"show-overflow-tooltip":!0,align:"left","header-align":"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.expireDate?t.row.expireDate:"永久有效"))])]}}],null,!0)}):e._e()]}))],2)],1),e._v(" "),e.fileList.length<1&&!e.tableLoading?i("empty-file",{attrs:{emptyStatus:"還沒有分享歷史哦~",emptyShare:!0}}):e._e()],1)},n=[],s=i("2d63"),o=(i("ac6a"),i("c41c")),r=i("71e9"),l=i("0dcf"),c=(i("7f29"),i("5cfc")),d=i("b311"),u=i.n(d),h={components:{ShowFile:o["default"],EmptyFile:r["a"],IconFile:l["a"]},props:{emptyStatus:{type:String,default:"空空如也~"},singleFileType:{type:String,default:""},showNavigation:{type:Boolean,default:!0},queryFileType:{type:String,default:null},defaultGrid:{type:Boolean,default:!0},orderCustom:{type:Boolean,default:!0},sortable:{type:Object,default:function(){return{prop:"createDate",order:"descending"}}},queryCondition:{type:Object,default:function(){return{isFolder:null}}}},data:function(){return{imageUrl:"/api/view/thumbnail?jmal-token="+this.$store.state.user.token+"&id=",audioCoverUrl:"/api/view/cover?jmal-token="+this.$store.state.user.token+"&id=",fileMenuActive:"",path:this.$route.query.path,showNewFolder:!1,isShowNewFolder:!1,listModeSearch:!1,listModeSearchOpenDir:!1,newFolderName:"新建文件夾",renameFileName:"",searchFileName:"",pathList:[{folder:"",index:0},{folder:"+",index:1}],fileList:[],pagination:{pageIndex:1,pageSize:20,total:0,pageSizes:[10,20,30,40,50]},indexList:[],clientHeight:500,tableHead:[{name:"",label:"",index:0},{name:"icon",label:"",index:1},{name:"fileName",label:"分享文件",sortable:"custom",index:2},{name:"",label:"",index:3},{name:"",label:"",more:!0,index:4},{name:"createDate",label:"時間",sortable:"custom",index:5},{name:"expireDate",label:"過期時間",sortable:"custom",index:6}],rowContextData:{},selectRowData:[],tableLoading:!1,finished:!1,cellMouseIndex:-1,editingIndex:-1,shareDialog:!1,shareLink:"",shareFileName:"",generateShareLinkLoading:!0,sumFileAndFolder:""}},mounted:function(){},methods:{beforeLoadData:function(e){e?this.pagination.pageIndex++:this.pagination.pageIndex=1,this.tableLoading=!0,this.finished=!1},getFileList:function(e){var t=this;this.beforeLoadData(e),c["a"].sharelist({userId:this.$store.state.user.userId,sortableProp:this.sortable.prop,order:this.sortable.order,pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(i){e?i.data.forEach((function(e,i){e["index"]=(t.pagination.pageIndex-1)*t.pagination.pageSize+i,t.fileList.push(e)})):(t.fileList=i.data,t.fileList.map((function(e,t){e.index=t})),t.$refs.fileListTable.reloadData(t.fileList)),t.fileList.length>=i.count&&(t.finished=!0),t.tableLoading=!1,t.clientHeight=document.documentElement.clientHeight-80,t.pagination["total"]=i.count,t.$nextTick((function(){t.tableLoading=!1}))})).catch((function(e){}))},tableBodyScroll:function(e,t){this.fileListScrollTop=t.target.scrollTop;var i=t.target.scrollHeight-t.target.clientHeight-t.target.scrollTop;i<200&&(this.finished||this.getFileList(!0))},sortChange:function(e){this.sortable.prop=e.prop,this.sortable.order=e.order,this.pagination.pageIndex=1,this.getFileList()},handleSelectionChange:function(e){var t=this;this.selectRowData=e;this.indexList=[];var i,a=Object(s["a"])(e);try{for(a.s();!(i=a.n()).done;){var n=i.value;n.size,this.indexList.push(n.index)}}catch(d){a.e(d)}finally{a.f()}e.forEach((function(e){t.$refs.fileListTable.toggleRowSelection(e,!0)}));var o=this.tableHead[1],r=this.tableHead[2],l=this.tableHead[5],c=this.tableHead[6];this.selectRowData.length>0?(this.sumFileAndFolder=this.getShowSumFileAndFolder(e),o.label="已選中",r.label="",r.sortable=!1,l.label="",l.sortable=!1,c.label="",c.sortable=!1):(o.label="",r.label="分享文件",r.sortable="custom",l.label="時間",l.sortable="custom",c.label="過期時間",c.sortable="custom")},getShowSumFileAndFolder:function(e){var t=0,i=0;e.forEach((function(e){e.isFolder?t+=1:i+=1}));var a="";t>0&&(a=t+"個文件夾");var n="";return i>0&&(n=i+"個文件"),a+" "+n},rowRed:function(e){e.row,e.column;var t=e.rowIndex,i=e.columnIndex;if(this.indexList.length<1&&2===i&&this.cellMouseIndex===t)return{cursor:"pointer",color:"#19ACF9"};for(var a=0;a<this.indexList.length;a++)if(t===this.indexList[a])return{backgroundColor:"#EBEEF5",color:"#b7b5b6",cursor:"default"}},tableRowClassName:function(e){var t=e.row,i=e.rowIndex;t.index=i},preliminaryRowData:function(e){e&&(this.selectRowData[0]=e,this.rowContextData=e);var t=this.selectRowData[0].isFavorite;this.highlightFavorite(t,!1)},cellMouseEnter:function(e){-1===this.editingIndex&&this.indexList.length<1&&(this.cellMouseIndex=e.index)},cellMouseLeave:function(){this.cellMouseIndex=-1},cellClick:function(e,t){if(clearTimeout(this.Loop),-1===this.editingIndex){var i=t.index;0===i&&this.$refs.fileListTable.toggleRowSelection(e),2===i&&this.indexList.length<1&&e.index!==this.editingIndex&&(this.fileClick(e),this.editingIndex=-1),this.indexList.length>0&&i>0&&this.$refs.fileListTable.toggleRowSelection(e)}},cancelShare:function(e){var t=this,i=[];e?i.push(e.id):this.selectRowData.forEach((function(e){i.push(e.id)})),c["a"].cancelShareLink({userId:this.$store.state.user.userId,shareId:i}).then((function(){1===i.length?t.fileList.splice(e.index,1):t.getFileList()}))},fileClick:function(e){this.shareDialog=!0,this.shareFileName=e.fileName,this.shareLink=window.location.origin+"/s?s="+e.id,this.generateShareLinkLoading=!1},copyShareLink:function(){var e=this,t=new u.a(".tag-share-link");t.on("success",(function(i){e.$message({message:"複製成功",type:"success",duration:1e3}),e.shareDialog=!1,t.destroy()})),t.on("error",(function(i){e.$message({message:"該瀏覽器不支持自動複製",type:"warning",duration:1e3}),t.destroy()}))}}},f=h,p=(i("5194"),i("2877")),m=Object(p["a"])(f,a,n,!1,null,"62bb6a89",null);t["default"]=m.exports},1069:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{staticClass:"dialog-cm",attrs:{width:"500px",title:e.dialogTitle,"close-on-click-modal":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium",model:e.form,"label-position":"left",rules:e.rules,"label-width":"95px"}},[i("el-form-item",{attrs:{label:"標籤名稱:",prop:"name"}},[i("el-input",{attrs:{placeholder:"請輸入標籤名稱"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"標籤縮略名:",prop:"slug"}},[i("el-input",{attrs:{placeholder:"請輸入標籤縮略名"},model:{value:e.form.slug,callback:function(t){e.$set(e.form,"slug",t)},expression:"form.slug"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"標籤背景:",prop:"categoryBackground"}},[i("upload-image-input",{model:{value:e.form.tagBackground,callback:function(t){e.$set(e.form,"tagBackground",t)},expression:"form.tagBackground"}}),e._v(" "),i("div",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在該標籤頁面顯示一個背景大圖.")])],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small","native-type":"submit",type:"primary",loading:e.tagUpdateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.onSave("managerForm")}}},[e._v("保 存\n      ")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("el-row",[i("el-col",{staticClass:"query-item",attrs:{sm:12}},[i("div",{staticClass:"clearfix"},[i("div",{staticClass:"card-header content-title"},[i("span",[e._v(e._s(e.title))])]),e._v(" "),i("el-button",{staticClass:"card-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.add()}}},[e._v("新增標籤")])],1)]),e._v(" "),i("el-col",{staticClass:"text-align-right",attrs:{sm:12}},[i("el-checkbox",{staticClass:"check-all",attrs:{indeterminate:e.isIndeterminate},on:{change:e.selectAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全選")]),e._v(" "),i("el-button",{attrs:{disabled:1!==this.multipleSelection.length,size:"small"},on:{click:function(t){return e.handleEdit()}}},[e._v("編輯")]),e._v(" "),i("el-button",{attrs:{disabled:0===this.multipleSelection.length,size:"small",type:"danger"},on:{click:function(t){return e.handleDelete()}}},[e._v("刪除")])],1)],1)],1),e._v(" "),i("div",[i("el-checkbox-group",{attrs:{size:"small"},on:{change:e.handleCheckTagChange},model:{value:e.multipleSelection,callback:function(t){e.multipleSelection=t},expression:"multipleSelection"}},e._l(e.tags,(function(t){return i("span",{key:t.id,staticClass:"tag-checkbox",on:{mouseover:function(i){i.preventDefault(),e.hoverEditId=t.id},mouseleave:function(t){t.preventDefault(),e.hoverEditId=""}}},[i("el-checkbox",{attrs:{label:t.id,border:""}},[e._v("\n            "+e._s(t.name)+"\n            "),i("i",{staticClass:"el-tag__close el-icon-edit",style:{marginLeft:"-5px",visibility:e.hoverEditId===t.id?"visible":"hidden"},on:{click:function(i){return i.preventDefault(),e.handleEdit(t.id)}}})])],1)})),0)],1)])],1)},n=[],s=i("c80c"),o=(i("96cf"),i("3b8d")),r=(i("ac6a"),i("d28d")),l=i("f406"),c={name:"tagManager",components:{UploadImageInput:l["a"]},data:function(){return{title:"標籤管理",dialogVisible:!1,dialogTitle:"",tagUpdateLoading:!1,hoverEditId:"",form:{name:"",slug:"",tagBackground:""},rules:{name:[{required:!0,message:"請輸入標籤名稱",trigger:"blur"}]},tags:[],editMove:1,tagGroup:[],multipleSelection:[],checkAll:!1,isIndeterminate:!1}},computed:{},mounted:function(){this.getTags()},methods:{getTags:function(){var e=this;r["a"].tagList().then((function(t){e.tags=t.data}))},mouseover:function(e){},handleCheckTagChange:function(e){var t=e.length;this.checkAll=t===this.tags.length,this.isIndeterminate=t>0&&t<this.tags.length},selectAll:function(e){var t=this;e?this.tags.forEach((function(e){t.multipleSelection.push(e.id)})):this.multipleSelection=[],this.isIndeterminate=!1},handleEdit:function(e){var t=this,i=this.multipleSelection[0];e&&(i=e),this.editMove=2,this.dialogVisible=!0,this.dialogTitle="修改標籤",r["a"].tagInfo({tagId:i}).then((function(e){t.form=e.data}))},handleDelete:function(){var e=this,t=this.multipleSelection;this.$confirm("您確定要刪除這些標籤嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){r["a"].delete({tagIds:t}).then((function(){e.$notify({title:"刪除成功",type:"success",duration:1e3}),e.multipleSelection=[],e.isIndeterminate=!1,e.getTags()})).catch((function(){e.onError()}))}))},setFormData:function(){var e=new FormData;for(var t in this.form)this.form.hasOwnProperty(t)&&this.form[t]&&e.append(t,this.form[t]);return e},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.tagUpdateLoading=!0,1===e.editMove&&e.addTag(e.setFormData()),2===e.editMove&&e.updateTag(e.setFormData())}))},updateTag:function(e){var t=this;r["a"].update(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},addTag:function(e){var t=this;r["a"].add(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogVisible=!0,this.dialogTitle="添加標籤",this.editMove=1,e.next=5,this.$nextTick();case 5:this.$refs.managerForm.resetFields();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onError:function(){this.tagUpdateLoading=!1},onSuccess:function(e){this.getTags();var t="保存成功!";e&&(t=e),this.tagUpdateLoading=!1,this.dialogVisible=!1,this.$message({message:t,type:"success",duration:1e3})}}},d=c,u=(i("daf3"),i("2877")),h=Object(u["a"])(d,a,n,!1,null,"0074e6b0",null);t["default"]=h.exports},1414:function(e,t,i){"use strict";i("f856")},"1a40":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.containerResize,expression:"containerResize"}],staticClass:"container"},[i("van-popup",{style:{height:"100%",width:"35%"},attrs:{"get-container":"body",position:"left"},model:{value:e.leftMenuShow,callback:function(t){e.leftMenuShow=t},expression:"leftMenuShow"}},[i("div",{staticClass:"left-menu"},[i("div",{staticClass:"avatar"},[i("van-image",{attrs:{round:"",width:"5rem",height:"5rem",fit:"cover",src:e.imageUrl+e.avatar}})],1),e._v(" "),i("span",[e._v(e._s(e.name))]),e._v(" "),i("div",{staticClass:"classification"},[i("van-cell",{attrs:{title:"首頁",icon:"wap-home-o"},on:{click:function(t){return e.clickFileType(null,{})}}}),e._v(" "),i("van-cell",{attrs:{title:"收藏",icon:"star-o"},on:{click:function(t){return e.clickFileType(null,{isFavorite:!0})}}}),e._v(" "),i("van-cell",{attrs:{title:"圖片",icon:"photo-o"},on:{click:function(t){return e.clickFileType("image",{isFolder:!1})}}}),e._v(" "),i("van-cell",{attrs:{title:"視頻",icon:"video-o"},on:{click:function(t){return e.clickFileType("video",{isFolder:!1})}}}),e._v(" "),i("van-cell",{attrs:{title:"音樂",icon:"music-o"},on:{click:function(t){return e.clickFileType("audio",{isFolder:!1})}}}),e._v(" "),i("van-cell",{attrs:{title:"文件傳輸",icon:"upgrade"},on:{click:e.uploadList}})],1),e._v(" "),i("div",{staticClass:"logout"},[i("van-button",{attrs:{round:"",type:"danger"},nativeOn:{click:function(t){return e.logout.apply(null,arguments)}}},[e._v("退出登錄")])],1)])]),e._v(" "),i("van-list",{attrs:{finished:e.finished,"finished-text":e.statistics()},on:{load:function(t){e.searchStatus&&e.searchValue.length>0?e.searchFile(e.searchValue,!0):e.getFileList(!0)}},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[i("van-checkbox-group",{ref:"checkboxGroup",on:{change:e.checkboxChange},model:{value:e.selectRowData,callback:function(t){e.selectRowData=t},expression:"selectRowData"}},[i("van-cell-group",[i("van-sticky",{attrs:{"offset-top":-1}},[e.pathList.length<2&&!e.selectStatus?i("van-nav-bar",{style:e.vanNavBarClass,attrs:{title:"瀏覽","right-arrow":"","right-text":this.selectRowData.length!==this.fileList.length?"選擇":"取消","left-arrow":""},on:{"click-right":e.checkboxAll,"click-left":e.leftMenu}},[i("div",{staticClass:"header-button",attrs:{slot:"left"},slot:"left"},[i("svg",{staticClass:"header-button-icon",attrs:{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25"}},[i("path",{attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 0 0 0-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0 0 14.4 7z"}})])])]):e._e(),e._v(" "),e.selectStatus?i("van-nav-bar",{style:e.vanNavBarClass,attrs:{title:0===e.selectRowData.length?"選擇項目":e.selectRowData.length+"項","right-arrow":"","left-text":this.selectRowData.length!==this.fileList.length?"全選":"取消全選","right-text":"完成"},on:{"click-left":e.checkboxAll,"click-right":e.cancelSelect}}):e._e(),e._v(" "),e.pathList.length>=2&&!e.selectStatus?i("van-nav-bar",{style:e.vanNavBarClass,attrs:{title:e.pathList[e.pathList.length-1].folder,"right-text":this.selectRowData.length!==this.fileList.length?"選擇":"取消","left-arrow":""},on:{"click-right":e.checkboxAll,"click-left":e.clickBack}},[i("div",{staticClass:"header-button",attrs:{slot:"left"},slot:"left"},[i("van-icon",{attrs:{name:"arrow-left"}})],1)]):e._e(),e._v(" "),i("div",{staticClass:"searchbar",style:e.searchBarClass},[i("van-search",{ref:"search",attrs:{"show-action":e.searchStatus,shape:"round",placeholder:"搜索"},on:{focus:e.startSearch,search:e.onSearch,input:e.onSearch},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}},[i("div",{attrs:{slot:"action"},on:{click:e.endSearch},slot:"action"},[e._v("取消")])])],1)],1),e._v(" "),i("van-cell",{staticStyle:{padding:"0 0 10px 0"},attrs:{center:!0}},[i("div",{staticClass:"operating-header"},[i("van-row",[i("van-col",{staticClass:"operating-header-col",attrs:{span:"4",align:"center",type:"flex"},on:{click:e.moreOperations}},[i("van-icon",{attrs:{name:"more-o"}})],1),e._v(" "),i("van-col",{staticClass:"operating-header-col",attrs:{span:"16",align:"center"},on:{click:e.showSortSheet}},[e._v("\n                已按"+e._s(e.actionsSortName)+"排序\n                "),i("van-icon",{staticClass:"sortable",attrs:{name:"arrow-"+e.sortOrder}})],1),e._v(" "),i("van-col",{staticClass:"operating-header-col",attrs:{span:"4",align:"center"},on:{click:e.changeVmode}},[i("van-icon",{style:e.grid?{}:{background:"#1989fa",color:"#ffffff",padding:"0 5px",borderRadius:"5px"},attrs:{name:"bars"}})],1)],1)],1)]),e._v(" "),e.searchStatus&&e.searchValue.length>0&&e.fileList.length>0?i("van-cell",{staticStyle:{"background-color":"#f7f8fa"}},[i("div",{staticClass:"search-result"},[e._v(e._s(e.resultCount)+"個結果")])]):e._e(),e._v(" "),e.searchStatus&&e.searchValue.length>0&&0===e.fileList.length?i("van-cell",[i("div",{staticClass:"search-result-no"},[e._v("無結果")])]):e._e(),e._v(" "),e.loading||0!==e.fileList.length?e._e():i("van-empty",{attrs:{description:"空空如也"}}),e._v(" "),e._l(e.fileList,(function(t,a){return e.grid?e._e():i("van-cell",{key:t.id,staticClass:"list-item",style:{background:e.selectIndexList.includes(a)?"#90c2fcb5":""},attrs:{center:"","is-link":t.isFolder},on:{click:function(i){return e.fileClick(t,a)}}},[i("div",{staticClass:"list-item-div",on:{touchstart:function(i){return e.touchStart(t)},touchend:e.touchEnd,touchmove:e.touchMove}},[i("van-row",{staticClass:"row-file"},[i("van-col",{staticClass:"list-cell-icon",attrs:{span:"4",align:"center"}},[i("icon-file",{attrs:{item:t,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl}})],1),e._v(" "),i("van-col",{staticClass:"list-item-content",attrs:{span:"16"}},[i("van-col",{attrs:{span:"24"}},[e._v("\n                  "+e._s(t.name)+"\n                ")]),e._v(" "),i("van-col",{staticClass:"file-description",attrs:{span:"24",justify:"space-between"}},[i("van-col",{attrs:{span:"24"}},[e._v("\n                    "+e._s(e.formatTime(t.agoTime))+"   "+e._s(e.formatSize(t.size))+"\n                  ")])],1)],1),e._v(" "),i("van-col",{attrs:{span:"4"}})],1)],1),e._v(" "),!e.grid&&e.selectStatus?i("van-checkbox",{ref:"checkboxes",refInFor:!0,staticClass:"file-item-checkbox",attrs:{slot:"right-icon",name:t},slot:"right-icon"}):e._e()],1)})),e._v(" "),e.grid?i("van-grid",{style:{width:"100%",overflow:"auto"},attrs:{square:"",center:!0,"column-num":e.gridColumnNum,gutter:10,border:!1}},e._l(e.fileList,(function(t,a){return i("van-grid-item",{key:t.id,ref:"gridItem",refInFor:!0,staticClass:"parent-grid-item",on:{click:function(i){return e.fileClick(t,a)}}},[i("div",{staticClass:"grid-time van-grid-item__content van-grid-item__content--center van-grid-item__content--square",style:{background:e.selectIndexList.includes(a)?"#90c2fcb5":"","border-radius":"15px"},on:{touchstart:function(i){return e.touchStart(t)},touchend:e.touchEnd,touchmove:e.touchMove}},[e.grid&&e.selectStatus?i("van-checkbox",{ref:"checkboxes",refInFor:!0,staticClass:"file-item-checkbox",attrs:{slot:"right-icon",name:t},slot:"right-icon"}):e._e(),e._v(" "),i("div",{staticClass:"grid-item-icon"},[i("icon-file",{attrs:{item:t,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl,grid:!0}})],1),e._v(" "),i("span",{staticClass:"grid-item-text",attrs:{title:t.name}},[e._v(e._s(t.name))])],1)])})),1):e._e()],2)],1)],1),e._v(" "),i("van-action-sheet",{attrs:{actions:e.actionsMenus,"cancel-text":"取消"},on:{cancel:e.onCancel,select:e.selectActionsMenus},model:{value:e.actionSheetShow,callback:function(t){e.actionSheetShow=t},expression:"actionSheetShow"}}),e._v(" "),i("van-action-sheet",{attrs:{actions:e.actionsSortMenus,"cancel-text":"取消",description:"排序方式"},on:{cancel:e.onCancel,select:e.selectSortActionsMenus},model:{value:e.actionSortSheetShow,callback:function(t){e.actionSortSheetShow=t},expression:"actionSortSheetShow"}}),e._v(" "),i("van-dialog",{attrs:{"show-cancel-button":""},on:{confirm:e.newFolderNameClick},model:{value:e.showNewFolder,callback:function(t){e.showNewFolder=t},expression:"showNewFolder"}},[i("van-field",{ref:"newFolderInput",staticClass:"new-folder-input",attrs:{placeholder:"請輸入文件夾名稱",border:!0,clearable:!0,autofocus:!0},model:{value:e.newFolderName,callback:function(t){e.newFolderName=t},expression:"newFolderName"}})],1),e._v(" "),i("van-dialog",{attrs:{"show-cancel-button":""},on:{confirm:function(t){return e.rowRename()}},model:{value:e.showRename,callback:function(t){e.showRename=t},expression:"showRename"}},[i("van-field",{ref:"renameInput",staticClass:"rename-input",attrs:{placeholder:"請輸入文件名稱",border:!0,clearable:!0,autofocus:!0},model:{value:e.renameFileName,callback:function(t){e.renameFileName=t},expression:"renameFileName"}})],1),e._v(" "),i("e-vue-contextmenu",{ref:"contextShow",staticClass:"newFileMenu",on:{"ctx-show":e.show,"ctx-hide":e.hide}},e._l(e.menus,(function(t,a){return i("ul",{key:t.label,class:{"menu-list-first":0===a,"menu-list-last":a===e.menus.length-1,"menu-list":a<e.menus.length-1&&a>0}},[0!==a?i("div",{staticStyle:{"border-bottom":"1px solid #cccccc85"}}):e._e(),e._v(" "),i("li",{class:{remove:"remove"===t.operation},on:{click:function(i){return e.menusOperations(t.operation)}}},[i("div",{staticClass:"menuitem"},[i("svg-icon",{attrs:{"icon-class":t.iconClass}}),e._v(" "),i("span",{staticClass:"menuitem text"},[e._v(e._s(t.label))])],1)])])})),0),e._v(" "),i("van-overlay",{ref:"overlayShow",attrs:{show:e.overlayShow,duration:"0.3"},on:{click:e.overlayClick}},[null==e.rowContextData.name||e.grid?e._e():i("van-cell",{staticClass:"list-item overlay-content-class",style:e.overlayContentClass,attrs:{center:"","is-link":e.rowContextData.isFolder}},[i("div",[i("van-row",{staticClass:"row-file"},[i("van-col",{staticClass:"list-cell-icon",attrs:{span:"4",align:"center"}},[i("icon-file",{attrs:{item:e.rowContextData,"image-url":e.imageUrl}})],1),e._v(" "),i("van-col",{staticClass:"list-item-content",attrs:{span:"16"}},[i("van-col",{attrs:{span:"24"}},[e._v("\n              "+e._s(e.rowContextData.name)+"\n            ")]),e._v(" "),i("van-col",{staticClass:"file-description",attrs:{span:"24",justify:"space-between"}},[i("van-col",{attrs:{span:"24"}},[e._v("\n                "+e._s(e.formatTime(e.rowContextData.agoTime))+"   "+e._s(e.formatSize(e.rowContextData.size))+"\n              ")])],1)],1),e._v(" "),i("van-col",{attrs:{span:"4"}})],1)],1),e._v(" "),e.selectStatus?i("van-checkbox",{staticClass:"file-item-checkbox",attrs:{slot:"right-icon",name:e.rowContextData},slot:"right-icon",model:{value:e.isShowCheckContext,callback:function(t){e.isShowCheckContext=t},expression:"isShowCheckContext"}}):e._e()],1),e._v(" "),null!=e.rowContextData.name&&e.grid?i("div",{staticClass:"grid-time overlay-content-class van-grid-item__content van-grid-item__content--center van-grid-item__content--square",style:e.overlayContentClass},[e.selectStatus?i("van-checkbox",{staticClass:"file-item-checkbox",attrs:{slot:"right-icon",name:e.rowContextData},slot:"right-icon",model:{value:e.isShowCheckContext,callback:function(t){e.isShowCheckContext=t},expression:"isShowCheckContext"}}):e._e(),e._v(" "),i("div",{staticClass:"grid-item-icon"},[i("icon-file",{attrs:{item:e.rowContextData,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl,grid:!0}})],1),e._v(" "),i("span",{staticClass:"grid-item-text",attrs:{title:e.rowContextData.name}},[e._v(e._s(e.rowContextData.name))])],1):e._e()],1),e._v(" "),i("sim-text-preview",{attrs:{file:e.textPreviewRow,status:e.textPreviewVisible},on:{"update:file":function(t){e.textPreviewRow=t},"update:status":function(t){e.textPreviewVisible=t}}}),e._v(" "),i("image-viewer",{attrs:{fileList:e.fileList,file:e.imagePreviewRow,status:e.imagePreviewVisible},on:{"update:status":function(t){e.imagePreviewVisible=t}}}),e._v(" "),i("video-preview",{attrs:{file:e.videoPreviewRow,status:e.videoPreviewVisible},on:{"update:status":function(t){e.videoPreviewVisible=t}}}),e._v(" "),i("office-preview",{attrs:{file:e.officePreviewRow,status:e.officePreviewVisible},on:{"update:status":function(t){e.officePreviewVisible=t}}})],1)},n=[],s=(i("f559"),i("2d63")),o=(i("55dd"),i("386d"),i("c80c")),r=(i("96cf"),i("3b8d")),l=(i("20d6"),i("aef6"),i("7f7f"),i("6762"),i("2fdb"),i("7514"),i("28a5"),i("ac6a"),i("db72")),c=i("2f62"),d=i("7f29"),u=i("26a1"),h=i("5cfc"),f=i("0dcf"),p=i("9dce"),m=i("2690"),g=i("1638"),v=i("ae1f"),b=i("2d53"),w=i("1000"),y=i("fd35"),x=(i("d958"),{components:{OfficePreview:y["a"],SimTextPreview:b["a"],VideoPreview:v["a"],ImageViewer:g["a"],IconFile:f["a"]},computed:Object(l["a"])({},Object(c["b"])(["name","avatar"])),data:function(){return{test:0,lastTabbarOffsetTop:0,diffTabbarTop:0,isiPhoneX:0,imageUrl:"/api/view/thumbnail?jmal-token="+this.$store.state.user.token+"&id=",audioCoverUrl:"/api/view/cover?jmal-token="+this.$store.state.user.token+"&id=",tabActive:0,path:this.$route.query.path,fileList:[],pathList:[{folder:"",index:0},{folder:"+",index:1}],pagination:{pageIndex:0,pageSize:50,total:0},queryFileType:null,queryCondition:{isFolder:null},loading:!1,finished:!1,refreshing:!1,actionSheetShow:!1,actionsMenus:[{name:"新建文件夾"}],actionSortSheetShow:!1,actionsSortMenus:[{name:"名稱"},{name:"日期"},{name:"大小"}],actionsSortName:"名稱",showNewFolder:!1,showRename:!1,newFolderName:"新建文件夾",Loop:null,isJustHideMenus:!1,menus:[{iconClass:"menu-select",label:"選擇",operation:"select"},{iconClass:"menu-favorite",label:"收藏",operation:"favorite"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}],rowContextData:{},selectRowData:[],checkboxGroup:[],newFolderLoading:!1,renameLoading:!1,renameFileName:"",selectIndexList:[],selectStatus:!1,isShowCheckContext:!1,overlayShow:!1,overlayContentClass:{},vanNavBarClass:{},searchBarClass:{},leftMenuShow:!1,searchValue:"",searchStatus:!0,resultCount:0,sortOrder:"up",sortableProp:null,order:null,grid:!1,vmode:"list",gridColumnNum:-1,imagePreviewRow:{},imagePreviewVisible:!1,videoPreviewRow:{},videoPreviewVisible:!1,officePreviewRow:{},officePreviewVisible:!1,textPreviewVisible:!1,textPreviewRow:{}}},directives:{resize:{bind:function(e,t){var i="",a="";function n(){var n=document.defaultView.getComputedStyle(e);i===n.width&&a===n.height||t.value(),i=n.width,a=n.height}e.__vueSetInterval__=setInterval(n,300)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},mounted:function(){var e=this;if(this.$route.query.vmode&&(this.vmode=this.$route.query.vmode,"list"===this.vmode?this.grid=!1:this.grid=!0),"/"!==this.$route.query.path){var t=decodeURI(this.$route.query.path);this.pathList.splice(1,1),t.split("/").forEach((function(t,i){if(i>0){var a={};a["folder"]=t,a["index"]=i,e.pathList.push(a)}}))}window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1))},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1)},methods:{highlightFavorite:function(e,t){var i=this.menus.find((function(e){if("favorite"===e.operation||"unFavorite"===e.operation)return e}));i&&(e?(i.label="取消收藏",i.iconClass="menu-unfavorite-hover",i.operation="unFavorite"):(i.iconClass=t?"menu-favorite-hover":"menu-favorite",i.label="收藏",i.operation="favorite"))},show:function(){},hide:function(){var e=this;this.isJustHideMenus=!0,setTimeout((function(){e.isJustHideMenus=!1}),100)},showCheckContext:function(){return this.selectIndexList.includes(this.rowContextData.index)},rowContextmenu:function(e,t,i){if(this.selectStatus&&this.selectIndexList.includes(e.index)){if(this.selectIndexList.includes(e.index)){var a={iconClass:"menu-unselect",label:"取消選擇",operation:"unselect"};this.menus.splice(0,1,a)}}else{var n={iconClass:"menu-select",label:"選擇",operation:"select"};this.menus.splice(0,1,n)}this.preliminaryRowData(e);var s=Object(u["b"])(t)-e.scrollY,o={};s+t.offsetHeight/2>document.body.offsetHeight/2?(o.pageX=i,o.pageY=Object(u["b"])(t)-47*this.menus.length+5):(o.pageX=i,o.pageY=Object(u["b"])(t)+t.offsetHeight+5),this.$refs.contextShow.showMenu(o)},preliminaryRowData:function(e){this.rowContextData=e,this.isShowCheckContext=this.selectIndexList.includes(e.index);var t=this.rowContextData.isFavorite;this.highlightFavorite(t,!1)},menusOperations:function(e){var t=this,i=this;switch(e){case"favorite":this.favoriteOperating(!0);break;case"open":this.fileClick(this.rowContextData,this.rowContextData.index);break;case"unselect":var a=this.rowContextData.index;this.$refs.checkboxes[a].toggle();break;case"unFavorite":this.favoriteOperating(!1);break;case"select":this.selectStatus=!0,this.selectIndexList.push(this.rowContextData.index),setTimeout((function(){t.$refs.checkboxes[i.rowContextData.index].toggle()}),0);break;case"rename":this.renameFileName=this.rowContextData.name,this.showRename=!0,setTimeout((function(){i.$refs.renameInput.focus()}),0);break;case"copy":vant.Toast("暫不支持移動");break;case"download":this.downloadFile();break;case"remove":this.deleteFile();break}this.overlayShow=!1,document.documentElement.style.overflow=null,this.$refs.contextShow.hideMenu()},rowRename:function(){var e=this,t=this.rowContextData,i=this.renameFileName;if(i){if(!t.isFolder){var a="."+t.suffix;i.endsWith(a)||(i+=a)}this.renameLoading=!0;var n=this.fileList.findIndex((function(e){if(i===e.name)return e}));if(n>-1){var s="該文件已存在";return t.isFolder&&(s="該文件夾已存在"),this.$message({message:s,type:"warning"}),void(this.renameLoading=!1)}h["a"].rename({newFileName:encodeURI(i),username:this.$store.state.user.name,id:t.id}).then((function(a){a.data&&(e.renameLoading=!1,t.name=i,e.fileList[t.index]=t,e.editingIndex=-1)}))}else this.editingIndex=-1},downloadFile:function(){var e=0;if(this.selectRowData.length>0?this.selectRowData.forEach((function(t){e+=t.size})):e+=this.rowContextData.size,e>0){var t=[];if(this.selectRowData.length>0?this.selectRowData.forEach((function(e){t.push(e.id)})):t.push(this.rowContextData.id),t.length>1||this.rowContextData.isFolder)return void m["a"].packageDownload(t,this.$store.state.user.token);m["a"].download(this.$store.state.user.name,this.rowContextData,this.$store.state.user.token)}else this.$message({message:"所選文件夾爲空",type:"warning"})},favoriteOperating:function(e){this.rowContextData.isFavorite=e,this.highlightFavorite(e,!0),h["a"].favoriteUrl({token:this.$store.state.user.token,fileIds:this.rowContextData.id,isFavorite:e}).then((function(e){}))},deleteFile:function(){var e=this,t=[],i=[];this.selectRowData.length>0?(t=this.selectRowData,this.selectRowData.forEach((function(e){i.push(e.id)}))):(t=this.selectRowData,i.push(this.rowContextData.id));var a=this.getShowSumFileAndFolder(t);vant.Dialog.confirm({title:"提示",message:"此操作將永久刪除"+a+", 是否繼續?"}).then((function(){h["a"].delete({username:e.$store.state.user.name,fileIds:i}).then((function(){e.getFileList(),vant.Toast.setDefaultOptions({duration:800}),vant.Toast.success("刪除成功"),e.selectRowData.length>1&&(e.selectRowData=[])}))}))},touchMove:function(){clearTimeout(this.Loop)},touchStart:function(e){var t=this;clearTimeout(this.Loop);var i=window.event;this.Loop=setTimeout((function(){e.scrollY=i.targetTouches[0].pageY-i.targetTouches[0].clientY,t.findListItem(e,i.targetTouches[0].target,i.targetTouches[0].clientX)&&(t.overlayShow=!0,document.documentElement.style.overflow="hidden")}),500)},touchEnd:function(){clearTimeout(this.Loop)},overlayClick:function(){this.overlayShow=!1,document.documentElement.style.overflow=null},findListItem:function(e,t,i){if(null===t)return!1;var a=t.offsetParent,n=t.parentElement;if(!a&&n||null===a)return this.findListItem(e,t.parentElement,i);if(a.className.indexOf("list-item")>-1)this.longPressDisplayLayer(e,a,i);else{if(!(a.className.indexOf("grid-time")>-1))return this.findListItem(e,t.offsetParent,i);this.longPressDisplayLayer(e,a,i)}return!0},longPressDisplayLayer:function(e,t,i){var a=this,n=this.selectIndexList.includes(this.rowContextData.index)?"#90c2fcb5":"";this.overlayContentClass={top:Object(u["b"])(t)-e.scrollY+"px",height:t.offsetHeight+"px",width:t.offsetWidth+"px",left:Object(u["a"])(t)+"px","border-radius":"0px",background:n},setTimeout((function(){a.overlayContentClass={top:Object(u["b"])(t)-e.scrollY+"px",height:t.offsetHeight+"px",width:t.offsetWidth-(a.grid?0:10)+"px",left:Object(u["a"])(t)+(a.grid?0:5)+"px","border-radius":"20px",background:n}}),0),this.rowContextmenu(e,t,i)},goBack:function(){this.pathList.length<=1?this.$router.push("/_m?vmode=".concat(this.vmode,"&path=").concat(encodeURI(this.path))):this.clickBack()},clickBack:function(){this.handleLink(this.pathList[this.pathList.length-2],this.pathList.length-2)},leftMenu:function(){this.leftMenuShow=!0},logout:function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(){return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login?redirect=".concat(this.$route.fullPath));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),startSearch:function(){this.vanNavBarClass={visibility:"hidden"},this.searchBarClass={marginTop:"-30px"};var e=document.querySelector(".van-search__action");e.style.marginRight="0px",e.style.visibility="visible",e.style.color="#1989fa"},endSearch:function(){var e=this;setTimeout((function(){e.vanNavBarClass={visibility:"visible"}}),150),this.searchBarClass={marginTop:"0px"};var t=document.querySelector(".van-search__action");t.style.marginRight="-44px",t.style.visibility="hidden",this.searchValue="",this.getFileList()},onSearch:function(){this.searchValue.length<1?this.getFileList():this.searchFile(this.searchValue)},changeVmode:function(){this.grid=!this.grid,this.vmode="list",this.grid&&(this.vmode="grid"),this.path||(this.path=""),this.$router.push("?vmode=".concat(this.vmode,"&path=").concat(this.path))},showSortSheet:function(){this.actionSortSheetShow=!0},moreOperations:function(){if(this.actionSheetShow=!0,this.actionsMenus=[{name:"新建文件夾"}],window.uploader.support){var e={name:"上傳文件"};this.actionsMenus.push(e)}if(window.uploader.supportDirectory){var t={name:"上傳文件夾"};this.actionsMenus.push(t)}},handleLink:function(e,t,i,a){var n=this;e&&e.search?(e.searchKey?this.searchFileByKeyWord(e.searchKey):e.row&&this.searchFileAndOpenDir(e.row),this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1))):(this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1)),this.pathList.forEach((function(e,t){0===t?n.path="":t===n.pathList.length||(n.path+="/"+n.pathList[t].folder)})),i||(this.$route.query.path,this.$router.push("/_m?vmode=".concat(this.vmode,"&path=").concat(encodeURI(this.path)))),a||(this.pagination.pageIndex=1,this.getFileList()))},formatTime:function(e){return Object(d["c"])(e)},formatSize:function(e){return Object(d["b"])(e)},onRefresh:function(){this.finished=!1,this.loading=!0,this.getFileList()},getFileList:function(e){var t=this;this.beforeLoadData(e),h["a"].fileList({userId:this.$store.state.user.userId,currentDirectory:encodeURI(this.$route.query.path),queryFileType:this.queryFileType,sortableProp:this.sortableProp,order:this.order,isFolder:this.queryCondition.isFolder,isFavorite:this.queryCondition.isFavorite,queryCondition:this.queryCondition,pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(i){t.loadData(i,e)})).catch((function(e){}))},searchFile:function(e,t){var i=this;e&&(this.beforeLoadData(t),this.$router.push("?vmode=".concat(this.vmode,"&search-file=").concat(e)),h["a"].searchFile({userId:this.$store.state.user.userId,username:this.$store.state.user.name,keyword:e,currentDirectory:encodeURI(this.$route.query.path),pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(e){i.loadData(e,t),i.path="",i.listModeSearch=!0,i.listModeSearchOpenDir=!1})))},beforeLoadData:function(e){e?this.pagination.pageIndex++:this.pagination.pageIndex=1,this.finished=!1,this.fileList=[]},loadData:function(e,t){var i=this;t?e.data.forEach((function(e,t){e["index"]=(i.pagination.pageIndex-1)*i.pagination.pageSize+t,i.fileList.push(e)})):(this.fileList=e.data,this.fileList.map((function(e,t){e["index"]=t}))),this.refreshing=!1,this.resultCount=e.count,this.fileList.length>=e.count&&(this.finished=!0),this.fileList.sort(this.compare(this.sortableProp)),this.$nextTick((function(){i.containerResize(),i.loading=!1}))},containerResize:function(){var e=document.querySelector(".container"),t=e.clientWidth;t>1024?this.gridColumnNum=Math.round(t/100-4):(this.gridColumnNum=Math.round(t/100-2),t<=550&&(this.gridColumnNum=4),t<=375&&(this.gridColumnNum=3))},clickFileType:function(e,t){this.queryCondition=t,this.queryFileType=e,this.getFileList(),this.leftMenuShow=!1},uploadList:function(){this.$router.push("/upload/index_m")},statistics:function(){var e=0;return this.fileList.forEach((function(t){e+=t.size})),this.getShowSumFileAndFolder(this.fileList)+" "+this.getShowSumSize(e)},getShowSumFileAndFolder:function(e){var t=0,i=0;e.forEach((function(e){e.isFolder?t+=1:i+=1}));var a="";t>0&&(a=t+"個文件夾");var n="";return i>0&&(n=i+"個文件"),a+" "+n},getShowSumSize:function(e){var t="";return e>0&&(t="  共"),0===e||(t+=e<1024?e+"B":e>=1024&&e<1048576?(e/1024).toFixed(2)+"K":e>=1048576&&e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G"),t},checkboxAll:function(){this.selectRowData.length!==this.fileList.length?this.$refs.checkboxGroup.toggleAll(!0):this.$refs.checkboxGroup.toggleAll()},cancelSelect:function(){this.$refs.checkboxGroup.toggleAll(!1);var e=this;setTimeout((function(){e.selectStatus=!1}))},checkboxChange:function(e){this.selectRowData=e,this.selectIndexList=[];var t,i=Object(s["a"])(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.selectIndexList.push(a.index)}}catch(n){i.e(n)}finally{i.f()}this.selectStatus=!0},fileClick:function(e,t){var i=this;if(this.selectStatus)this.$refs.checkboxes[t].toggle();else if(e.isFolder){this.path?this.path+="/"+e.name:this.path="/"+e.name;var a={};a["folder"]=e.name,a["index"]=this.pathList.length-1,this.pathList.push(a),this.$router.push("/_m?vmode=".concat(this.vmode,"&path=").concat(encodeURI(this.path))),this.getFileList()}else{if(e.contentType.startsWith("image"))return this.imagePreviewVisible=!0,void(this.imagePreviewRow=e);if(w["c"].simText.includes(e.suffix))return this.textPreviewRow=e,void(this.textPreviewVisible=!0);if(e.contentType.indexOf("video")>-1)return this.videoPreviewVisible=!0,void(this.videoPreviewRow=e);if(e.contentType.indexOf("audio")>-1)return void p["a"].$emit("onAddAudio",e,this.audioCoverUrl);if(e.contentType.indexOf("office")>-1||"csv"===e.suffix)return this.officePreviewVisible=!0,void(this.officePreviewRow=e);if("pdf"===e.suffix)return void m["a"].preview(this.$store.state.user.name,e,this.$store.getters.token);vant.Dialog.confirm({title:"標題",message:"此文件不支持預覽，是否下載",confirmButtonText:"下載"}).then((function(){setTimeout((function(){m["a"].download(i.$store.state.user.name,e,i.$store.state.user.token)}),0)})).catch((function(){}))}},onCancel:function(){this.actionSheetShow=!1,this.actionSortSheetShow=!1},compare:function(e){var t=this;return function(i,a){var n=i[e],s=a[e];return"ascending"===t.order?n-s:s-n}},selectSortActionsMenus:function(e){var t=this;setTimeout((function(){t.actionSortSheetShow=!1}),100),"up"===this.sortOrder?(this.sortOrder="down",this.order="descending"):(this.sortOrder="up",this.order="ascending"),this.actionsSortName=e.name,"名稱"===e.name&&(this.sortableProp="name","up"===this.sortOrder&&(this.order=null),this.getFileList()),"大小"===e.name&&(this.sortableProp="size",this.fileList.sort(this.compare(this.sortableProp))),"日期"===e.name&&(this.sortableProp="updateDate",this.getFileList())},selectActionsMenus:function(e){var t=this;if(setTimeout((function(){t.actionSheetShow=!1}),100),"新建文件夾"===e.name){this.newFolderName="新建文件夾";var i=0,a=[];this.fileList.forEach((function(e){a.push(e.name)}));while(a.includes(this.newFolderName))i+=1,this.newFolderName="新建文件夾"+i;this.showNewFolder=!0;var n=this;setTimeout((function(){n.$refs.newFolderInput.focus()}),0)}"上傳文件"===e.name&&p["a"].$emit("openUploader",{currentDirectory:encodeURI(this.path),username:this.$store.state.user.name,userId:this.$store.state.user.userId}),"上傳文件夾"===e.name&&p["a"].$emit("uploadFolder",{currentDirectory:encodeURI(this.path),username:this.$store.state.user.name,userId:this.$store.state.user.userId})},newFolderNameClick:function(){var e=this;this.newFolderLoading=!0,this.newFolderName?h["a"].uploadFolder({isFolder:!0,filename:encodeURI(this.newFolderName),currentDirectory:encodeURI(this.path),username:this.$store.state.user.name,userId:this.$store.state.user.userId}).then((function(t){1===t.data?(e.newFolderLoading=!1,e.$message({message:"該文件夾已存在",type:"warning"})):(e.newFolderLoading=!1,e.showNewFolder=!1,e.isShowNewFolder=!1,Notify({type:"success",message:"新建文件夾成功",duration:1e3}),e.listModeSearch?e.getFileListBySearchMode():e.getFileList())})):(this.newFolderLoading=!1,this.$message({message:"請輸入文件夾名稱",type:"warning"}))},swipeUp:function(){this.test=10},tabBottom:function(){return{padding:"0 0 20px 0"}}}}),C=x,k=(i("466a"),i("2877")),_=Object(k["a"])(C,a,n,!1,null,"7dfa5c2c",null);t["default"]=_.exports},"1a60":function(e,t,i){},2017:function(e,t,i){"use strict";i("b12d")},2114:function(e,t,i){},"23a0":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{staticClass:"dialog-cm",attrs:{width:"500px",title:e.dialogTitle,"close-on-click-modal":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium",model:e.form,"label-position":"left",rules:e.rules,"label-width":"95px"}},[i("el-form-item",{attrs:{label:"分類名稱:",prop:"name"}},[i("el-input",{attrs:{placeholder:"請輸入分類名稱"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"分類縮略名:",prop:"slug"}},[i("el-input",{attrs:{placeholder:"分類縮略名用於創建友好的鏈接形式"},model:{value:e.form.slug,callback:function(t){e.$set(e.form,"slug",t)},expression:"form.slug"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"父級分類:",prop:"parentCategoryId"}},[i("tree-select",{staticStyle:{width:"100%"},attrs:{placeholder:"不選擇",options:e.categories,props:{checkStrictly:!0,value:"id",label:"name"}},model:{value:e.form.parentCategoryId,callback:function(t){e.$set(e.form,"parentCategoryId",t)},expression:"form.parentCategoryId"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"分類描述:",prop:"desc"}},[i("el-input",{attrs:{type:"textarea",placeholder:"此文字用於描述分類, 在該分類首頁中它會被顯示",autosize:{minRows:2,maxRows:6}},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"分類背景:",prop:"categoryBackground"}},[i("upload-image-input",{model:{value:e.form.categoryBackground,callback:function(t){e.$set(e.form,"categoryBackground",t)},expression:"form.categoryBackground"}}),e._v(" "),i("div",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在分類頁面顯示一個背景大圖.")])],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{"native-type":"submit",type:"primary",size:"small",loading:e.categoryUpdateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.onSave("managerForm")}}},[e._v("保 存\n      ")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"clearfix"},[e.parentCategory.name?i("div",{staticClass:"card-header-back"},[i("span",{staticClass:"header-back-title",on:{click:e.backParent}},[i("i",{staticClass:"el-icon-back"}),e._v(" "),i("span",[e._v("返回上級目錄")])]),e._v(" "),i("el-divider",{attrs:{direction:"vertical"}})],1):e._e(),e._v(" "),i("div",{staticClass:"card-header content-title"},[i("span",[e._v(e._s(e.parentCategory.name?"管理 "+e.parentCategory.name+" 的子分類":"管理分類"))])]),e._v(" "),i("el-button",{staticClass:"card-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.add()}}},[e._v("新增分類")])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:this.multipleSelection.length>0,expression:"this.multipleSelection.length > 0"}],staticClass:"card-header-right"},[i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete()}}},[e._v("刪除")])],1)]),e._v(" "),i("el-table",{attrs:{data:e.categoryList,stripe:"","row-key":"id","expand-row-keys":e.expandRowKeys,size:"medium"},on:{"selection-change":e.handleSelectionChange,"cell-mouse-enter":e.cellMouseEnter,"cell-mouse-leave":e.cellMouseLeave}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"名稱"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{on:{click:function(i){return e.handleEdit(t.row.id)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"子分類"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children&&t.row.children.length>0?i("a",{on:{click:function(i){return e.subCategoryList(t.row.id)}}},[e._v(e._s(t.row.children.length)+"個分類")]):i("a",{on:{click:function(i){return e.add(t.row.id)}}},[e._v("新增")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"slug",label:"縮略名"}}),e._v(" "),i("el-table-column",{attrs:{prop:"quota",label:"默認"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isDefault?i("span",[e._v("默認")]):e._e(),e._v(" "),t.row.isDefault||t.row.id!==e.cellMouseIndexId?e._e():i("a",{on:{click:function(i){return e.setDefault(t.row)}}},[e._v("默認")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"quota",label:"文章數"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.articleNum>0?i("router-link",{attrs:{to:"/setting/website/manager-articles?categoryIds="+t.row.id}},[i("el-tag",{staticClass:"article-num"},[e._v(e._s(t.row.articleNum))])],1):i("span",[i("el-tag",{staticClass:"article-num"},[e._v(e._s(t.row.articleNum))])],1)]}}])})],1)],1)],1)},n=[],s=(i("7f7f"),i("c80c")),o=(i("96cf"),i("3b8d")),r=(i("ac6a"),i("c405")),l=i("f406"),c=i("d693"),d={name:"categoryManager",components:{TreeSelect:c["a"],UploadImageInput:l["a"]},data:function(){return{title:"分類管理",categoryList:[],expandRowKeys:[],dialogVisible:!1,dialogTitle:"",categoryUpdateLoading:!1,valid:!0,categories:[],parentCategory:{},parentCategoryId:void 0,form:{name:"",slug:"",parentCategoryId:"",desc:"",categoryBackground:""},rules:{name:[{required:!0,message:"請輸入分類名稱",trigger:"blur"}]},editMove:1,multipleSelection:[],cellMouseIndexId:""}},computed:{},mounted:function(){this.getCategories(),this.getParentCategory()},methods:{handleSelectionChange:function(e){this.multipleSelection=e},backParent:function(){this.subCategoryList(this.parentCategory.parentCategoryId)},getParentCategory:function(){var e=this;this.$route.query.parent?r["a"].categoryInfo({categoryId:this.$route.query.parent}).then((function(t){e.parentCategory=t.data})):this.parentCategory={}},getCategories:function(){var e=this;r["a"].categories({parentCategoryId:this.$route.query.parent}).then((function(t){e.categoryList=t.data,e.categoryList.forEach((function(t){t.children&&e.expandRowKeys.push(t.id)}))}))},categoryTree:function(){var e=this;r["a"].categoryTree().then((function(t){e.categories=t.data}))},subCategoryList:function(e){e?this.$router.push("".concat(window.location.pathname,"?parent=").concat(e)):this.$router.push(window.location.pathname),this.getCategories(),this.getParentCategory()},add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(t){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.categoryTree(),this.dialogVisible=!0,this.dialogTitle="添加分類",this.editMove=1,e.next=6,this.$nextTick();case 6:this.$refs.managerForm.resetFields(),this.$route.query.parent&&(this.form.parentCategoryId=this.$route.query.parent),t&&(this.form.parentCategoryId=t);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),setFormData:function(){var e=new FormData;for(var t in this.form)this.form.hasOwnProperty(t)&&this.form[t]&&e.append(t,this.form[t]);return e},setDefault:function(e){var t=this;r["a"].setDefault({categoryId:e.id}).then((function(){t.getCategories(),t.$message({message:"".concat(e.name," 已經被設爲默認分類"),type:"success",duration:1500})})).catch((function(){}))},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.categoryUpdateLoading=!0,1===e.editMove&&e.addCategory(e.setFormData()),2===e.editMove&&e.updateCategory(e.setFormData())}))},handleEdit:function(e){var t=this;this.editMove=2,this.dialogVisible=!0,this.dialogTitle="修改分類",r["a"].categoryInfo({categoryId:e}).then((function(e){t.form=e.data})),this.categoryTree()},handleDelete:function(){var e=this,t=[];this.multipleSelection.forEach((function(e){t.push(e.id)})),this.$confirm("所選分類下的所有內容(包括文章)都將被刪除,\r\n 您確認要刪除嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){r["a"].delete({categoryIds:t}).then((function(){e.onDeleted()})).catch((function(){e.onError()}))}))},updateCategory:function(e){var t=this;r["a"].update(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},addCategory:function(e){var t=this;r["a"].add(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},onDeleted:function(){this.$notify({title:"刪除成功",type:"success",duration:1e3}),this.getCategories()},onSuccess:function(e){this.getCategories();var t="保存成功!";e&&(t=e),this.categoryUpdateLoading=!1,this.dialogVisible=!1,this.$message({message:t,type:"success",duration:1e3})},onError:function(){this.categoryUpdateLoading=!1},cellMouseEnter:function(e){this.cellMouseIndexId=e.id},cellMouseLeave:function(){this.cellMouseIndexId=""}}},u=d,h=(i("3016"),i("2877")),f=Object(h["a"])(u,a,n,!1,null,"ff8b3c84",null);t["default"]=f.exports},"26a1":function(e,t,i){"use strict";function a(e){return e.className&&e.className.indexOf("parent-grid-item")>-1||e.className.indexOf("van-grid-item van-grid-item--square")>-1?e.offsetTop:e.parentElement?a(e.parentElement)+e.offsetTop:e.offsetTop}function n(e){return e.className&&e.className.indexOf("parent-grid-item")>-1?e.offsetLeft:e.offsetParent?n(e.offsetParent)+e.offsetLeft:e.offsetLeft}i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return n}))},"26fc":function(e,t,i){e.exports=i.p+"static/img/404_cloud.0f4bc32b.png"},"2c6f":function(e,t,i){},3016:function(e,t,i){"use strict";i("9af0")},3158:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{staticClass:"dialog-form",attrs:{width:"600px",title:e.dialogTitle,visible:e.dialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium","label-width":"90px",model:e.form,rules:e.rules}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12}},[i("el-form-item",{attrs:{label:"用戶賬號:",prop:"username"}},[i("el-input",{attrs:{placeholder:"請輸入賬號",width:"100%",disabled:2===e.editMove},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"用戶名:",prop:"showName"}},[i("el-input",{attrs:{placeholder:"請輸入賬號"},model:{value:e.form.showName,callback:function(t){e.$set(e.form,"showName",t)},expression:"form.showName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色:",prop:"roles"}},[i("el-select",{ref:"selectRole",attrs:{multiple:"",placeholder:"請選擇角色"},on:{change:e.changeRole},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roleList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),e._v(" "),i("el-col",{attrs:{sm:12}},[1===e.editMove?i("el-form-item",{attrs:{label:"密碼:",prop:"password"}},[i("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),e._v(" "),1===e.editMove?i("el-form-item",{attrs:{label:"確認密碼:",prop:"checkPass"}},[i("el-input",{attrs:{type:"password"},model:{value:e.form.checkPass,callback:function(t){e.$set(e.form,"checkPass",t)},expression:"form.checkPass"}})],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"配額(GB):"}},[i("el-input-number",{attrs:{"controls-position":"right",min:1,max:1073741824},model:{value:e.form.quota,callback:function(t){e.$set(e.form,"quota",t)},expression:"form.quota"}})],1)],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[2===e.editMove?i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.resetPassword()}}},[e._v("重置密碼")]):e._e(),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.userUpdateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.onSave()}}},[e._v("保 存")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card table-search-header"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("el-form",{ref:"queryForm",staticClass:"search-form",attrs:{size:"medium","label-width":"77px",model:e.queryCondition,rules:e.rules}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12,md:8}},[i("el-form-item",{attrs:{label:"用戶賬號:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.username,callback:function(t){e.$set(e.queryCondition,"username",t)},expression:"queryCondition.username"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:8}},[i("el-form-item",{attrs:{label:"用戶名:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.showName,callback:function(t){e.$set(e.queryCondition,"showName",t)},expression:"queryCondition.showName"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:8}},[i("div",{staticClass:"el-form-actions"},[i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.getUserList()}}},[e._v("查詢")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.add()}}},[e._v("添加")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{disabled:e.multipleSelection.length<1,size:"medium",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.handleSelectDelete()}}},[e._v("刪除")])],1)])],1)],1)],1)]),e._v(" "),i("table-list",{attrs:{tableData:e.userList,loading:e.loading,tableHeader:e.tableHeader,pagination:e.pagination},on:{pageChange:e.pageChange,sizeChange:e.pageChange,selectFun:e.selectFun,sortChange:e.sortChange}})],1)],1)},n=[],s=(i("ac6a"),i("c80c")),o=(i("96cf"),i("3b8d")),r=i("db72"),l=(i("7f7f"),i("6762"),i("2fdb"),i("c24f")),c=i("cc5e"),d=i("74e6"),u=i("7c83"),h={name:"cusomerManager",components:{TableList:u["a"],CropperDialog:d["a"]},props:{},data:function(){var e=this,t=function(t,i,a){""===i?a(new Error("請再次輸入密碼")):i!==e.form.password?a(new Error("兩次輸入密碼不一致!")):a()};return{title:"用戶管理",userList:[],loading:!1,roleList:[],dialogVisible:!1,dialogTitle:"",userUpdateLoading:!1,valid:!0,form:{username:"",password:"",showName:"",roles:[],checkPass:"",quota:10},pagination:{pageIndex:1,pageSize:15,pageTotal:0},queryCondition:{username:"",showName:"",sortProp:"",sortOrder:""},tableHeader:[{prop:"username",minWidth:110,label:"用戶賬號",sortable:"custom"},{prop:"showName",minWidth:100,label:"用戶名",sortable:"custom"},{prop:"roles",minWidth:120,label:"角色",tag:!0,formatData:function(t){if(t){var i=e.roleList.map((function(e){if(t.includes(e.id))return{name:e.name}}));return i=i.filter((function(e){return void 0!==e})),i}}},{prop:"quota",label:"配額(GB)",sortable:"custom"},{prop:"createTime",label:"創建時間",sortable:"custom"},{label:"操作",minWidth:130,active:[{name:"修改",icon:"el-icon-edit",handle:function(t){return e.handleEdit(t.id,t.username)}},{name:"刪除",icon:"el-icon-delete",color:"#ff4d4f",handle:function(t){return e.handleDelete([t.id])}}]}],multipleSelection:[],rules:{username:[{required:!0,message:"請輸入用戶賬號",trigger:"blur"}],showName:[{required:!0,message:"請輸入用戶名",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼不能小於6個字符",trigger:"blur"}],checkPass:[{required:!0,validator:t,trigger:"blur"}]},editMove:1}},computed:{},mounted:function(){this.getUserList(),this.getRoleList(),this.resize()},methods:{resize:function(){var e=document.querySelector(".container").clientWidth,t=e<=768;this.tableHeader[3].disabled=t,this.tableHeader[4].disabled=t},selectFun:function(e){this.multipleSelection=e.backData},sortChange:function(e){var t=e.backData;this.queryCondition.sortProp=t.prop,this.queryCondition.sortOrder=t.order,this.getUserList()},pageChange:function(e){this.pagination=e.backData,this.getUserList()},getUserList:function(){var e=this;this.loading=!0,Object(l["j"])(Object(r["a"])({page:this.pagination.pageIndex,pageSize:this.pagination.pageSize},this.queryCondition)).then((function(t){e.userList=t.data,e.pagination.pageTotal=t.count,e.loading=!1}))},getRoleList:function(){var e=this;c["a"].roleList().then((function(t){e.roleList=t.data}))},add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogVisible=!0,this.dialogTitle="添加用戶",this.editMove=1,this.form.showName="",e.next=6,this.$nextTick();case 6:this.$refs.managerForm.resetFields();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setFormData:function(){var e=new FormData;for(var t in this.form)this.form.hasOwnProperty(t)&&e.append(t,this.form[t]);return e.delete("createTime"),e.delete("updateTime"),e},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.userUpdateLoading=!0,1===e.editMove&&e.addUser(e.setFormData()),2===e.editMove&&e.userUpdate(e.setFormData())}))},handleEdit:function(e){var t=this;this.editMove=2,this.dialogVisible=!0,this.dialogTitle="修改用戶",Object(l["c"])({id:e}).then((function(e){if(t.form=e.data,t.form.roles){var i=t.roleList.map((function(e){if(t.form.roles.includes(e.id))return e.id}));i=i.filter((function(e){return void 0!==e})),t.form.roles=i}}))},changeRole:function(){this.$refs.selectRole.blur()},resetPassword:function(){var e=this;this.$confirm("確定重置該用戶密碼嗎, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(l["h"])(e.form.id).then((function(){})).catch((function(){e.onError()}))}))},handleSelectDelete:function(){var e=this;this.$confirm("確定要刪除選中的用戶嗎, 此操作會刪除用戶的所有文件?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=[];e.multipleSelection.forEach((function(e){t.push(e.id)})),e.deleteUser(t)}))},handleDelete:function(e){var t=this;this.$confirm("確定要刪除此用戶嗎？此操作會刪除用戶的所有文件","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteUser(e)}))},deleteUser:function(e){var t=this;Object(l["b"])({ids:e}).then((function(){t.onSuccess("刪除成功!")})).catch((function(){t.onError()}))},userUpdate:function(e){var t=this;Object(l["k"])(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},addUser:function(e){var t=this;Object(l["a"])(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},onSuccess:function(e){this.getUserList();var t="保存成功!";e&&(t=e),this.userUpdateLoading=!1,this.dialogVisible=!1,this.$message({message:t,type:"success",duration:1e3})},onError:function(){this.userUpdateLoading=!1}}},f=h,p=(i("bcb5"),i("2877")),m=Object(p["a"])(f,a,n,!1,null,"7cdaac0c",null);t["default"]=m.exports},3221:function(e,t,i){},"32d9":function(e,t,i){"use strict";i("f8fd")},"33d6":function(e,t,i){"use strict";i("bb52")},"347b":function(e,t,i){"use strict";i("f440")},"35c2":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-card",{staticClass:"box-card"},[i("a-affix",[i("div",{staticClass:"box-card-header"},[i("div",{staticClass:"clearfix card-header-back"},[e.subpage?e._e():i("div",[i("span",[e._v("外觀設置")]),e._v(" "),i("el-button",{staticClass:"card-button",attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.save()}}},[e._v("保存設置")])],1),e._v(" "),e.subpage?i("div",[i("div",{staticClass:"card-header-back"},[i("span",{staticClass:"header-back-title",on:{click:e.backParent}},[i("i",{staticClass:"el-icon-back"}),e._v(" "),i("span",[e._v("返回")])])])]):e._e()])])]),e._v(" "),e.subpage?e._e():i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"網站首頁",name:"1"}},[i("div",{staticClass:"config-itme-label"},[e._v("網站圖標：")]),e._v(" "),i("upload-image-input",{attrs:{desc:"只支持ico格式","enable-select":!1,"enable-url":!1,accept:"image/vnd.microsoft.icon"},model:{value:e.form.siteIco,callback:function(t){e.$set(e.form,"siteIco",t)},expression:"form.siteIco"}}),e._v(" "),i("span",{staticClass:"instruction"},[i("a",{attrs:{href:"http://www.favicon-icon-generator.com/",target:"_blank"}},[e._v("在線製作ico")])]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("站點名稱：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea",width:"100%"},model:{value:e.form.siteName,callback:function(t){e.$set(e.form,"siteName",t)},expression:"form.siteName"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("給您的網站取一個響亮的名字。")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("站點地址：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea",width:"100%"},model:{value:e.form.siteUrl,callback:function(t){e.$set(e.form,"siteUrl",t)},expression:"form.siteUrl"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("在這裏填入站點的地址或域名。例如："),i("a",{attrs:{href:"https://blog.jmal.top",target:"_blank"}},[e._v("https://blog.jmal.top")])]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("站點背景大圖：")]),e._v(" "),i("upload-image-input",{model:{value:e.form.backgroundSite,callback:function(t){e.$set(e.form,"backgroundSite",t)},expression:"form.backgroundSite"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在網站首頁顯示一個背景大圖。")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("首頁大圖內文字：\n          "),i("el-button",{attrs:{type:"text"},on:{click:e.heartwings}},[e._v("歷史記錄")])],1),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea"},model:{value:e.form.backgroundTextSite,callback:function(t){e.$set(e.form,"backgroundTextSite",t)},expression:"form.backgroundTextSite"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("顯示在博客首頁大圖內的描述。")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("首頁大圖內描述：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea"},model:{value:e.form.backgroundDescSite,callback:function(t){e.$set(e.form,"backgroundDescSite",t)},expression:"form.backgroundDescSite"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("顯示在博客首頁大圖內的描述。")])],1),e._v(" "),i("el-tab-pane",{attrs:{label:"導航欄",name:"2"}},[i("div",{staticClass:"config-itme-label"},[e._v("導航欄頂部 - 網站 Logo：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea",width:"100%"},model:{value:e.form.siteLogo,callback:function(t){e.$set(e.form,"siteLogo",t)},expression:"form.siteLogo"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("配置網站的 Logo，該選項僅作用於頂部導航條")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("導航欄操作按鈕：")]),e._v(" "),i("el-input",{attrs:{type:"textarea",width:"100%",autosize:{minRows:1,maxRows:6}},on:{input:e.preview},model:{value:e.form.operatingButtons,callback:function(t){e.$set(e.form,"operatingButtons",t)},expression:"form.operatingButtons"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("\n          一個操作按鈕包含兩個部分：\n          "),i("a",{attrs:{href:"https://fontawesome.com/icons?d=gallery",target:"_blank"}},[e._v("Font-awesome")]),e._v("\n          圖標標籤和鏈接，使用'：'隔開(標籤裏的內容爲該圖標的簡述)。\n          "),i("br"),e._v("\n          列如："+e._s(e.example)+":https://github.com/jamebal (建議不超過5項)\n        ")]),e._v(" "),i("div",[i("el-divider",{attrs:{"content-position":"center"}},[e._v("預覽")]),e._v(" "),i("ul",{staticClass:"navbar-nav side-toolbar-list"},e._l(e.operatingButtons,(function(t){return i("li",[i("a",{attrs:{href:t.url,title:t.title,target:"_blank"}},[i("dl",{domProps:{innerHTML:e._s(t.fontHtml)}},[e._v("\n                  "+e._s(t.fontHtml)+"\n                ")])])])})),0)],1)],1),e._v(" "),i("el-tab-pane",{attrs:{label:"歸檔、分類、標籤",name:"3"}},[i("div",{staticClass:"config-itme-label"},[e._v("頁面顯示與否：")]),e._v(" "),i("el-checkbox-group",{model:{value:e.form.alonePages,callback:function(t){e.$set(e.form,"alonePages",t)},expression:"form.alonePages"}},[i("el-checkbox",{attrs:{label:"archives"}},[e._v("歸檔")]),e._v(" "),i("el-checkbox",{attrs:{label:"categories"}},[e._v("分類")]),e._v(" "),i("el-checkbox",{attrs:{label:"tags"}},[e._v("標籤")])],1),e._v(" "),i("span",{staticClass:"instruction"},[e._v("選中項會顯示在導航欄中")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("歸檔界面背景大圖：")]),e._v(" "),i("upload-image-input",{model:{value:e.form.archiveBackground,callback:function(t){e.$set(e.form,"archiveBackground",t)},expression:"form.archiveBackground"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在歸檔頁面顯示一個背景大圖。")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("分類界面背景大圖：")]),e._v(" "),i("upload-image-input",{model:{value:e.form.categoryBackground,callback:function(t){e.$set(e.form,"categoryBackground",t)},expression:"form.categoryBackground"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在分類頁面顯示一個背景大圖。")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("標籤界面背景大圖：")]),e._v(" "),i("upload-image-input",{model:{value:e.form.tagBackground,callback:function(t){e.$set(e.form,"tagBackground",t)},expression:"form.tagBackground"}}),e._v(" "),i("span",{staticClass:"instruction"},[e._v("在這裏填入圖片的URL地址, 以在分類頁面顯示一個背景大圖。")])],1),e._v(" "),i("el-tab-pane",{attrs:{label:"網站頁腳",name:"4"}},[i("div",{staticClass:"config-itme-label"},[e._v("版權信息：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea",width:"100%"},model:{value:e.form.copyright,callback:function(t){e.$set(e.form,"copyright",t)},expression:"form.copyright"}}),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("備案許可號：")]),e._v(" "),i("el-input",{attrs:{autosize:"",type:"textarea",width:"100%"},model:{value:e.form.recordPermissionNum,callback:function(t){e.$set(e.form,"recordPermissionNum",t)},expression:"form.recordPermissionNum"}})],1)],1),e._v(" "),e.subpage?i("div",{staticClass:"list-body"},[i("table-list",{ref:"tableList",attrs:{"less-client-height":280,tableData:e.dataList,loading:e.heartwingsLoading,hasSelection:!1,tableHeader:e.tableHeader,pagination:e.pagination},on:{pageChange:e.pageChange,sizeChange:e.pageChange,sortChange:e.sortChange}})],1):e._e()],1)],1)},n=[],s=(i("a481"),i("4917"),i("28a5"),i("ac6a"),i("7f7f"),i("9bf0")),o=i("f406"),r=i("7c83"),l={name:"blogManager",components:{UploadImageInput:o["a"],TableList:r["a"]},data:function(){return{subpage:!1,activeName:"1",example:'<i class="fab fa-github">github</i>',form:{siteUrl:"",backgroundSite:"",backgroundTextSite:"",backgroundDescSite:"",siteIco:"",siteName:"",siteLogo:"",operatingButtons:"",categoryBackground:"",archiveBackground:"",tagBackground:"",alonePages:[],copyright:"",recordPermissionNum:""},operatingButtons:[],dataList:[],heartwingsLoading:!1,tableHeader:[{prop:"heartwings",label:"心語",minWidth:450},{prop:"username",label:"賬號",minWidth:110},{prop:"createTime",label:"創建時間",minWidth:110,sortable:"custom"}],queryCondition:{sortProp:"",sortOrder:"descending"},pagination:{pageIndex:1,pageSize:15,pageTotal:0}}},computed:{},mounted:function(){this.getSetting(),this.$route.query.tab&&(this.activeName=this.$route.query.tab)},methods:{backParent:function(){this.subpage=!1},heartwings:function(){this.subpage=!0,this.heartwingsLoading=!0,this.getHeartwingsList()},getHeartwingsList:function(){var e=this;Object(s["b"])({page:this.pagination.pageIndex,pageSize:this.pagination.pageSize,order:this.queryCondition.sortOrder}).then((function(t){e.dataList=t.data,e.heartwingsLoading=!1,e.pagination.pageTotal=t.count})).catch((function(){e.heartwingsLoading=!1}))},pageChange:function(e){this.pagination=e.backData,this.getHeartwingsList()},sortChange:function(e){var t=e.backData;this.queryCondition.sortProp=t.prop,this.queryCondition.sortOrder=t.order,this.getHeartwingsList()},handleClick:function(e){this.$router.push({query:{tab:e.name}})},preview:function(){var e=this;this.operatingButtons=[],this.form.operatingButtons&&this.form.operatingButtons.split(/[\n]/).forEach((function(t){var i={},a=t.indexOf(":"),n=t.substring(0,a),s=/[^><]+(?=<\/i>)/gim,o=n.match(s);i.title=o?o[0]:"",i.fontHtml=n.replace(s,""),i.url=t.substring(a+1,t.length),e.operatingButtons.push(i)}))},getSetting:function(){var e=this;Object(s["c"])({userId:this.$store.state.user.userId}).then((function(t){t.data&&(e.form=t.data,e.preview())})).catch((function(){}))},save:function(){var e=this;this.form.userId=this.$store.state.user.userId,Object(s["e"])(this.form).then((function(){e.$message.success("保存成功！")})).catch((function(){}))}}},c=l,d=(i("7ea3"),i("2877")),u=Object(d["a"])(c,a,n,!1,null,"447129d8",null);t["default"]=u.exports},"35d8":function(e,t,i){"use strict";i("63cb")},"3ceb":function(e,t,i){},4072:function(e,t,i){"use strict";i("3ceb")},"42f3":function(e,t,i){},4308:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"edit-div",contenteditable:e.canEdit},domProps:{innerHTML:e._s(e.innerText)},on:{focus:function(t){e.isLocked=!0},blur:function(t){e.isLocked=!1},input:e.changeText}})},n=[],s={name:"EditElement",props:{value:{type:String,default:""},canEdit:{type:Boolean,default:!0}},data:function(){return{innerText:"",isLocked:!1}},watch:{value:function(e){this.isLocked||(this.innerText=e,document.getElementById("edit-div").innerHTML=e)}},methods:{changeText:function(){this.$emit("input",this.$el.innerHTML)}}},o=s,r=(i("b47a"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,null,null);t["default"]=l.exports},"466a":function(e,t,i){"use strict";i("0db8")},"488d":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"resize",rawName:"v-resize",value:e.containerResize,expression:"containerResize"}],staticClass:"dashboard-container"},[i("transition",{attrs:{name:"fade"}},[e.isLoading?i("al-loading"):e._e()],1),e._v(" "),i("div",{staticClass:"share-h"},[i("div",{staticClass:"share-header"},[i("div",{staticClass:"share-header-content logo"},[i("Logo",{attrs:{width:"35"},model:{value:e.netdiskLogo,callback:function(t){e.netdiskLogo=t},expression:"netdiskLogo"}}),e._v(" "),i("span",[e._v(e._s(e.netdiskName))])],1),e._v(" "),i("div",{staticClass:"share-header-content sharer"},[i("span",[i("span",{staticClass:"user"},[e._v(e._s(e.sharer.showName))]),e._v("的分享")]),e._v(" "),i("el-avatar",{attrs:{src:e.sharerAvatarUrl}})],1)]),e._v(" "),i("el-divider",{staticClass:"header-location"}),e._v(" "),e.linkFailed?e._e():i("el-breadcrumb",{staticClass:"app-breadcrumb",attrs:{separator:""}},[i("transition-group",{attrs:{name:"breadcrumb"}},e._l(e.pathList,(function(t,a){return i("el-breadcrumb-item",{key:t.index},[0===a?i("span",[e._v("當前位置:")]):e._e(),e._v(" "),i("breadcrumb-file-path",{attrs:{pathList:e.pathList,item:t,index:a},on:{clickLink:e.handleLink}})],1)})),1),e._v(" "),i("div",{staticClass:"search-content"},[i("div",{staticClass:"search-class"},[e.indexList.length>0?i("el-button",{staticClass:"sort",attrs:{type:"text",title:"下載"},on:{click:function(t){return e.downloadFile(!1)}}},[i("svg-icon",{attrs:{"icon-class":"menu-download"}})],1):e._e(),e._v(" "),i("el-button",{staticClass:"vmode",attrs:{type:"text"},on:{click:e.changeVmode}},[i("svg-icon",{attrs:{"icon-class":e.grid?"list":"grid"}})],1)],1)])],1)],1),e._v(" "),i("e-vue-contextmenu",{ref:"contextShow",staticClass:"newFileMenu",class:e.menuTriangle,on:{"ctx-show":e.show,"ctx-hide":e.hide}},[i("div",{staticClass:"popper-arrow"}),e._v(" "),e._l(e.menus,(function(t){return i("ul",{key:t.label},[i("li",{staticClass:"menu-option",on:{click:function(i){return e.menusOperations(t.operation)}}},[i("label",{staticClass:"menuitem"},[i("svg-icon",{attrs:{"icon-class":t.iconClass}}),i("span",{staticClass:"menuitem text"},[e._v(e._s(t.label))])],1)])])}))],2),e._v(" "),i("el-table",{directives:[{name:"show",rawName:"v-show",value:!e.grid&&!e.linkFailed,expression:"!grid && !linkFailed"},{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"fileListTable",staticStyle:{width:"100%",margin:"20px 0 0 0"},attrs:{"empty-text":"無文件",data:e.fileList,"row-key":"id","summary-method":e.getSummaries,"show-summary":"","cell-style":e.rowRed,"row-class-name":e.tableRowClassName,"element-loading-text":"文件加載中","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{"selection-change":e.handleSelectionChange,"row-contextmenu":e.rowContextmenu,"cell-click":e.cellClick,"cell-mouse-enter":e.cellMouseEnter,"cell-mouse-leave":e.cellMouseLeave}},[e._l(e.tableHead,(function(t,a){return[0===a?i("el-table-column",{key:a,attrs:{index:a,type:"selection","min-width":"50"}}):e._e(),e._v(" "),1===a?i("el-table-column",{key:a,attrs:{index:a,width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("icon-file",{attrs:{item:t.row,"image-url":e.imageUrl,public:!0}})]}}],null,!0)}):e._e(),e._v(" "),2===a?i("el-table-column",{key:a,attrs:{"show-overflow-tooltip":!0,"max-width":"200",index:a,prop:t.name,label:t.label,sortable:t.sortable},on:{click:function(t){return t.stopPropagation(),e.fileClick(e.scope.row)}},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.editingIndex?i("el-col",{attrs:{span:10}},[i("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"",size:"small",clearable:!0},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.rowRename(e.renameFileName,t.row)}},model:{value:e.renameFileName,callback:function(t){e.renameFileName=t},expression:"renameFileName"}}),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.renameLoading,expression:"renameLoading"}],staticClass:"el-icon-check",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(i){return e.rowRename(e.renameFileName,t.row)}}}),e._v(" "),i("el-button",{staticClass:"el-icon-close",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(t){e.editingIndex=-1}}})],1):i("span",{staticClass:"table-file-name"},[e._v(e._s(t.row.name))])]}}],null,!0)}):e._e(),e._v(" "),3===a&&e.showUpdateDateItem?i("el-table-column",{key:a,attrs:{width:"50",index:a,align:"center","header-align":"center"}}):e._e(),e._v(" "),4===a&&e.showUpdateDateItem?i("el-table-column",{key:a,staticClass:"el-icon-more",attrs:{width:"50",prop:t.name,label:t.label,index:a,align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.cellMouseIndex?i("svg-icon",{staticClass:"button-class",attrs:{"icon-class":"more"},on:{click:function(i){return e.moreClick(t.row,i)}}}):e._e()]}}],null,!0)},[i("template",{slot:"header"},[""!==t.name?i("svg-icon",{staticClass:"button-class",attrs:{"icon-class":"more"},on:{click:function(t){return e.moreOperation(t)}}}):e._e()],1)],2):e._e(),e._v(" "),5===a&&e.showSizeItem?i("el-table-column",{key:a,attrs:{width:"200",prop:t.name,index:a,label:t.label,sortable:t.sortable,"show-overflow-tooltip":!0,align:"left","header-align":"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.formatSize(t.row.size)))])]}}],null,!0)}):e._e(),e._v(" "),6===a&&e.showUpdateDateItem?i("el-table-column",{key:a,attrs:{width:"300",prop:t.name,index:a,label:t.label,sortable:t.sortable,"show-overflow-tooltip":!0,align:"left","header-align":"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.updateDate))])]}}],null,!0)}):e._e()]}))],2),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.grid&&!e.linkFailed,expression:"grid && !linkFailed"},{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"文件加載中","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"}},[i("div",{staticClass:"checkbox-group-header"},[i("van-checkbox",{staticClass:"grid-all-checkbox",on:{click:function(t){return e.clickGridAllCheckBox()}},model:{value:e.allChecked,callback:function(t){e.allChecked=t},expression:"allChecked"}},[e._v(e._s(e.indexList.length>0?"已選擇 "+this.tableHead[2].label:"選擇"))]),e._v(" "),i("el-divider")],1),e._v(" "),i("van-checkbox-group",{ref:"checkboxGroup",on:{change:e.handleSelectionChange},model:{value:e.selectRowData,callback:function(t){e.selectRowData=t},expression:"selectRowData"}},[i("van-grid",{attrs:{square:"","column-num":e.gridColumnNum,gutter:10,border:!1}},e._l(e.fileList,(function(t,a){return i("van-grid-item",{key:t.id,ref:"gridItem",refInFor:!0},[i("div",{staticClass:"grid-time van-grid-item__content van-grid-item__content--center van-grid-item__content--square",style:{background:e.indexList.includes(a)?"#baebff91":"",cursor:e.indexList.length>0?"default":"pointer"},on:{mouseover:function(i){return e.gridItemHover(t,a)},mouseout:function(i){return e.gridItemOut(t,a)},click:function(i){return e.gridItemClick(t,i)},contextmenu:function(i){return i.preventDefault(),e.rowContextmenu(t)}}},[i("van-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.gridHoverItemIndex===a||e.indexList.includes(a),expression:"gridHoverItemIndex === index || indexList.includes(index)"}],staticClass:"grid-item-checkbox",attrs:{name:t},on:{click:function(i){return i.stopPropagation(),e.clickGridItemCheckBox(t,a)}}}),e._v(" "),i("div",{staticClass:"grid-item-icon"},[i("icon-file",{attrs:{item:t,"image-url":e.imageUrl,grid:!0,"grid-width":e.gridColumnWidth,public:!0}})],1),e._v(" "),i("span",{staticClass:"grid-item-text"},[e._v(e._s(t.name))])],1)])})),1)],1)],1),e._v(" "),e.linkFailed?i("div",{staticClass:"share-header"},[""!==e.prompt?i("p",[e._v("溫馨提示：")]):e._e(),e._v(" "),i("p",[e._v(e._s(e.prompt))])]):e._e(),e._v(" "),i("sim-text-preview",{attrs:{file:e.textPreviewRow,shareId:e.shareId,status:e.textPreviewVisible},on:{"update:file":function(t){e.textPreviewRow=t},"update:status":function(t){e.textPreviewVisible=t}}}),e._v(" "),i("image-viewer",{attrs:{fileList:e.fileList,shareId:e.shareId,file:e.imagePreviewRow,status:e.imagePreviewVisible},on:{"update:status":function(t){e.imagePreviewVisible=t}}}),e._v(" "),i("video-preview",{attrs:{file:e.videoPreviewRow,shareId:e.shareId,status:e.videoPreviewVisible},on:{"update:status":function(t){e.videoPreviewVisible=t}}}),e._v(" "),i("office-preview",{attrs:{file:e.officePreviewRow,shareId:e.shareId,status:e.officePreviewVisible},on:{"update:status":function(t){e.officePreviewVisible=t}}}),e._v(" "),i("el-divider",{staticClass:"grid-divider",attrs:{"content-position":"center"}},[i("i",{staticClass:"el-icon-folder-opened"}),e._v(" "+e._s(e.summaries))]),e._v(" "),i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","hide-on-single-page":!0,"current-page":e.pagination.pageIndex,"page-sizes":e.pagination.pageSizes,"page-size":e.pagination.pageSize,total:e.pagination.total},on:{"update:currentPage":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageIndex",t)},"current-change":e.currentChange}})],1)},n=[],s=(i("f559"),i("7f7f"),i("2d63")),o=(i("ac6a"),i("28a5"),i("20d6"),i("6762"),i("2fdb"),i("db72")),r=i("2f62"),l=i("7f29"),c=i("9dce"),d=i("5cfc"),u=i("573f"),h=i("0dcf"),f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"loading"})},p=[],m={name:"AlLoading"},g=m,v=(i("cbbd"),i("2877")),b=Object(v["a"])(g,f,p,!1,null,"913373be",null),w=b.exports,y=i("1000"),x=i("2d53"),C=i("1638"),k=i("ae1f"),_=i("140f"),L=i("2690"),S=i("b311"),I=i.n(S),F=i("fd35"),T=i("1383"),D={components:{Logo:T["a"],OfficePreview:F["a"],IconFile:h["a"],BreadcrumbFilePath:u["a"],AlLoading:w,AudioPreview:_["a"],VideoPreview:k["a"],ImageViewer:C["a"],SimTextPreview:x["a"]},data:function(){return{prompt:"文件分享已被撤銷",isLoading:!0,imageUrl:"/api/public/s/view/thumbnail?id=",fileMenuActive:"",path:this.$route.query.path,showNewFolder:!1,isShowNewFolder:!1,listModeSearch:!1,newFolderName:"新建文件夾",renameFileName:"",searchFileName:"",pathList:[],fileList:[],pagination:{fileId:!1,pageIndex:1,pageSize:256,total:0,pageSizes:[10,20,30,40,50]},indexList:[],clientHeight:500,tableHead:[{name:"",label:"",index:0},{name:"",label:"",index:1},{name:"name",label:"名稱",sortable:!0,index:2},{name:"",label:"",index:3},{name:"",label:"",more:!0,index:4},{name:"size",label:"大小",sortable:!0,index:5},{name:"updateDate",label:"修改日期",sortable:!0,index:6}],isJustHideMenus:!1,menusIsMultiple:!1,menus:[],singleMenus:[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-fuzhi",label:"複製下載連接",operation:"copyDownloadUrl"}],singleMenusEdit:[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-fuzhi",label:"複製下載連接",operation:"copyDownloadUrl"}],multipleMenus:[{iconClass:"menu-download",label:"下載",operation:"download"}],multipleRightMenus:[{iconClass:"menu-download",label:"下載",operation:"download"}],rowContextData:{},selectRowData:[],tableLoading:!1,newFolderLoading:!1,renameLoading:!1,menuTriangle:"",cellMouseIndex:-1,editingIndex:-1,dialogMoveOrCopyVisible:!1,directoryTreeData:[],selectTreeNode:{},directoryTreeProps:{label:"name",children:"children",isLeaf:"isLeaf"},dragLoop:null,positionX:0,positionY:0,grid:!1,vmode:"list",gridColumnNum:-1,gridColumnWidth:120,gridHoverItemIndex:-1,gridHoverIntermediate:-1,allChecked:!1,summaries:"",shareDialog:!1,shareLink:"",shareFileName:"",generateShareLinkLoading:!0,shareId:this.$route.query.s,currentDirName:"",linkFailed:!0,textPreviewVisible:!1,textPreviewRow:{},imagePreviewRow:{},imagePreviewVisible:!1,videoPreviewRow:{},videoPreviewVisible:!1,officePreviewRow:{},officePreviewVisible:!1,audioPreviewRow:{},audioPreviewVisible:!1,showUpdateDateItem:this.$pc,showSizeItem:this.$pc,sharer:{},sharerAvatarUrl:"",netdiskName:"JmalCloud",netdiskLogo:""}},computed:Object(o["a"])(Object(o["a"])({},Object(r["b"])(["name"])),{},{netdiskLogo:function(){return this.$store.state.user.netdiskLogo?this.$store.state.user.netdiskLogo:""}}),created:function(){this.getFileList()},mounted:function(){var e=this;c["a"].$on("fileSuccess",(function(){e.getFileList()})),c["a"].$on("clickMore",(function(t){e.selectRowData=t,e.preliminaryRowData()})),window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1));var t=this;window.onresize=function(){t.loadClientHeight()},this.$route.query.vmode&&(this.vmode=this.$route.query.vmode,this.grid="list"!==this.vmode)},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1)},directives:{focus:{inserted:function(e){e.querySelector("input").focus()}},resize:{bind:function(e,t){var i="",a="";function n(){var n=document.defaultView.getComputedStyle(e);i===n.width&&a===n.height||t.value(),i=n.width,a=n.height}e.__vueSetInterval__=setInterval(n,300)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},methods:{loadClientHeight:function(){this.clientHeight=document.documentElement.clientHeight-200},gridItemHover:function(e,t){this.gridHoverItemIndex=t,this.gridHoverIntermediate=t},gridItemOut:function(e,t){this.gridHoverIntermediate=-1;var i=this;setTimeout((function(){i.gridHoverIntermediate!==i.gridHoverItemIndex&&(i.gridHoverItemIndex=-1)}),10)},clickGridItemCheckBox:function(e,t){this.indexList.includes(t)&&this.$refs.fileListTable.toggleRowSelection(e,!0)},clickGridAllCheckBox:function(){this.indexList.length!==this.fileList.length?this.$refs.checkboxGroup.toggleAll(!0):(this.$refs.checkboxGroup.toggleAll(),this.$refs.fileListTable.clearSelection())},gridItemClick:function(e,t){var i=t.path||t.composedPath&&t.composedPath(),a=i.findIndex((function(e){return"grid-item-checkbox van-checkbox"===e.className}));a>-1||(this.indexList.length<1?e.index!==this.editingIndex&&(this.fileClick(e),this.editingIndex=-1):this.indexList.includes(e.index)?this.$refs.fileListTable.toggleRowSelection(e,!1):this.$refs.fileListTable.toggleRowSelection(e,!0))},containerResize:function(){var e=document.querySelector(".dashboard-container").clientWidth;this.gridColumnNum=Math.round((e-10)/135),this.gridColumnWidth=(e-11*this.gridColumnNum)/this.gridColumnNum-4.5},formatTime:function(e){return Object(l["c"])(e)},formatSize:function(e){return Object(l["b"])(e)},goBack:function(){var e=this.pathList.length-3;this.handleLink(this.pathList[e],e)},handleLink:function(e,t){0===t&&(this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1)),this.getFileList(null,!0),this.$router.push("/s?s=".concat(this.shareId,"&vmode=").concat(this.vmode))),e&&e.fileId&&(this.accessShareOpenDir(e.fileId),this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1)))},changeVmode:function(){this.grid=!this.grid,this.vmode="list",this.grid&&(this.vmode="grid");this.$router.push("/s?s=".concat(this.shareId,"&vmode=").concat(this.vmode))},accessShareOpenDir:function(e){var t=this;this.tableLoading=!0,d["a"].accessShareOpenDir({share:this.shareId,fileId:e,pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(i){t.isLoading=!1,t.fileList=i.data,t.loadClientHeight(),t.listModeSearch=!0,t.pagination.fileId=e,t.pagination["total"]=i.count,t.$nextTick((function(){t.containerResize(),t.tableLoading=!1,t.linkFailed=!1}))})).catch((function(e){}))},getFileList:function(e,t){var i=this;this.tableLoading=!0,d["a"].accessShare({share:this.shareId,pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(a){if(i.isLoading=!1,Object.getPrototypeOf(a.data)===String.prototype)i.prompt="該鏈接已失效";else{if(i.fileList=a.data,i.fileList.map((function(e,t){e.index=t})),i.fileList.length>0&&d["a"].getSharer({userId:i.fileList[0].userId}).then((function(e){i.sharer=e.data,i.sharerAvatarUrl=i.imageUrl+e.data.avatar,i.sharer.netdiskName&&(i.netdiskName=i.sharer.netdiskName),i.sharer.netdiskLogo&&(i.netdiskLogo=i.sharer.netdiskLogo),i.$store.dispatch("user/setLogo",{netdiskName:i.netdiskName,netdiskLogo:i.netdiskLogo})})),i.loadClientHeight(),i.listModeSearch=!1,i.listModeSearchOpenDir=!1,i.pagination["total"]=a.count,i.$nextTick((function(){i.containerResize(),i.tableLoading=!1,i.linkFailed=!1})),!e){var n=i.fileList[0].path.split("/");i.currentDirName=n[n.length-2]}i.$nextTick((function(){if(i.containerResize(),i.tableLoading=!1,i.linkFailed=!1,!e){var a={};a["folder"]=i.currentDirName,a["index"]=i.pathList.length,t||i.pathList.push(a)}}))}})).catch((function(){i.tableLoading=!1,i.linkFailed=!0}))},currentChange:function(e){this.pagination.pageIndex=e,this.pagination.fileId?this.accessShareOpenDir(this.pagination.fileId):this.getFileList(!0)},getSummaries:function(e){var t=[];return t[2]=this.getShowSumFileAndFolder(this.fileList),this.summaries=t[2],t},getShowSumFileAndFolder:function(e){var t=0,i=0,a=0;e.forEach((function(e){e.isFolder?t+=1:i+=1,a+=e.size}));var n="";t>0&&(n=t+"個文件夾");var s="";return i>0&&(s=i+"個文件"),n+" "+s+this.getShowSumSize(a)},getShowSumSize:function(e){var t="";return e>0&&(t="  共"),t+=e<1024?e+"B":e>=1024&&e<1048576?(e/1024).toFixed(2)+"K":e>=1048576&&e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G",t},handleSelectionChange:function(e){var t=this;this.selectRowData=e;var i=0;this.indexList=[];var a,n=Object(s["a"])(e);try{for(n.s();!(a=n.n()).done;){var o=a.value;i+=o.size,this.indexList.push(o.index)}}catch(f){n.e(f)}finally{n.f()}e.forEach((function(e){t.$refs.fileListTable.toggleRowSelection(e,!0)}));var r=this.tableHead[2],l=this.tableHead[4],c=this.tableHead[5],d=this.tableHead[6];if(this.selectRowData.length>0){var u=this.getShowSumFileAndFolder(e),h=this.getShowSumSize(i);r.label=u,r.sortable=!1,l.name="more",c.label=h,c.sortable=!1,d.label="",d.sortable=!1,this.menusIsMultiple=!0,this.rowContextData=e[0]}else r.label="名稱",r.sortable=!0,l.name="",c.label="大小",c.sortable=!0,d.label="修改日期",d.sortable=!0;this.indexList.length===this.fileList.length?this.allChecked=!0:this.allChecked=!1},rowRed:function(e){e.row,e.column;var t=e.rowIndex,i=e.columnIndex;if(this.indexList.length<1&&2===i&&this.cellMouseIndex===t)return{cursor:"pointer",color:"#19ACF9"};for(var a=0;a<this.indexList.length;a++)if(t===this.indexList[a])return{backgroundColor:"#baebff91",cursor:"default"}},tableRowClassName:function(e){var t=e.row,i=e.rowIndex;t.index=i},preliminaryRowData:function(e){e&&(this.rowContextData=e);this.rowContextData.isFavorite},cellMouseEnter:function(e){-1===this.editingIndex&&this.indexList.length<1&&(this.cellMouseIndex=e.index)},cellMouseLeave:function(){this.cellMouseIndex=-1},cellClick:function(e,t){if(clearTimeout(this.Loop),-1===this.editingIndex){var i=t.index;0===i&&this.$refs.fileListTable.toggleRowSelection(e),2===i&&this.indexList.length<1&&e.index!==this.editingIndex&&(this.fileClick(e),this.editingIndex=-1),this.indexList.length>0&&i>0&&this.$refs.fileListTable.toggleRowSelection(e)}},moreOperation:function(e){this.menusIsMultiple=!0,this.menus=this.multipleMenus,this.showOperationMenus(e)},moreClick:function(e,t){this.menusIsMultiple=!1,e.contentType&&e.contentType.includes("text")?this.menus=this.singleMenusEdit:this.menus=this.singleMenus,this.preliminaryRowData(e),this.showOperationMenus(t)},rowContextmenu:function(e){this.indexList.includes(e.index)?(this.menusIsMultiple=!0,this.menus=this.multipleRightMenus):(this.menusIsMultiple=!1,e.contentType&&e.contentType.includes("text")?this.menus=this.singleMenusEdit:this.menus=this.singleMenus,this.preliminaryRowData(e)),event.preventDefault(),this.menuTriangle="";var t={};t.pageX=event.pageX+5,t.pageY=event.pageY+2,t.clientX=event.clientX+5,t.clientY=event.clientY+2,this.$refs.contextShow.showMenu(event)},showOperationMenus:function(e){var t={};document.body.scrollHeight-e.pageY>400?(this.menuTriangle="menu-triangle-top",t.pageX=e.pageX-78,t.pageY=e.pageY+30,t.clientX=e.clientX+78,t.clientY=e.clientY+30):(this.menuTriangle="menu-triangle-bottom",t.pageX=e.pageX-78,t.pageY=e.pageY-350,t.clientX=e.clientX+78,t.clientY=e.clientY-350),this.isJustHideMenus||this.$refs.contextShow.showMenu(t)},show:function(){},hide:function(){var e=this;this.isJustHideMenus=!0,setTimeout((function(){e.isJustHideMenus=!1}),100)},menusOperations:function(e){switch(e){case"open":this.fileClick(this.rowContextData);break;case"download":this.downloadFile();break;case"copyDownloadUrl":this.downloadFile(!0);break}this.$refs.contextShow.hideMenu()},downloadFile:function(e){var t=0;if(this.indexList.length>0?this.selectRowData.forEach((function(e){t+=e.size})):t=this.rowContextData.size,t>0){var i=[];if(this.menusIsMultiple?this.selectRowData.forEach((function(e){i.push(e.id)})):i.push(this.rowContextData.id),i.length>1||this.rowContextData.isFolder)return void(e?this.copyDownloadLink(L["a"].publicPackageDownloadUrl(this.shareId,i)):L["a"].publicPackageDownload(this.shareId,i));e?this.rowContextData.isShare?this.copyDownloadLink(window.location.origin+L["a"].previewUrl(this.sharer.username,this.rowContextData)):this.copyDownloadLink(L["a"].publicPackageDownloadUrl(this.shareId,i)):L["a"].publicDownload(this.shareId,this.rowContextData)}else this.$message({message:"所選文件爲空",type:"warning"})},copyDownloadLink:function(e){var t=this,i=new I.a(".menu-option",{text:function(){return e}});i.on("success",(function(e){t.$message({message:"複製成功",type:"success",duration:1e3}),i.destroy()})),i.on("error",(function(e){t.$message({message:"該瀏覽器不支持自動複製",type:"warning",duration:1e3}),i.destroy()}))},fileClick:function(e){if(window.shareId=this.shareId,e.isFolder){var t={};t["folder"]=e.name,t["fileId"]=e.id,t["index"]=this.pathList.length,this.pathList.push(t),this.pagination.pageIndex=1,this.$router.push("/s?s=".concat(this.shareId,"&vmode=").concat(this.vmode)),this.accessShareOpenDir(e.id)}else{if(e.contentType.startsWith("image"))return this.imagePreviewVisible=!0,void(this.imagePreviewRow=e);if(y["c"].simText.includes(e.suffix))return this.textPreviewRow=e,void(this.textPreviewVisible=!0);if(e.contentType.indexOf("video")>-1)return this.videoPreviewVisible=!0,void(this.videoPreviewRow=e);if(e.contentType.indexOf("audio")>-1)return void c["a"].$emit("onAddAudio",e,this.audioCoverUrl);if(e.contentType.indexOf("office")>-1||["pdf","csv","drawio","mind"].includes(e.suffix))return this.officePreviewVisible=!0,void(this.officePreviewRow=e);L["a"].publicPreview(e.id,this.shareId)}}}},$=D,N=(i("a0a2"),Object(v["a"])($,a,n,!1,null,"3877040c",null));t["default"]=N.exports},"4d8d":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-card",{staticClass:"box-card table-search-header"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("el-form",{ref:"queryForm",staticClass:"search-form",attrs:{size:"medium","label-width":"77px",model:e.queryCondition},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-row",{attrs:{gutter:10}},[e.isLoginType?e._e():i("el-col",{attrs:{sm:12,md:e.isLoginType?8:4}},[i("el-form-item",{attrs:{label:"日誌類型:"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.isLoginType,placeholder:"請選擇日誌類型"},on:{change:e.selectType},model:{value:e.typeValue,callback:function(t){e.typeValue=t},expression:"typeValue"}},e._l(e.options,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:e.isLoginType?8:5}},[i("el-form-item",{attrs:{label:"賬號:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.username,callback:function(t){e.$set(e.queryCondition,"username",t)},expression:"queryCondition.username"}})],1)],1),e._v(" "),e.isLoginType?e._e():i("el-col",{attrs:{sm:12,md:e.isLoginType?8:5}},[i("el-form-item",{attrs:{label:"ip:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.ip,callback:function(t){e.$set(e.queryCondition,"ip",t)},expression:"queryCondition.ip"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:e.isLoginType?8:5}},[i("el-form-item",{attrs:{label:"時間:",prop:"logTime"}},[i("el-date-picker",{attrs:{size:"medium",type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"開始日期","end-placeholder":"結束日期",align:"right"},model:{value:e.pickerValue,callback:function(t){e.pickerValue=t},expression:"pickerValue"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:e.isLoginType?8:5}},[i("div",{staticClass:"el-form-actions"},[i("el-radio-group",{attrs:{size:"medium"},on:{change:e.queryLogList},model:{value:e.queryCondition.excludeUsername,callback:function(t){e.$set(e.queryCondition,"excludeUsername",t)},expression:"queryCondition.excludeUsername"}},[i("el-radio-button",{attrs:{label:void 0}},[e._v("所有人")]),e._v(" "),i("el-radio-button",{attrs:{label:"other"}},[e._v("其他人")])],1),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-search",type:"primary"},on:{click:e.queryLogList}},[e._v("查詢\n                ")])],1)])],1)],1)],1)]),e._v(" "),i("table-list",{ref:"tableList",attrs:{"less-client-height":245,tableData:e.dataList,loading:e.loading,hasSelection:!1,tableHeader:e.tableHeader,"page-index":e.pageIndex,pagination:e.pagination},on:{pageChange:e.pageChange,sizeChange:e.pageChange,sortChange:e.sortChange}})],1)],1)},n=[],s=i("db72"),o=i("b775"),r=(i("4328"),{logList:function(e){return Object(o["a"])({url:"/log/list",method:"get",params:e})}}),l=i("7c83"),c={name:"LogList",components:{TableList:l["a"]},props:{type:{type:String,default:""},tableHeader:{type:Array,default:[]}},data:function(){return{dataList:[],loading:!1,pageIndex:1,pagination:{pageIndex:1,pageSize:10,pageTotal:0},options:[{value:"LOGIN",label:"登錄"},{value:"BROWSE",label:"足跡👣"},{value:"OPERATION",label:"操作"},{value:"ARTICLE",label:"文章"},{value:"WEBDAV",label:"WebDAV"}],typeValue:this.type,isLoginType:"LOGIN"===this.type,queryCondition:{excludeUsername:"other",username:void 0,ip:void 0,type:this.type,startTime:void 0,endTime:void 0},pickerValue:[],pickerOptions:{shortcuts:[{text:"最近一週",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-6048e5),e.$emit("pick",[i,t])}},{text:"最近一個月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-2592e6),e.$emit("pick",[i,t])}},{text:"最近三個月",onClick:function(e){var t=new Date,i=new Date;i.setTime(i.getTime()-7776e6),e.$emit("pick",[i,t])}}]}}},mounted:function(){this.getLogList()},methods:{sortChange:function(e){var t=e.backData;this.queryCondition.sortProp=t.prop,this.queryCondition.sortOrder=t.order,this.queryLogList()},pageChange:function(e){this.pagination=e.backData,this.getLogList()},selectType:function(){this.queryCondition.type=this.typeValue,"ARTICLE"===this.typeValue?(this.tableHeader[0].disabled=!0,this.tableHeader[1].disabled=!0,this.tableHeader[3].disabled=!0,this.tableHeader[5].minWidth=200):(this.tableHeader[0].disabled=!1,this.tableHeader[1].disabled=!1,this.tableHeader[3].disabled=!1,this.tableHeader[5].minWidth=105),this.queryLogList()},queryLogList:function(){this.$refs.tableList.initPageIndex(),this.getLogList()},getLogList:function(){var e=this;null!=this.pickerValue&&this.pickerValue.length>0&&(this.queryCondition.startTime=this.pickerValue[0].getTime(),this.queryCondition.endTime=this.pickerValue[1].getTime()),this.loading=!0,r.logList(Object(s["a"])({page:this.pagination.pageIndex,pageSize:this.pagination.pageSize},this.queryCondition)).then((function(t){e.dataList=t.data,e.pagination.pageTotal=t.count,e.loading=!1}))}}},d=c,u=(i("0104"),i("2877")),h=Object(u["a"])(d,a,n,!1,null,"0158a2bf",null);t["default"]=h.exports},5116:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAF0AAABKCAIAAABWwM+3AAAAq0lEQVR4nO3QsRHAIBDAsJD9d34GwD0U0gQ+r5n5OPy3Ax7lS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZfmS/Ol+dJ8ab40X5ovzZe2AZ0NA5FzKaYlAAAAAElFTkSuQmCC"},5194:function(e,t,i){"use strict";i("bb64")},"56a6":function(e,t,i){e.exports=i.p+"static/img/emptyfile_intro.6df1f625.jpeg"},5747:function(e,t,i){},"5a56":function(e,t,i){},"5ba2":function(e,t,i){"use strict";i("2114")},"5d88":function(e,t,i){var a={"./Favoritestarrate.svg":"ba29","./add-file.svg":"cb53","./audio.svg":"5b8d","./back.svg":"c557","./breadcrumb-right.svg":"16b5","./cancel-share.svg":"5c1e","./close.svg":"7710","./contents.svg":"6e48","./dashboard.svg":"f782","./docment.svg":"29ad","./document.svg":"fd28","./example.svg":"30c3","./eye-open.svg":"d7ec","./eye.svg":"4df5","./file-Ds-store.svg":"c5e8","./file-add.svg":"6ab0","./file-bat.svg":"d3b9","./file-class.svg":"b7ab","./file-cmake.svg":"4fee","./file-conf.svg":"fa5a","./file-cpp.svg":"33e1","./file-css.svg":"270b","./file-csv.svg":"8d1b","./file-dart.svg":"2f38","./file-db.svg":"d0a2","./file-dmg.svg":"a240","./file-docxf.svg":"393d","./file-drawio.svg":"6a4e","./file-excel.svg":"bd70","./file-exe.svg":"49f2","./file-factories.svg":"f3c5","./file-gitignore.svg":"47ff","./file-go.svg":"b909","./file-gradle.svg":"00d8","./file-gzip.svg":"bdb5","./file-h.svg":"5623","./file-html.svg":"e9ad","./file-idea.svg":"0ab8","./file-iso.svg":"70a9","./file-jar.svg":"fd7c","./file-java.svg":"2870","./file-js.svg":"6b09","./file-json.svg":"b7f1","./file-key.svg":"09e8","./file-log.svg":"1f55","./file-md.svg":"f421","./file-mind.svg":"5399","./file-ncm.svg":"60c7","./file-pdf.svg":"63f3","./file-pem.svg":"2afe","./file-php.svg":"13a8","./file-pkg.svg":"f4b7","./file-plist.svg":"77a2","./file-ppt.svg":"1d06","./file-properties.svg":"9339","./file-python.svg":"0c41","./file-shell.svg":"3f78","./file-swift.svg":"00b4","./file-tar.svg":"cf7d","./file-txt.svg":"374b","./file-upload.svg":"c9b7","./file-vue.svg":"2bc8","./file-word.svg":"5743","./file-xls.svg":"e6ed","./file-xml.svg":"e155","./file-xsl.svg":"7f33","./file-yml.svg":"3671","./file.svg":"b8b2","./folder-128.svg":"5911","./folder-add.svg":"2129","./folder-upload.svg":"c04d","./folder.svg":"d079","./form.svg":"eb1b","./fullscreen.svg":"9921","./gongxiangzhongxin.svg":"3886","./home.svg":"6bbe","./image.svg":"8736","./jmal-cloud.svg":"0340","./link.svg":"18f0","./loading-image-error.svg":"bd9b","./md-list.svg":"2edc","./md.svg":"304e","./menu-addtab.svg":"2c60","./menu-ascending.svg":"d129","./menu-copy.svg":"f613","./menu-descending.svg":"8e8c","./menu-deselect.svg":"3a0f","./menu-details.svg":"8ec2","./menu-download.svg":"8d45","./menu-edit1.svg":"ce0b","./menu-empty.svg":"3d2e","./menu-favorite-hover.svg":"aeb7","./menu-favorite.svg":"f17e","./menu-grid.svg":"4195","./menu-list.svg":"7f6d","./menu-null.svg":"8707","./menu-open.svg":"00bd","./menu-point.svg":"c784","./menu-remove.svg":"910d","./menu-rename.svg":"f1ae","./menu-select.svg":"cdac","./menu-unfavorite-hover.svg":"83bf","./menu-unfavorite.svg":"b554","./menu-unselect.svg":"21bd","./more.svg":"3dd0","./nested.svg":"dcf8","./normalscreen.svg":"7a3a","./open-folder.svg":"03fd","./password.svg":"2a3d","./release.svg":"7186","./search.svg":"8e8d","./share.svg":"5306","./tab-favorite.svg":"4a51","./tab-folder.svg":"93d7","./tab-recently.svg":"44b8","./tab-setting.svg":"46d6","./table.svg":"47f1","./tree.svg":"93cd","./user.svg":"b3b5","./video.svg":"8f2b","./warring.svg":"c1c0","./widget-email.svg":"5863","./widget-github.svg":"ca9d","./widget-music.svg":"2e4a","./widget-subscription.svg":"fba5","./yes.svg":"8d65","./zip.svg":"8aa6","./ziyuan.svg":"adc6","./zuijinyuedu.svg":"d565"};function n(e){var t=s(e);return i(t)}function s(e){var t=a[e];if(!(t+1)){var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}return t}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id="5d88"},"63cb":function(e,t,i){},6980:function(e,t,i){},"6e63":function(e,t,i){},7088:function(e,t,i){},"71e9":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"share-empty"},[a("div",{staticClass:"share-empty-icon"},[e.emptyShare?a("img",{ref:"image",staticStyle:{"max-width":"100%"},attrs:{src:i("87d4"),alt:""}}):e._e(),e._v(" "),e.emptyShare?e._e():a("img",{ref:"image",staticStyle:{"max-width":"100%"},attrs:{src:i("56a6"),alt:""}})]),e._v(" "),a("p",{staticClass:"share-empty-status"},[e._v("\n      "+e._s(e.emptyStatus)+"\n    ")])])])},n=[],s={name:"EmptyFile",props:{emptyImgUrl:{type:String,default:"~@/assets/img/emptyfile_intro.jpeg"},emptyStatus:{type:String,default:"空空如也~"},emptyShare:{type:Boolean,default:!1}},created:function(){},data:function(){return{}},methods:{sourceImg:function(){return"~@/assets/img/emptyfile_intro.jpeg"}}},o=s,r=(i("9d7b"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"4feb255b",null);t["a"]=l.exports},"72d3":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("van-list",[i("van-sticky",{attrs:{"offset-top":0}},[i("van-nav-bar",{attrs:{title:"文件上傳列表","left-text":"返回","left-arrow":""},on:{"click-left":e.onClickLeft}})],1),e._v(" "),i("ul",{staticClass:"file-list"},[e._l(e.fileList,(function(e){return i("li",{key:e.id},[i("uploader-file",{ref:"files",refInFor:!0,class:"file_"+e.id,attrs:{file:e,list:!0}})],1)})),e._v(" "),e.fileList.length?e._e():i("div",{staticClass:"no-file"},[i("van-empty",{attrs:{description:"暫無待上傳文件"}})],1)],2)],1)],1)},n=[],s=(i("7f29"),i("0dcf")),o=i("9dce"),r={components:{IconFile:s["a"]},data:function(){return{fileList:[]}},mounted:function(){window.uploader&&(this.fileList=window.uploader.fileList)},destroyed:function(){window.removeEventListener("popstate",this.goBack,!1)},methods:{onClickLeft:function(){this.$router.push("/_m"),o["a"].$emit("uploadFileListBack",!0)}}},l=r,c=(i("e134"),i("2877")),d=Object(c["a"])(l,a,n,!1,null,"a5bef1d8",null);t["default"]=d.exports},"74e6":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"container"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"img-container"},[i("div",{staticClass:"img-region"},[i("img",{ref:"image",staticStyle:{"max-width":"100%"},attrs:{src:e.sourceImg,alt:""}})]),e._v(" "),i("div",{staticClass:"button-region"},[i("el-button",{attrs:{type:"primary"},on:{click:e.sureSava}},[e._v("保存頭像")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.selectImg.id,expression:"selectImg.id"}],attrs:{type:"primary"},on:{click:function(t){return e.noCropSave(e.selectImg.id)}}},[e._v("不剪裁保存")])],1)]),e._v(" "),i("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),e._m(0)],1)])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"avatar-preview"},[i("h3",[e._v("頭像預覽")]),e._v(" "),i("div",{staticClass:"before big"}),e._v(" "),i("span",[e._v("大頭像100*100")]),e._v(" "),i("div",{staticClass:"before small margin-top"}),e._v(" "),i("span",[e._v("小頭像55*55")])])}],s=(i("a481"),i("7f7f"),i("ed66"),i("bab4")),o=i.n(s),r=i("2690"),l={name:"CropperDialog",components:{},props:{fileImg:{type:Blob,default:{}},selectImg:{type:Object,default:{}},avatar:{type:String,defalut:""}},data:function(){return{loading:!0,cropper:null,filename:"",sourceImg:""}},mounted:function(){var e=this;this.$nextTick((function(){e.initCropper(),e.loading=!1,e.changImg(e.fileImg),e.setSelectImg(e.selectImg)}))},methods:{initCropper:function(){this.cropper=new o.a(this.$refs.image,{responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,autoCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,preview:".before",aspectRatio:1,viewMode:1})},setSelectImg:function(e){if(e.id){this.loading=!0,this.cropper.reset();var t=r["a"].previewUrl(this.$store.state.user.name,e,this.$store.getters.token)+"&o=crop&w=1024";this.sourceImg=t,this.cropper.replace(t),this.loading=!1}},changImg:function(e){if(this.filename=e.name,e.size>0){this.loading=!0,this.cropper.reset();var t=this,i=new FileReader;i.readAsDataURL(e),i.onload=function(){t.cropper.replace(i.result),t.loading=!1}}},sureSava:function(){var e=this,t=this.cropper.getCroppedCanvas({maxWidth:1204,maxHeight:1024,fillColor:"#FFF",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}),i=t.toDataURL("image/jpeg");t.toBlob((function(t){t.name=e.filename,e.$emit("croppedCanvas",i,t)}))},noCropSave:function(e){this.$emit("noCropSave",e)}}},c=l,d=(i("f40d"),i("2877")),u=Object(d["a"])(c,a,n,!1,null,"59f3edbd",null);t["a"]=u.exports},"7abe":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{defaultGrid:!0,orderCustom:!0,contextMenus:e.contextMenus,sortable:e.sortable}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"name",order:"ascending"},contextMenus:[{label:"查看",operation:"viewMode",child:[{iconClass:this.grid?"":"menu-point",label:"列表",operation:"vmode-list"},{iconClass:this.grid?"menu-point":"",label:"縮略圖",operation:"vmode-grid"}]},{label:"排列方式",operation:"arrangement",child:[{label:"名稱",operation:"orderName",orderProp:"name"},{label:"大小",operation:"orderSize",orderProp:"size"},{label:"日期",operation:"orderUpdateDate",orderProp:"updateDate"}]},{label:"刷新",operation:"refresh"},{divider:!0,operation:"divider"},{label:"新建",operation:"create",child:[{label:"文本",operation:"createTextFile",iconClass:"file-txt"},{label:"思維導圖",operation:"createMinderFile",iconClass:"file-mind"},{label:"流程圖",operation:"createDrawioFile",iconClass:"file-drawio"},{label:"Word",operation:"createWordFile",iconClass:"file-word"},{label:"Excel",operation:"createExcelFile",iconClass:"file-excel"},{label:"PPT",operation:"createPPTFile",iconClass:"file-ppt"}]},{divider:!0,operation:"divider"},{label:"寫文章",operation:"createMarkdownFile"}]}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"c6ee8020",null);t["default"]=c.exports},"7b0c":function(e,t,i){"use strict";i("b8c1")},"7c83":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"table-temp"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tableData",attrs:{data:e.tableData,"max-height":e.tableMaxHeight,"row-key":"id",border:e.border,size:"medium",fit:"","highlight-current-row":"","default-expand-all":e.isExpand,"tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"selection-change":e.handleSelectionChange,"sort-change":e.sortChange}},[e.hasSelection?i("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}):e._e(),e._v(" "),i("el-table-column",{attrs:{type:"index",label:"",align:"center",fixed:""}}),e._v(" "),e._l(e.tableHeader,(function(t,a){return t.disabled?e._e():i("el-table-column",{key:a,attrs:{prop:t.prop,label:t.label,fixed:t.fixed,width:t.width,"min-width":t.minWidth,align:t.align||"center","sort-orders":["ascending","descending"],sortable:t.sortable,"show-overflow-tooltip":!0,"tooltip-effect":"dark"},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v("\n          "+e._s(t.formatData||t.active?"":a.row[t.prop])+"\n          "),t.active?i("div",e._l(t.active,(function(t,n){return i("el-button",{key:n,style:{color:t.color},attrs:{type:t.type||"text",icon:t.icon,size:"medium"},on:{click:function(e){return t.handle(a.row)}}},[e._v(e._s(t.name))])})),1):e._e(),e._v(" "),t.formatData?i("div",[t.tag?i("div",e._l(t.formatData(a.row[t.prop]),(function(t){return i("el-tag",{key:t.name,attrs:{size:"mini",type:t.type}},[e._v(e._s(t.name))])})),1):t.icon?i("div",[i("svg-icon",{attrs:{"icon-class":t.formatData(a.row[t.prop])}})],1):i("div",[i("span",{attrs:{else:""}},[e._v(e._s(t.formatData(a.row[t.prop])||a.row[t.prop]))])])]):e._e()]}}],null,!0)})}))],2),e._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{"hide-on-single-page":"",background:"",layout:"total,sizes, prev, pager, next, jumper","current-page":e.pagination.pageIndex,"page-sizes":[20,30,50,100],"page-size":e.pagination.pageSize,total:e.pagination.pageTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange}})],1)],1)},n=[],s=(i("ac6a"),i("c5f6"),{name:"TableList",props:{tableData:{type:Array,default:function(){return[]}},lessClientHeight:{type:Number,default:0},tableHeader:{type:Array,default:function(){return[]}},border:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},hasSelection:{type:Boolean,default:!0},isExpand:{type:Boolean,default:!0},pagination:{type:Object,default:{pageIndex:0,pageSize:15,pageTotal:0}}},data:function(){return{tableMaxHeight:document.documentElement.clientHeight,multipleSelection:[]}},mounted:function(){this.setMaxHeight(!0);var e=this;window.onresize=function(){e.setMaxHeight()}},methods:{setMaxHeight:function(e){this.tableMaxHeight=document.documentElement.clientHeight-this.lessClientHeight,e&&this.$set(this.pagination,"pageSize",10+Math.round((this.tableMaxHeight-500)/45))},handleSelectionChange:function(e){this.multipleSelection=e,this.$emit("selectFun",{backData:this.multipleSelection})},initPageIndex:function(){this.$set(this.pagination,"pageIndex",1)},handleSizeChange:function(e){this.$set(this.pagination,"pageSize",e),this.$emit("sizeChange",{backData:this.pagination})},handlePageChange:function(e){this.$set(this.pagination,"pageIndex",e),this.$emit("pageChange",{backData:this.pagination})},handleActive:function(e,t,i){this.$router.push({path:"/"+t,query:{id:e[i]}})},sortChange:function(e){this.$emit("sortChange",{backData:e})},handleExpand:function(){var e=this;this.$nextTick((function(){e.forArr(e.tableData,e.isExpand)}))},forArr:function(e,t){var i=this;e.forEach((function(e){i.$refs.tableData.toggleRowExpansion(e,t),e.children&&i.forArr(e.children,t)}))}}}),o=s,r=(i("347b"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"1712006c",null);t["a"]=l.exports},"7ea3":function(e,t,i){"use strict";i("3221")},"7f44":function(e,t,i){"use strict";i("8909")},"816e":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.vditorLoading,expression:"vditorLoading"}]},[i("div",{staticClass:"article-editor"},[i("div",{staticClass:"editor-left"},[e.currentDarft?i("cite",[e._v("你正在編輯的是保存於 "+e._s(e.file.updateDate)+" 的草稿, 你也可以\n        "),i("el-button",{staticStyle:{color:"#F56C6C"},attrs:{type:"text"},on:{click:e.deleteDraft}},[e._v("刪除它")])],1):e._e(),e._v(" "),i("el-header",[i("div",{staticClass:"header-item"},[i("el-input",{staticClass:"articles-title",attrs:{placeholder:"標題"},model:{value:e.filename,callback:function(t){e.filename=t},expression:"filename"}})],1),e._v(" "),i("div",{staticClass:"url-slug"},[i("div",[e._v(e._s(e.siteUrl+(e.alonePage?"/o/":"/s/")))]),e._v(" "),i("edit-element",{ref:"editElement",staticClass:"mark-setting-input",style:{minWidth:e.file.slug&&e.file.slug.length>0?"0px":"35px"},attrs:{placeholder:"縮略名","can-edit":""},model:{value:e.file.slug,callback:function(t){e.$set(e.file,"slug",t)},expression:"file.slug"}}),e._v(" "),e.isEdit?i("a",{staticClass:"view-icon",attrs:{title:"預覽 "+e.filename,href:e.siteUrl+(e.alonePage?"/o/":"/s/")+(e.file.slug?e.file.slug:e.file.id),target:"_blank"}},[i("svg-icon",{staticClass:"wailian",attrs:{"icon-class":"eye-open"}}),e._v("預覽\n          ")],1):e._e()],1)]),e._v(" "),i("el-main",[i("div",{style:{maxHeight:e.clientHeight+"px"},attrs:{id:"vditor"}})])],1),e._v(" "),i("div",{staticClass:"editor-right"},[i("div",{staticClass:"operation"},[i("el-button",{staticClass:"release-button",attrs:{type:"warning",size:"small",loading:e.updating},on:{click:e.saveDraft}},[e._v("保存草稿\n        ")]),e._v(" "),i("el-button",{staticClass:"release-button",attrs:{type:"primary",size:"small",loading:e.updating},on:{click:e.release}},[e._v("發佈文章\n        ")])],1),e._v(" "),i("div",{staticClass:"more-setting"},[i("p",{staticClass:"mark-setting-label"},[e._v("發佈日期：")]),e._v(" "),i("el-date-picker",{attrs:{type:"datetime",size:"medium","value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss"},model:{value:e.file.uploadDate,callback:function(t){e.$set(e.file,"uploadDate",t)},expression:"file.uploadDate"}}),e._v(" "),i("p",{staticClass:"mark-setting-label"},[e._v("文章封面：")]),e._v(" "),i("upload-image-input",{attrs:{placeholder:"請輸入文章封面大圖的url","intput-autosize":{minRows:2,maxRows:6}},model:{value:e.file.cover,callback:function(t){e.$set(e.file,"cover",t)},expression:"file.cover"}}),e._v(" "),e.alonePage?e._e():i("div",[i("p",{staticClass:"mark-setting-label"},[e._v("分類：")]),e._v(" "),i("multiple-tree-select",{ref:"selectTree",staticStyle:{width:"100%"},attrs:{size:"medium",placeholder:"請選擇分類",options:e.categories,"select-pack-up":""},model:{value:e.file.categoryIds,callback:function(t){e.$set(e.file,"categoryIds",t)},expression:"file.categoryIds"}})],1),e._v(" "),e.alonePage?e._e():i("div",{staticClass:"setting-tags"},[i("p",{staticClass:"mark-setting-label"},[e._v("標籤：")]),e._v(" "),e._l(e.dynamicTags,(function(t){return i("el-tag",{key:t.id,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return e.handleClose(t)}}},[e._v("\n            "+e._s(t)+"\n          ")])})),e._v(" "),e.inputVisible?i("el-autocomplete",{ref:"saveTagInput",class:[e.inputNewTagClass,e.inputValueExist?e.inputErrorClass:""],attrs:{size:"small","fetch-suggestions":e.querySearch,"popper-append-to-body":!1,placeholder:"請輸入標籤名"},on:{select:e.handleSelect,blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):e._e(),e._v(" "),e.inputValueExist?i("div",{staticClass:"instruction-error"},[e._v("該標籤已存在")]):e._e(),e._v(" "),e.inputVisible?e._e():i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v(" + 新增標籤")])],2)],1)])]),e._v(" "),i("el-drawer",{attrs:{visible:e.moreSetting,"append-to-body":!0,"with-header":!1},on:{"update:visible":function(t){e.moreSetting=t}}},[i("div",{staticClass:"more-setting"},[i("h2",[e._v("更多設置")]),e._v(" "),i("p",{staticClass:"mark-setting-label"},[e._v("文章封面：")]),e._v(" "),i("upload-image-input",{model:{value:e.file.cover,callback:function(t){e.$set(e.file,"cover",t)},expression:"file.cover"}})],1)])],1)},n=[],s=(i("ac6a"),i("a481"),i("6762"),i("2fdb"),i("28a5"),i("7f7f"),i("021e")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:e.selectTreeNode.showName,visible:e.visible,"append-to-body":e.appendToBody},on:{"update:visible":function(t){e.visible=t},close:e.clearTreeNode}},[i("el-tree",{ref:"directoryTree",attrs:{data:e.directoryTreeData,"node-key":"id",props:e.directoryTreeProps,load:e.directoryTreeLoadNode,"highlight-current":!0,"default-expanded-keys":["0"],"render-content":e.renderContent,hight:"100",lazy:""},on:{"node-click":e.treeNodeClick,"node-expand":e.treeNodeExpand}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.fileTreeAndNewFolder}},[i("i",{staticClass:"el-icon-folder-add"}),e._v("  新建文件夾")]),e._v(" "),e.$slots.footer?i("span",{staticClass:"dialog-footer"},[e._t("footer")],2):e._e(),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.visible=!1}}},[e._v("取 消")])],1)],1)],1)},r=[],l=i("5cfc"),c={name:"DirTree",props:{appendToBody:{type:Boolean,default:!1},currentDir:{type:String,default:"/"},unzip:{type:Boolean,default:!1}},data:function(){return{visible:!1,directoryTreeData:[],selectTreeNode:{},directoryTreeProps:{label:"name",children:"children",isLeaf:"isLeaf"}}},methods:{show:function(){this.visible=!0;var e=this;setTimeout((function(){e.selectTreeNode.showName||(e.selectTreeNode=e.$refs.directoryTree.getCurrentNode(),e.selectTreeNode.showName=e.selectTreeNode.name)}),100)},hide:function(){this.visible=!1},getSelectTreeNode:function(){return this.selectTreeNode},clearTreeNode:function(){var e=this.$refs.directoryTree.getNode("0");e.loaded=!1,e.expanded=!1},directoryTreeLoadNode:function(e,t){var i=null;if(0===e.level){var a=this;return setTimeout((function(){a.$refs.directoryTree.setCurrentKey("0")}),0),t([{id:"0",name:"全部文件"}])}e.level>1&&(i=e.data.id),l["a"].queryFileTree({userId:this.$store.state.user.userId,username:this.$store.state.user.name,fileId:i}).then((function(e){var i=e.data;return t(i)}))},treeNodeClick:function(e,t,i){this.selectTreeNode=e,this.selectTreeNode.showName=e.name},treeNodeExpand:function(e,t,i){},fileTreeAndNewFolder:function(){var e="newFolderNodeKey",t=this.$refs.directoryTree.getNode(e);null!==t&&this.$refs.directoryTree.remove(t);var i=this.$refs.directoryTree.store.currentNode.childNodes,a=this.getNewFileName(i,"新建文件夾"),n={id:e,newFolder:!0,name:a,showName:a,isLeaf:!0};this.$refs.directoryTree.append(n,this.selectTreeNode);setTimeout((function(){var e=document.getElementById("treeInput");e&&(e.value=a,e.focus(),e.select())}),100)},getNewFileName:function(e,t){var i=0,a=[];e.forEach((function(e){a.push(e.name||e.label)}));var n=t;while(a.includes(t))i+=1,t=n+i;return t},renderContent:function(e,t){var i=this,a=t.node,n=t.data;t.store;return n.newFolder?e("span",{class:"custom-tree-node"},[e("span",[e("svg-icon",{attrs:{"icon-class":"folder"}})]),e("span",[e("div",{class:"el-input el-input--mini el-input-tree"},[e("input",{attrs:{type:"text",autocomplete:"on",value:"新建文件夾",id:"treeInput"},class:"el-input__inner"})]),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){var e="/",t=a.parent.data;t.path&&(e=t.path+t.name+e),l["a"].newFolder({isFolder:!0,filename:encodeURI(n.name),currentDirectory:encodeURI(e),username:i.$store.state.user.name,userId:i.$store.state.user.userId}).then((function(e){n.newFolder=!1,n.id=e.data.id})).catch((function(){window.event.preventDefault(),window.event.stopPropagation()}))}},class:"el-button el-icon-check el-button--mini el-input-tree-button"}),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){i.$refs.directoryTree.remove(a),window.event.preventDefault(),window.event.stopPropagation()}},class:"el-button el-icon-close el-button--mini el-input-tree-button"})])]):a.expanded?e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"open-folder"}}),e("span",{style:"margin-left: 5px;"},[a.label]),e("span")]):e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"folder"}}),e("span",{style:"margin-left: 5px;"},[a.label]),e("span")])}}},d=c,u=(i("35d8"),i("2877")),h=Object(u["a"])(d,o,r,!1,null,"45a37638",null),f=h.exports,p=i("2690"),m=i("ff41"),g=i.n(m),v=(i("ae60"),i("c405")),b=i("d28d"),w=i("4308"),y=i("f406"),x=i("eea1"),C=["emoji","bold","italic","strike","link","|","list","ordered-list","check","outdent","indent","|","line","insert-before","insert-after","|","upload","record","table","|","undo","redo","|","edit-mode","code-theme","outline","preview","fullscreen",{name:"more",toolbar:["export","both","info","help"]}],k={name:"MarkdownEditor",components:{MultipleTreeSelect:x["a"],EditElement:w["default"],DirTree:f,Vditor:g.a,UploadImageInput:y["a"]},props:{hasChange:{type:Boolean,defalut:!1},alonePage:{type:Boolean,default:!1},siteUrl:{type:String,default:""},isEdit:{type:Boolean,default:!1}},data:function(){return{activeNames:["1"],file:{},editStatus:!1,filename:"",clientHeight:document.documentElement.clientHeight-150,updating:!1,storageLocation:"",selectLocationVisible:!1,moreSetting:!1,contentEditor:"",categories:[],draft:!1,currentDarft:!1,tags:[],dynamicTags:[],inputVisible:!1,inputValue:"",inputValueExist:!1,inputNewTagClass:"input-new-tag",inputErrorClass:"input-error",vditorLoading:!1,releaseTime:void 0}},mounted:function(){this.getMarkdown(),this.categoryTree(),this.getTags()},watch:{file:function(){this.valueHasChanged()},filename:function(e){this.valueHasChanged(),this.$emit("onTitle",e)},storageLocation:function(){this.valueHasChanged()}},computed:{},methods:{reload:function(){this.getMarkdown(!0),this.categoryTree()},querySearch:function(e,t){var i=this.tags,a=e?i.filter((function(t){return 0===t.name.toLowerCase().indexOf(e.toLowerCase())})):[];a=a.map((function(e){return{value:e.name}})),t(a)},handleSelect:function(){this.handleInputConfirm()},valueHasChanged:function(){this.$emit("update:hasChange",!0)},getMarkdown:function(e){var t=this;this.vditorLoading=!0,this.draft=!1,this.$route.query.id?(this.editStatus=!0,s["a"].getMarkdown({mark:this.$route.query.id}).then((function(i){i.data.draft?(t.file=JSON.parse(i.data.draft),i.data.release&&(t.currentDarft=!0)):(t.currentDarft=!1,t.file=i.data),e?(t.contentEditor.setValue(t.file.contentText),t.vditorLoading=!1):t.vditorInit(t.file.contentText),t.content=t.file.contentText,t.filename=t.file.name.split(".md")[0],t.file.tagIds&&t.file.tagIds.length>0&&t.tags&&t.tags.length>0&&t.loadDynamicTags()})).then((function(){var e=t;setTimeout((function(){e.$emit("update:hasChange",!1)}),200)}))):e?this.contentEditor.setValue(""):this.vditorInit("")},moreSet:function(){this.moreSetting=!0},categoryTree:function(){var e=this;v["a"].categoryTree().then((function(t){e.categories=t.data}))},getTags:function(){var e=this;b["a"].tagList().then((function(t){e.tags=t.data,e.file.tagIds&&e.file.tagIds.length>0&&e.loadDynamicTags()}))},loadDynamicTags:function(){var e=this;this.dynamicTags=this.tags.filter((function(t){return e.file.tagIds.includes(t.id)})).map((function(e){return e.name}))},handleClose:function(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this;setTimeout((function(){var t=e.inputValue;if(t){if(e.dynamicTags.includes(t))return void(e.inputValueExist=!0);e.dynamicTags.push(t)}e.inputValueExist=!1,e.inputVisible=!1,e.inputValue=""}),100)},vditorInit:function(e){var t=this;this.contentEditor=new g.a("vditor",{height:this.clientHeight,resize:{enable:!0},toolbar:[].concat(C),toolbarConfig:{pin:!0},preview:{mode:"both",hljs:{lineNumber:!0}},cache:{enable:!1},after:function(){t.contentEditor.setValue(e),t.vditorLoading=!1},input:function(){t.valueHasChanged()},upload:this.markdownImageUplaod()})},markdownImageUplaod:function(){return{accept:"image/*,.mp3, .wav, .rar",headers:{"jmal-token":this.$store.state.user.token,username:this.$store.state.user.name,userId:this.$store.state.user.userId},url:"/api/upload-markdown-image",extraData:{username:this.$store.state.user.name,userId:this.$store.state.user.userId},fieldName:"files",filename:function(e){return e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")},format:function(e,t){var i=JSON.parse(t),a={};return i.data.forEach((function(e){a[e.filename]=p["a"].mardownPreviewUrl(e.filepath)})),i.data={},i.data["succMap"]=a,JSON.stringify(i)},error:function(e){console.log("error",e)},linkToImgUrl:"/api/upload-markdown-link-image",linkToImgFormat:function(e){var t=JSON.parse(e);return t.data["url"]=p["a"].mardownPreviewUrl(t.data.url),JSON.stringify(t)}}},save:function(){this.editStatus?this.update():this.add()},imageFilter:function(){return!0},checkParam:function(){return this.filename?!(this.contentEditor.getValue().length<2)||(this.$message.warning("請輸入文章內容"),!1):(this.$message.warning("請輸入文章標題"),!1)},saveDraft:function(){this.draft=!0,this.update("保存草稿成功")},release:function(){this.draft=!1,this.update()},deleteDraft:function(){var e=this;this.$confirm("您確定要刪除這份草稿嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].deleteDraft({fileId:e.$route.query.id,username:e.$store.state.user.name}).then((function(){e.$message({message:"草稿已被刪除",type:"success",duration:1e3}),e.reload()}))}))},update:function(e){var t=this;if(this.checkParam()&&(this.updating=!0,this.filename)){var i=this.filename+".md";s["a"].editMarkdown({fileId:this.$route.query.id,userId:this.$store.state.user.userId,username:this.$store.state.user.name,filename:encodeURI(i),cover:this.file.cover,isDraft:this.draft,isRelease:this.file.release,isAlonePage:this.alonePage,slug:this.file.slug?this.file.slug:this.filename,categoryIds:this.file.categoryIds,tagNames:this.dynamicTags,currentDirectory:encodeURI(this.path),contentText:this.contentEditor.getValue(),html:this.contentEditor.getHTML(),uploadDate:this.file.uploadDate}).then((function(i){t.$emit("update:hasChange",!1),t.updating=!1,t.$message({message:e||"發佈成功",type:"success",duration:1e3}),t.draft?(t.$router.push({path:t.$route.path,query:{operation:"editor",id:i.data}}),t.$emit("onTitle",t.filename),t.reload()):t.$emit("onRelease")})).catch((function(){t.updating=!1}))}},selectDir:function(){this.$refs.dirTree.show()},confirmSelectDir:function(){var e=this.$refs.dirTree.getSelectTreeNode();this.storageLocation=e.path+e.name,this.$refs.dirTree.hide()}}},_=k,L=(i("4072"),Object(u["a"])(_,a,n,!1,null,"5ee4b3a0",null));t["default"]=L.exports},"85d7":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("article-manager",{attrs:{"page-title":e.pageTitle,"new-article-text":e.newArticleText}})],1)},n=[],s=i("b0d9"),o={name:"articlePageManager",components:{ArticleManager:s["default"]},data:function(){return{pageTitle:"管理文章",newArticleText:"寫文章"}},computed:{},created:function(){},mounted:function(){},watch:{},methods:{}},r=o,l=(i("7b0c"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"23a763fe",null);t["default"]=c.exports},8740:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("el-card",{staticClass:"box-card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("div",{staticClass:"clearfix card-header-back"},[i("span",[e._v("網盤設置")])])])]),e._v(" "),i("div",[i("div",{staticClass:"config-itme-label"},[e._v("網盤名稱：\n        "),i("el-input",{style:{width:e.inputNetdiskNameWidth+"px"},attrs:{placeholder:"請輸入網盤名稱",minlength:"1",maxlength:"8",size:"medium"},on:{input:e.inputNetdiskName},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateNetdiskName.apply(null,arguments)}},model:{value:e.netdiskName,callback:function(t){e.netdiskName=t},expression:"netdiskName"}},[e.showAckBtn?i("el-button",{attrs:{slot:"append",icon:"el-icon-check"},on:{click:e.updateNetdiskName},slot:"append"}):e._e()],1)],1),e._v(" "),i("div",{staticClass:"config-itme-label logo"},[e._v("網盤Logo：\n        "),i("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[i("Logo",{staticClass:"avatar",attrs:{width:"80"},model:{value:e.logoFileName,callback:function(t){e.logoFileName=t},expression:"logoFileName"}})],1)],1),e._v(" "),i("span",{staticClass:"instruction"},[e._v("點擊更換Logo")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("啓用webp：\n        "),i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.webpChange},model:{value:e.webpEnabled,callback:function(t){e.webpEnabled=t},expression:"webpEnabled"}})],1),e._v(" "),i("span",{staticClass:"instruction"},[e._v("\n        將圖片轉換爲webp格式存儲，在不降低圖片質量的情況下，極大降低圖片文件的體積，建議開啓.\n        "),i("a",{attrs:{href:"https://baike.baidu.com/item/webp%E6%A0%BC%E5%BC%8F",target:"_blank"}},[e._v("什麼是webp?")])]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("網盤同步：\n        "),i("el-button",{staticClass:"sync-button",attrs:{size:"mini",loading:e.syncLoading,type:"primary"},on:{click:function(t){return e.sync()}}},[i("i",{staticClass:"el-icon-refresh"})])],1),e._v(" "),i("span",{staticClass:"instruction"},[e._v("一般用於初始化操作, 將文件數據同步到數據庫")]),e._v(" "),i("div",{staticClass:"config-itme-label"},[e._v("重置角色、菜單：\n        "),i("el-button",{staticClass:"sync-button",attrs:{size:"mini",loading:e.resetLoading,type:"danger"},on:{click:function(t){return e.resetMenuAndRole()}}},[i("i",{staticClass:"el-icon-refresh-left"})])],1),e._v(" "),i("span",{staticClass:"instruction"},[e._v("一般用於初始化角色、菜單數據")])])])],1)},n=[],s=(i("7f7f"),i("6762"),i("2fdb"),i("9bf0")),o=i("9dce"),r=i("1383"),l=i("036d"),c={components:{Logo:r["a"]},data:function(){return{uploadUrl:"/api/user/setting/upload_logo?jmal-token="+this.$store.state.user.token,title:"網盤管理",syncLoading:!1,resetLoading:!1,webpEnabled:!1,logoFileName:"",netdiskName:"JmalCloud",showAckBtn:!1,inputNetdiskNameWidth:150,logoFileTypeList:["image/svg+xml","image/jpg","image/png","image/jpeg"]}},mounted:function(){var e=this;this.getWebsiteSetting(),this.getInfo(),this.getIsSync(),o["a"].$on("msg/synced",(function(){e.syncLoading=!1}))},destroyed:function(){o["a"].$off()},methods:{handleAvatarSuccess:function(e){0===e.code?(this.logoFileName=e.data,this.$store.dispatch("user/setLogo",{netdiskName:this.netdiskName,netdiskLogo:this.logoFileName}).then((function(){o["a"].$emit("updateLogo")}))):this.$message.error(e.message)},beforeAvatarUpload:function(e){var t=this.logoFileTypeList.includes(e.type),i=e.size/1024<128;return t||this.$message.error("網盤Logo只能是 SVG|JPG|JPEG|PNG 格式!"),i||this.$message.error("網盤Logo大小不能超過 128k!"),t&&i},getWebsiteSetting:function(){var e=this;Object(s["c"])({userId:this.$store.state.user.userId}).then((function(t){t.data&&(t.data.netdiskLogo&&(e.logoFileName=t.data.netdiskLogo),t.data.netdiskName&&(e.netdiskName=t.data.netdiskName))}))},inputNetdiskName:function(e){e&&(this.showAckBtn=!0,this.inputNetdiskNameWidth=206)},setInputBlur:function(){this.showAckBtn=!1,this.inputNetdiskNameWidth=150},updateNetdiskName:function(){var e=this;if(this.netdiskName){var t=/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/;t.test(this.netdiskName)?s["a"].updateNetdiskName({netdiskName:this.netdiskName}).then((function(){e.$store.dispatch("user/setLogo",{netdiskName:e.netdiskName,netdiskLogo:e.logoFileName}).then((function(){o["a"].$emit("updateLogo"),document.title=Object(l["a"])(e.$route.meta.title)})),e.$message.success("網盤名稱 修改成功"),e.setInputBlur()})).catch((function(){e.setInputBlur()})):this.$message.warning("網盤名稱 只能包含中文，數字，字母，下劃線")}else this.$message.warning("網盤名稱不能爲空")},getInfo:function(){var e=this;s["a"].getWebp({userId:this.$store.state.user.userId}).then((function(t){e.webpEnabled=!t.data}))},getIsSync:function(){var e=this;s["a"].isSync().then((function(t){e.syncLoading=t.data}))},sync:function(){var e=this;this.$confirm("是否開始同步? ","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){e.syncLoading=!0,s["a"].sync({username:e.$store.state.user.name}).then((function(){e.$message.success("開始同步...")}))}))},resetMenuAndRole:function(){var e=this;this.$confirm("您確定要刪除當前角色、菜單嗎? ","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){e.resetLoading=!0,s["a"].resetMenuAndRole().then((function(){e.$message.success("重置完成"),e.resetLoading=!1})).catch((function(){e.resetLoading=!1}))})).catch((function(){e.resetLoading=!1}))},webpChange:function(e){var t=this;s["a"].disabledWebp({userId:this.$store.state.user.userId,disabled:!e}).then((function(){e?t.$message.success("webp 已啓用"):t.$message.warning("webp 已禁用")})).catch((function(){t.webpEnabled=!t.webpEnabled}))}}},d=c,u=(i("b2233"),i("2877")),h=Object(u["a"])(d,a,n,!1,null,"5d2cc53c",null);t["default"]=h.exports},"87d4":function(e,t,i){e.exports=i.p+"static/img/pic_sharing_empty.7c5a0c94.png"},8909:function(e,t,i){},"8cdb":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wscn-http404-container"},[i("div",{staticClass:"wscn-http404"},[e._m(0),e._v(" "),i("div",{staticClass:"bullshit"},[i("div",{staticClass:"bullshit__oops"},[e._v("哎呦!")]),e._v(" "),i("div",{staticClass:"bullshit__headline"},[e._v(e._s(e.message))]),e._v(" "),i("div",{staticClass:"bullshit__info"},[e._v("請檢查您輸入的URL是否正確，或單擊下面的按鈕返回首頁。")]),e._v(" "),i("a",{staticClass:"bullshit__return-home",attrs:{href:"/"}},[e._v("返回首頁")])])])])},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pic-404"},[a("img",{staticClass:"pic-404__parent",attrs:{src:i("a36b"),alt:"404"}}),e._v(" "),a("img",{staticClass:"pic-404__child left",attrs:{src:i("26fc"),alt:"404"}}),e._v(" "),a("img",{staticClass:"pic-404__child mid",attrs:{src:i("26fc"),alt:"404"}}),e._v(" "),a("img",{staticClass:"pic-404__child right",attrs:{src:i("26fc"),alt:"404"}})])}],s={name:"Page404",computed:{message:function(){return"網站管理員說您無法進入此頁面..."}}},o=s,r=(i("0ac9"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"54041639",null);t["default"]=l.exports},"8ea6":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{staticClass:"select-file-dialog",attrs:{title:e.title,visible:e.dialogVisible,top:"7.5vh",width:"70%","append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[i("show-file",{attrs:{"select-file":"","query-file-type":"image",defaultGrid:!0,orderCustom:!0,"show-upload-button":!1,"show-search-button":!1,"show-more-item":!1,"show-share-item":!1,"less-client-height":e.lessClientHeight,sortable:e.sortable},on:{selectedFile:e.selectedFile}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{disabled:!e.selectedFileRow.size,type:"primary"},on:{click:e.select}},[e._v("選擇")])],1)],1)],1)},n=[],s={components:{ShowFile:function(){return Promise.resolve().then(i.bind(null,"c41c"))}},name:"SelectFile",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"選擇文件"}},data:function(){return{dialogVisible:!1,sortable:{prop:"updateDate",order:"descending"},selectedFileRow:{},lessClientHeight:.15*document.body.clientHeight+150}},watch:{visible:function(e){e&&(this.dialogVisible=!0)}},methods:{selectedFile:function(e){this.selectedFileRow=e},select:function(){this.handleClose(),this.$emit("select",this.selectedFileRow)},handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",this.dialogVisible)}}},o=s,r=(i("fe71"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"bf54329c",null);t["a"]=l.exports},"93ab":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{isCollectView:!0,defaultGrid:!1,sortable:e.sortable,orderCustom:!0,defaultSort:e.sortable,queryCondition:e.queryCondition,singleMenus:e.singleMenus,singleMenusEdit:e.singleMenusEdit,multipleMenus:e.multipleMenus,multipleRightMenus:e.multipleRightMenus}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFavorite:!0},singleMenus:[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"share",label:"分享",operation:"share"},{iconClass:"menu-favorite",label:"收藏",operation:"favorite"},{iconClass:"menu-details",label:"詳細信息",operation:"details"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"}],singleMenusEdit:[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"share",label:"分享",operation:"share"},{iconClass:"menu-favorite",label:"收藏",operation:"favorite"},{iconClass:"menu-edit1",label:"編輯",operation:"edit"},{iconClass:"menu-details",label:"詳細信息",operation:"details"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-download",label:"下載",operation:"download"}],multipleMenus:[{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-favorite-hover",label:"取消收藏",operation:"unFavorite"}],multipleRightMenus:[{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-favorite-hover",label:"取消收藏",operation:"unFavorite"}]}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"78ae83f6",null);t["default"]=c.exports},"943c":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAANO0lEQVR4Xu1de6wcVRn/fbO7s30EkxKh3d3yCqTd2eKtUkNFuJZHkIIUpHiNxLaJgA8gSqSYEpW0hGiooURNRCUiSekftLeAQDX0D2ilKFbTGgrdvb2BVKk7t4UE/jCld2d25zNnd29bsPfuPM6Z2dmdSTa5ycz3/P3uPM75zncIydHXGaC+jj4JHgkB+pwECQESAvR5Bvo8/OQOkBCgzzPQ5+End4CEAL2ZgbP5U7OscXshpbQBAg8AmAdgZvNHNBPg1t+t4yhAR8F8tPV38zfKoH3ccPbp0zKvv0NvfNCLmeqJO0CeF81A/dhFBCxm8CAYFwE4SzJgh0DYS6BdDOxGevpek/Z8KNlG6OpiS4A5x4qXayntekCAzZcC0EPOngXQXwDsdRrOtsPTR3aGbF+KuVgRYA5fcIZmZ4YYGCLgcikZkKSEgZ0EDDsZe/gwvfWeJLXK1cSCAAW7eAkzrQAwBOAM5VkJZkCAP0zEm6qZkdeCqVIv3dUEyNcX3EANXsXEN6tPhXwLxPQ0p2ijmd7/vHztcjR2JQHylnEbEVYyY4mcMKPVQoQ/M+NJU688Hq0n/2+9qwhQsOdfwUitAfM13ZYoKf4QbSc01lczB3ZI0SdBSVcQYPZ/zz9Ty2bXEPgeCTF1vQoGPeLUauuPnPb2u1E7GzkBcrXSCiK+vz1QE3U+wrQ/ykwPjmXLm8I0+nFbkRIgXzMeAmFNlAmI3DZjvZmt3BeVH5EQoDBenMdEG0AQAznJwdhGzKur00ZGw05G6ATI1Y2byMEGAOeFHWyX2zvIGlaPpSvPhulnqAQoWMYdDDwaZoBxs0XAnVW98uuw/A6NAHm7uBZM68IKLNZ2mB8wsyOh5CoUAuRrxXUgWhtrUMJ2PiQSKCdAAn4A5oRAAqUEKNSNlexgY4AU9L0oaVhVTVeeVJUIZQQo1EpDTLxFleP9pJeYvlrNlodVxKyEAAn48qFSRQLpBGh/5z8jPwWJRtawXPY4gVQCNEf4NHoxGeRRRtaD5PBSmSOGUgmQrxkvJMO7ysBvKWZsM7OVZbKsSCNAMrEjCxIXeiROIEkhQHtKV9mniouUnLiE8AoYm50GlzGtvr95Yjy9QEtRCYRbwLjMk74uvZiZVsqYSg5MAFHMkcrqu7piPp/xM1Of8WPQHnsy3Aq28XNm3N2luHpxa7RRswaDFpUEJkDOKm3ohkoer59JectgL9nuxmtFZdGYXl4dxLdABGjW8LH2chAHZMh6BV/YzNVKXxel2zLsR6mDyLkySI1hIALk7dKLURdw+gF/ArCCbfyJGddGCWBg20TbzUx5qV89vgkgSrcB/M6vYRlyQcAX9vNW6bsA/1KGLxHruN1vyblvAhRsY2eUdftBwW8SYLz4RWi0PWLwApsX6w6qmYqvpXK+CCBW7MBxngvsuU8FMsAXps/kC2en7cZhn250l5im3ehnBZIvAhRqpa1RLdeSBb5Ar73YNPLafBlMEsvQqtnyV7zq8kyA9kLNv3o1JON6meA3CdBcYk5ds0onaI6I+PNeF6R6JkDeMn4F4M6gznqVlw1+6yXQEHGIeHrleNTUK3d5CcYTAdq3TDG8GuoSbRXgtwhQfAmgK70krMuvfc/J2Au89CfwRIAo/mOUgV8z1oDwUJcD6se9u0y94rr03hMBcpaxI8zOHKrAL1ilTzP4FQCn+clwN8uITiVjeuUKtz66JkDYL0zqwJ+3kJF+CuCi2yTF7TqnwVe47VnkmgBhTvqoAj9nFReBaTMRzo8bqF789TJJ5JoAecsQU77K59JVgT/XKi12wJsBnOMlmTG99lVTrwy68d0VAWbzwMyUbYtGiRk3Sv1eowr8vD3/UkDbDEbBr28xk7MbmcysI7RPNLyc8nBFgIK94Epm56VOyoKcVwX+HLu4RGNsAejMIP7FTZZIu6qa2d9xqt4VAXJ26YfE/BNVSVAFfuFY6SpO8xYwTlfle7fqZaIfjWXKP+3knysC5O3Sc2C+oZMyP+dVgZ8bL15DGonVND33qecqz0TPm5nyjZ2udUcAy3hHQe9dqAK/MG58iTUI8Kd3SkAPnz9k6pWzO8XXkQCi63bdrr/fSZHX86rAb09VPw0g7dWnXrs+nUmf3qnLeUcCqBgAUgV+rl5cTg4J8JMDgJsBoY4EyFml7xH4F7Iyqgp8Wf6FrSd3zDgHGg1qhEEGfw3AJ2T5wKC7x/TylCVvHQmQtwxR9yfq/wIfCfhTp3AOLyhpdX5EYqHt46ZeuX0qq24IICZNXI0qTR0e3Wrq5ScCs6gPFMwdN65zNPxRQqi7TL3yhaAE2NPalCHQ8ZSpV24JpKHPhPOW8RiAbwYMe6+pVxYFJcAIgPm+HSG833Cw5Ei28qZvHX0oOOdY8VwtRf8A8MkA4R8w9cqUs56dHwF26RCY5/p3gp8w9ZFb/cv3r2TeKv4eoG/4zgDRf8xMecq9k1wQwHgfjFl+nSDQHVW9/Bu/8v0sV7BK32Gw/6aRhA/MTGXKYXA3BKiB/W/IlHJSFxya9ubb/Qyk39jPGr/w/IbWeMuvPAiWmalkg70D2EYgAnAD545Nr/zbdxB9LCjGCCiFf/lOgSQCBHoEyGpk4DsJMRYM3HhDziMg2EsggR6r6uVvxxiHyFwvWKXfMvhbvh2Q8hJoGclnoG8E/AvmrPmfJTR7LwSZzpbwGWgZyUCQfxx9S0oqwZcyEJQMBfuG0Z+gxFlNKUPByWSQPxw9S53DRq5exw+Y8X3PwqcWCD4ZlEwHS4JiEjXiW9/RnKsZzsUgug6M2bIsSpkOjlVBSK24nCgpCJkgkJSCkPiVhBWXiaogVryGQdZ/qUo9UkrChIP5mBWFzhkvXatpLErDkqLQDgzrOBfQJIBt/AGMjiXGftisqkoobxtXA9gKlldi5Se+yGQIz5mZypc72XdFgIJdWs3MD3dS5ve8KhK0G1luBfpvYQgR3VvNlMX+jFMergiQt0uXgVksDlV2qCJBzi4NEnhY5tu1siTIVEw0aGbKr3ZS6Y4AvGgG7A/F4lC9k8Ig51WRoNnYyqFhUN8sDrWQmTHLpD0fdsLDFQFaL4KllwF23Xmik+HJzqsiwRyrdLHWWh5+rl/f4iNHO0y97Kr3kRcCPAxwoM7UbhOoigQ5y7iIGJtBuMCtL/G8jjaYevleN767JoCKAaGpHFRFgrm1+QMOUptBSYsYkX/XBBAXS5qhckPM5jWqSJA0iToBgScCJG3iXHM3ygvVtYlLGkVGiasr22obRba+BnqpVWzP7BcwwQ61rWKFlV5qFt0r+wVMoB9Ks+gmCXqkXXwv7RcQWrv45mOgRzaM6KX9AhDmhhGtR0H8t4wJe2zD1Wucj4tC3zKm/TLYA5tG9cx+AeFvGtUkQcy3jcvbxq7YbyUb1bZxrcdAfDeO7JUtZCPdOLI1PJxsHevjsS1FxEtX8MkMehoKPpWSuG0e3StbxgLojs2jm3eBWmkFEXfR9vG0FY5zoJ5Nvy78S9fqC6Fp84n42thvFdv+L5S16jrwHWDirpCvGQ+BsEbKvS1RMnUGGOvNbOU+GWmSRoDmV0HNeAGE62U4luiYJAOMbWa2skxWfqQSoDBenMcavQjgPFkOJno+koGD5PDS6rSRUVl5kUqA5vtA3biJHDwjy8FEz4kMsIblY+nKszJzIp0AzfEBy7iDAdd718kMqFd1EXBnVa/47xg2SWKUEKD5PmAX14JpXa8CEmpczA+Y2REluVRGgNZLYXEdiNaGmqxeM6YQfJEqpQRI7gQB2agY/FAI0HwnqBsr2cHGgOnoK3HSsKqarigfXFN+B5hArVArDTHxlr5C0WewqsrhT+VOaARo3gkSEnSkRJjgh/YIODnq9jiBWLacDBZ9lA4HWcNq2d/5nRgX6h3g+ONAjBgSbUiGjdsZYWwj5tUyR/g6AT9xPhICTBhPJpAASJzYcQv6yddFSgDhSHsq+X4A8/wEEGOZUWZ6cCxb3hRlDJETQAQvikq0bHYNge+JMhlh2RaVPE6ttv7IaW+/G5bNyex0BQGOvxuIGkOk1kjcNi3q/H7UPtF2QmN9NXNgR7c41lUEOP5uYBm3EWElM5Z0S6KC+CHq9pnxpKlXHg+iR4VsVxLgOBHqC26gBq9i4ptVBK9ap1iuxSnaaKb3P6/all/9XU2AE4+G4iXMtALAEIAz/AYbktx7AIaJeFM1M/JaSDZ9m4kFASaia6/lG2JgiIDLfUetQJCBnQQMOxl7+DC9JUgQiyNWBDg5o2JdH6W0ZQS+GMBihN8b2Aawm0F/54bzwuHpIztjgfjHnIwtAU6OYzYPzEzXG4sd8OdIkIH5MwCm3DDRB1iHQPRPBnZroL/V06ndR2jfUR96ukqkJwhwqoyKLufWuL2QUtoAgQfaA00zAcwE0UyAW3+3jqMAHQWzAHTiN8qgfdxw9unTMq+/Q2+IRpk9d/QsAXoOKUUBJQRQlNi4qE0IEBekFPmZEEBRYuOiNiFAXJBS5GdCAEWJjYvahABxQUqRnwkBFCU2Lmr/B0fnVMxGNsTkAAAAAElFTkSuQmCC"},"961d":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[e.accessToken?i("el-alert",{attrs:{title:"新的操作令牌生成成功！您必須立即複製到一個安全的地方, 因爲該令牌只會顯示一次!",type:"success",center:"",closable:!1}}):e._e(),e._v(" "),e.accessToken?i("el-alert",{attrs:{title:e.accessToken,center:"",type:"info",closable:!1}}):e._e(),e._v(" "),i("el-dialog",{staticClass:"dialog-cm",attrs:{width:"500px",title:e.dialogTitle,"close-on-click-modal":!1,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium",model:e.form,"label-position":"left",rules:e.rules,"label-width":"95px"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"令牌名稱:",prop:"name"}},[i("el-input",{attrs:{placeholder:"請輸入令牌名稱"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSave.apply(null,arguments)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.saveLoading},on:{click:e.onSave}},[e._v("保 存\n      ")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("div",{staticClass:"clearfix card-header-back"},[i("span",[e._v("管理個人操作令牌")]),e._v(" "),i("el-button",{staticClass:"card-button",attrs:{size:"mini",type:"primary"},on:{click:e.newAccessToken}},[e._v("新增令牌")])],1)])]),e._v(" "),i("div",[i("div",{staticClass:"token-title-desc"},[e._v("您可以使用這些以生成的令牌來操作 JmalCloud API。")]),e._v(" "),i("el-divider"),e._v(" "),i("div",[e.accessTokenList.length>0?i("ul",e._l(e.accessTokenList,(function(t){return i("li",{key:t.id},[i("div",{staticClass:"token-item"},[i("div",{staticClass:"item-icon"},[i("svg-icon",{attrs:{"icon-class":"key"}})],1),e._v(" "),i("div",{staticClass:"item-content"},[i("div",{staticClass:"item-title"},[e._v(e._s(t.name))]),e._v(" "),i("div",{staticClass:"item-desc"},[i("span",[e._v("增加於")]),e._v(" "),i("span",[e._v(e._s(t.createTime))]),e._v(" "),i("i",[t.lastActiveTime?i("svg-icon",{attrs:{"icon-class":"zuijinhuoyue"}}):e._e(),t.lastActiveTime?e._e():i("i",{staticClass:"el-icon-info"}),e._v(e._s(t.lastActiveTime?"最近活動於 "+t.lastActiveTime:"沒有最近活動")+"\n                  ")],1)])]),e._v(" "),i("div",{staticClass:"item-active"},[i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return e.deleteToken(t.id)}}},[e._v("刪除令牌")])],1)]),e._v(" "),i("el-divider")],1)})),0):i("div",{staticClass:"empty-text"},[e._v("暫無令牌")])])],1)])],1)},n=[],s=(i("7f7f"),i("9bf0")),o={data:function(){return{dialogVisible:!1,dialogTitle:"新增令牌",accessTokenList:[],accessToken:void 0,form:{name:"",createTime:"",lastActiveTime:""},rules:{name:[{required:!0,message:"請輸入令牌名稱",trigger:"blur"}]},saveLoading:!1}},mounted:function(){this.getAccessTokenList()},methods:{getAccessTokenList:function(){var e=this;s["a"].getAccessTokenList().then((function(t){e.accessTokenList=t.data}))},newAccessToken:function(){this.dialogVisible=!0},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.saveLoading=!0,s["a"].generateAccessToken({tokenName:e.form.name}).then((function(t){e.accessToken=t.data,e.saveLoading=!1,e.dialogVisible=!1,e.getAccessTokenList()})).catch((function(){e.saveLoading=!1}))}))},deleteToken:function(e){var t=this;this.$confirm("您確定要刪除此令牌嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].deleteAccessToken({id:e}).then((function(){t.getAccessTokenList(),t.$notify({title:"刪除成功",type:"success",duration:1e3})}))}))}}},r=o,l=(i("e528"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"544ec4b4",null);t["default"]=c.exports},"999b":function(e,t,i){},"9af0":function(e,t,i){},"9bd6":function(e,t,i){},"9bf0":function(e,t,i){"use strict";i.d(t,"d",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"e",(function(){return o})),i.d(t,"b",(function(){return r}));var a=i("b775");function n(e){return Object(a["a"])({url:"/public/website/record",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/website/setting",method:"get",params:e})}function o(e){return Object(a["a"])({url:"/website/setting/update",method:"put",data:e})}function r(e){return Object(a["a"])({url:"/website/heartwings",method:"get",params:e})}t["a"]={sync:function(e){return Object(a["a"])({url:"/user/setting/sync",method:"get",params:e})},isSync:function(e){return Object(a["a"])({url:"/user/setting/isSync",method:"get",params:e})},updateNetdiskName:function(e){return Object(a["a"])({url:"/user/setting/update_netdisk_name",method:"put",params:e})},getWebp:function(e){return Object(a["a"])({url:"/user/setting/get/webp",method:"get",params:e})},disabledWebp:function(e){return Object(a["a"])({url:"/user/setting/disabled/webp",method:"put",params:e})},getAccessTokenList:function(e){return Object(a["a"])({url:"/user/setting/accessTokenList",method:"get",params:e})},generateAccessToken:function(e){return Object(a["a"])({url:"/user/setting/generateAccessToken",method:"put",params:e})},deleteAccessToken:function(e){return Object(a["a"])({url:"/user/setting/deleteAccessToken",method:"delete",params:e})},resetMenuAndRole:function(){return Object(a["a"])({url:"/user/setting/resetMenuAndRole",method:"put"})}}},"9d7b":function(e,t,i){"use strict";i("2c6f")},"9ea1":function(e,t,i){},"9ed6":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login-container"},[i("div",{attrs:{id:"stars"}}),e._v(" "),i("div",{attrs:{id:"stars2"}}),e._v(" "),i("div",{attrs:{id:"stars3"}}),e._v(" "),i("el-card",{staticClass:"box-card"},[i("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,"auto-complete":"on","label-position":"left"}},[i("div",{staticClass:"title-container"},[e.initialize?e._e():i("h3",[i("div",{staticClass:"title"},[i("Logo",{attrs:{width:"65"},model:{value:e.webstieRecord.netdiskLogo,callback:function(t){e.$set(e.webstieRecord,"netdiskLogo",t)},expression:"webstieRecord.netdiskLogo"}}),e._v(" "),i("div",{staticClass:"jmal-cloud-name"},[i("div",[e._v(e._s(e.webstieRecord.netdiskName?e.webstieRecord.netdiskName:"JmalCloud"))])])],1)]),e._v(" "),e.initialize?i("h3",{staticClass:"title"},[e._v("創建管理員")]):e._e()]),e._v(" "),i("el-form-item",{attrs:{prop:"username"}},[i("span",{staticClass:"svg-container"},[i("svg-icon",{attrs:{"icon-class":"user"}})],1),e._v(" "),i("el-input",{ref:"username",attrs:{placeholder:"用戶名",name:"username",type:"text",tabindex:"1","auto-complete":"on"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"password"}},[i("span",{staticClass:"svg-container"},[i("svg-icon",{attrs:{"icon-class":"password"}})],1),e._v(" "),i("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"密碼",name:"password",tabindex:"2","auto-complete":"on"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}}),e._v(" "),i("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[i("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1),e._v(" "),e.initialize?e._e():i("el-form-item",{staticClass:"remember"},[i("el-checkbox",{attrs:{label:"記住我"},model:{value:e.loginForm.rememberMe,callback:function(t){e.$set(e.loginForm,"rememberMe",t)},expression:"loginForm.rememberMe"}})],1),e._v(" "),e.initialize?i("el-form-item",{attrs:{prop:"confirmPassword"}},[i("span",{staticClass:"svg-container"},[i("svg-icon",{attrs:{"icon-class":"password"}})],1),e._v(" "),i("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"確認密碼",name:"password",tabindex:"2","auto-complete":"on"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.confirmPassword,callback:function(t){e.$set(e.loginForm,"confirmPassword",t)},expression:"loginForm.confirmPassword"}}),e._v(" "),i("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[i("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1):e._e(),e._v(" "),i("el-button",{staticStyle:{width:"100%",margin:"30px 0"},attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[e._v(e._s(e.initialize?"創建":"登錄"))])],1)],1),e._v(" "),i("footer",{staticClass:"clearfix",attrs:{id:"footer"}},[i("br"),i("br"),i("br"),e._v(" "),i("div",{staticClass:"copyright"},[i("p",[i("span",[e._v(e._s(e.webstieRecord.copyright))])]),e._v(" "),i("p",[i("a",{attrs:{href:"http://beian.miit.gov.cn",target:"_blank"}},[e._v(e._s(e.webstieRecord.recordPermissionNum))])])]),e._v(" "),i("br")])],1)},n=[],s=i("9bf0"),o=i("c24f"),r=i("5f87"),l=i("1383"),c=(i("9dce"),{name:"Login",components:{Logo:l["a"]},data:function(){var e=this,t=function(t,i,a){e.validUsername(i)?a():a(new Error("請輸入正確的用戶名"))},a=function(e,t,i){t.length<6||i()},n=function(t,i,a){i.length<6||(e.loginForm.password!==i?a(new Error("密碼不一致")):a())};return{webstieRecord:{copyright:"Copyright © 2020 Journey Magical AL",recordPermissionNum:'"鄂 ICP 備 2020021454 號 - 1"',netdiskName:"jmalcloud",netdiskLogo:""},loginForm:{username:"",password:"",rememberMe:!1,confirmPassword:""},loginRules:{username:[{required:!0,trigger:"blur",validator:t}],password:[{required:!0,trigger:"blur",validator:a}],confirmPassword:[{required:!0,trigger:"blur",validator:n}]},loading:!1,passwordType:"password",redirect:void 0,initialize:!1,backgroundImg:{background:"url("+i("a598")+")",width:"100%",height:"100%",position:"absolute"}}},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect,e.query.path&&(this.redirect+="&path=".concat(e.query.path))},immediate:!0}},mounted:function(){var e=this;Object(o["d"])().then((function(t){t.count<1&&(e.initialize=!0)}));var t=Object(r["b"])();t&&(this.loginForm.username=t,this.loginForm.rememberMe=!0),Object(s["d"])().then((function(t){e.webstieRecord=t.data,(e.webstieRecord.netdiskName||e.webstieRecord.netdiskLogo)&&e.$store.dispatch("user/setLogo",{netdiskName:e.webstieRecord.netdiskName,netdiskLogo:e.webstieRecord.netdiskLogo})}))},methods:{showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},handleLogin:function(){var e=this;this.$refs.loginForm.validate((function(t){if(!t)return!1;if(e.initialize){var i=new FormData;i.append("username",e.loginForm.username),i.append("password",e.loginForm.password),Object(o["e"])(i).then((function(){e.initialize=!1,e.$message.success("創建成功")}))}else e.loading=!0,e.$store.dispatch("user/login",e.loginForm).then((function(){e.$store.dispatch("user/setMenuList").then((function(t){e.$router.push({path:e.redirect||"/"}),e.loading=!1})).catch((function(){e.loading=!1}))})).catch((function(){e.loading=!1}))}))},validUsername:function(){return!0}}}),d=c,u=(i("2017"),i("33d6"),i("2877")),h=Object(u["a"])(d,a,n,!1,null,"66904b17",null);t["default"]=h.exports},"9ef7":function(e,t,i){"use strict";i("1a60")},a0a2:function(e,t,i){"use strict";i("d801")},a1f0:function(e,t,i){},a36b:function(e,t,i){e.exports=i.p+"static/img/404.a57b6f31.png"},a598:function(e,t,i){e.exports=i.p+"static/img/login-bg.72db061a.png"},a8c4:function(e,t,i){var a={"./views/404":"8cdb","./views/404.vue":"8cdb","./views/favorite":"93ab","./views/favorite/":"93ab","./views/favorite/index":"93ab","./views/favorite/index.vue":"93ab","./views/fileType/audio":"e054","./views/fileType/audio.vue":"e054","./views/fileType/document":"c1fe","./views/fileType/document.vue":"c1fe","./views/fileType/image":"de32","./views/fileType/image.vue":"de32","./views/fileType/video":"c1b6","./views/fileType/video.vue":"c1b6","./views/home":"7abe","./views/home/":"7abe","./views/home/index":"7abe","./views/home/index.vue":"7abe","./views/home/mobile":"1a40","./views/home/mobile/":"1a40","./views/home/mobile/index":"1a40","./views/home/mobile/index.vue":"1a40","./views/login":"9ed6","./views/login/":"9ed6","./views/login/index":"9ed6","./views/login/index.vue":"9ed6","./views/markdown":"816e","./views/markdown/":"816e","./views/markdown/EditElement":"4308","./views/markdown/EditElement.vue":"4308","./views/markdown/index":"816e","./views/markdown/index.vue":"816e","./views/public/share/shareList":"488d","./views/public/share/shareList.vue":"488d","./views/recently":"e053","./views/recently/":"e053","./views/recently/index":"e053","./views/recently/index.vue":"e053","./views/setting/articles/alonePageManager":"0fb2","./views/setting/articles/alonePageManager.vue":"0fb2","./views/setting/articles/articleManager":"b0d9","./views/setting/articles/articleManager.vue":"b0d9","./views/setting/articles/articlePageManager":"85d7","./views/setting/articles/articlePageManager.vue":"85d7","./views/setting/articles/blogManager":"35c2","./views/setting/articles/blogManager.vue":"35c2","./views/setting/articles/categoryManager":"23a0","./views/setting/articles/categoryManager.vue":"23a0","./views/setting/articles/tagManager":"1069","./views/setting/articles/tagManager.vue":"1069","./views/setting/authAPP":"961d","./views/setting/authAPP.vue":"961d","./views/setting/cloudManager":"8740","./views/setting/cloudManager.vue":"8740","./views/setting/sys/cusomerInfo":"f9ca","./views/setting/sys/cusomerInfo.vue":"f9ca","./views/setting/sys/cusomerManager":"3158","./views/setting/sys/cusomerManager.vue":"3158","./views/setting/sys/logList":"4d8d","./views/setting/sys/logList.vue":"4d8d","./views/setting/sys/logLogin":"ddfe","./views/setting/sys/logLogin.vue":"ddfe","./views/setting/sys/logOperation":"f9f9","./views/setting/sys/logOperation.vue":"f9f9","./views/setting/sys/menuManager":"aeaa","./views/setting/sys/menuManager.vue":"aeaa","./views/setting/sys/roleManager":"f620","./views/setting/sys/roleManager.vue":"f620","./views/share":"1044","./views/share/":"1044","./views/share/index":"1044","./views/share/index.vue":"1044","./views/upload/mobile":"72d3","./views/upload/mobile/":"72d3","./views/upload/mobile/index":"72d3","./views/upload/mobile/index.vue":"72d3"};function n(e){var t=s(e);return i(t)}function s(e){var t=a[e];if(!(t+1)){var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}return t}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id="a8c4"},ab66:function(e,t,i){"use strict";i("42f3")},aeaa:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{staticClass:"dialog-form",attrs:{width:"600px",title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium","label-width":"90px",model:e.form,rules:e.rules}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12}},[i("el-form-item",{attrs:{label:"上級菜單:",prop:"parentId"}},[i("tree-select",{ref:"selectTree",attrs:{placeholder:"請選擇上級菜單",props:{value:"id",label:"name"},options:e.dataList,clearable:""},model:{value:e.form.parentId,callback:function(t){e.$set(e.form,"parentId",t)},expression:"form.parentId"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"菜單名稱:",prop:"name"}},[i("el-input",{attrs:{placeholder:"請輸入菜單名稱"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"菜單圖標:",prop:"icon"}},[i("icon-select",{model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"路由地址:",prop:"path"}},[i("el-input",{attrs:{placeholder:"請輸入路由地址"},model:{value:e.form.path,callback:function(t){e.$set(e.form,"path",t)},expression:"form.path"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"組件路徑:",prop:"component"}},[i("el-input",{attrs:{placeholder:"請輸入組件路徑"},model:{value:e.form.component,callback:function(t){e.$set(e.form,"component",t)},expression:"form.component"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12}},[i("el-form-item",{attrs:{label:"權限標識:",prop:"authority"}},[i("el-select",{staticClass:"al-select",attrs:{placeholder:"請選擇權限標識",clearable:"","popper-append-to-body":!1},model:{value:e.form.authority,callback:function(t){e.$set(e.form,"authority",t)},expression:"form.authority"}},e._l(e.authorityList,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"排序號:",prop:"sortNumber"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.form.sortNumber,callback:function(t){e.$set(e.form,"sortNumber",t)},expression:"form.sortNumber"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"是否隱藏:",prop:"hide"}},[i("el-radio",{attrs:{label:!1},model:{value:e.form.hide,callback:function(t){e.$set(e.form,"hide",t)},expression:"form.hide"}},[e._v("顯示")]),e._v(" "),i("el-radio",{attrs:{label:!0},model:{value:e.form.hide,callback:function(t){e.$set(e.form,"hide",t)},expression:"form.hide"}},[e._v("隱藏")])],1),e._v(" "),i("el-form-item",{attrs:{label:"菜單類型:",prop:"menuType"}},[i("el-radio",{attrs:{label:0},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[e._v("菜單")]),e._v(" "),i("el-radio",{attrs:{label:1},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[e._v("按鈕")])],1),e._v(" "),1!==e.form.menuType?i("el-form-item",{attrs:{label:"菜單位置:",prop:"menuType"}},[i("el-radio-group",{attrs:{size:"mini"},model:{value:e.form.menuType,callback:function(t){e.$set(e.form,"menuType",t)},expression:"form.menuType"}},[i("el-radio-button",{attrs:{label:2}},[e._v("設置")]),e._v(" "),i("el-radio-button",{attrs:{label:3}},[e._v("頂部")]),e._v(" "),i("el-radio-button",{attrs:{label:4}},[e._v("右上")])],1)],1):e._e()],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.updateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.onSave()}}},[e._v("保 存")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card table-search-header"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("el-form",{ref:"queryForm",staticClass:"search-form",attrs:{size:"medium","label-width":"77px",model:e.queryCondition,rules:e.rules}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12,md:8}},[i("el-form-item",{attrs:{label:"菜單名稱:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:8}},[i("el-form-item",{attrs:{label:"菜單地址:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.path,callback:function(t){e.$set(e.queryCondition,"path",t)},expression:"queryCondition.path"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:8}},[i("div",{staticClass:"el-form-actions"},[i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.getMenuTree()}}},[e._v("查詢")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.add()}}},[e._v("添加")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:e.isExpand?"el-icon-remove-outline":"el-icon-circle-plus-outline",type:"primary"},on:{click:function(t){return e.handleExpand()}}},[e._v(e._s(e.isExpand?"摺疊":"展開"))])],1)])],1)],1)],1)]),e._v(" "),i("table-list",{ref:"tableMenu",attrs:{"has-selection":!1,tableData:e.dataList,"less-client-height":210,loading:e.loading,tableHeader:e.tableHeader,pagination:e.pagination,"is-expand":e.isExpand},on:{"update:isExpand":function(t){e.isExpand=t},"update:is-expand":function(t){e.isExpand=t},pageChange:e.pageChange,sizeChange:e.pageChange,selectFun:e.selectFun,sortChange:e.sortChange}})],1)],1)},n=[],s=(i("ac6a"),i("c80c")),o=(i("96cf"),i("3b8d")),r=i("db72"),l=i("1f27"),c=i("7c83"),d=i("d693"),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-popover",{ref:"popover",attrs:{placement:"bottom-start","popper-class":"al-icon-picker-popper",width:"400",trigger:"click"},on:{show:e.showPopover,hide:e.hidePopover}},[i("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"本地",name:"first"}},[i("icon-list",{ref:"local",attrs:{"icon-list":e.iconList},on:{select:e.select}})],1),e._v(" "),i("el-tab-pane",{attrs:{label:"iconfont",name:"second"}},[i("icon-list",{ref:"iconfont",attrs:{"icon-list":e.iconfontList},on:{select:e.select}})],1)],1),e._v(" "),i("div",{class:{"al-icon-picker":!0,"al-icon-picker-open":e.pickerOpen},attrs:{slot:"reference"},on:{mouseenter:function(t){e.hovering=!0},mouseleave:function(t){e.hovering=!1}},slot:"reference"},[i("el-input",{attrs:{type:"text",clearable:"",readonly:"",placeholder:"請選擇圖標"},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}},[i("span",{staticClass:"el-input__prefix-inner",attrs:{slot:"prefix"},slot:"prefix"},[i("svg-icon",{attrs:{"icon-class":e.currentValue}})],1),e._v(" "),i("span",{staticClass:"el-input__suffix-inner",attrs:{slot:"suffix"},slot:"suffix"},[e.hovering&&e.currentValue.length>0?i("i",{staticClass:"el-input__icon el-icon-circle-close el-input__clear",on:{mousedown:function(e){e.preventDefault()},click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleClear.apply(null,arguments)}}}):i("i",{staticClass:"el-select__caret el-input__icon el-icon-arrow-down"})])])],1)],1)},h=[],f=(i("4917"),i("51ff")),p=function(e){return e.keys()},m=/\.\/(.*)\.svg/,g=p(f).map((function(e){return e.match(m)[1]})),v=g,b=i("00a1"),w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-scrollbar",{staticStyle:{height:"280px"}},[i("el-row",e._l(e.iconList,(function(t,a){return i("el-col",{key:a,attrs:{span:4}},[i("el-card",{staticClass:"al-card-border",attrs:{shadow:"hover",title:t}},[i("div",{staticClass:"al-icon-picker-item",on:{click:function(i){return e.select(t)}}},[i("svg-icon",{attrs:{"icon-class":t}})],1)])],1)})),1)],1)},y=[],x={name:"IconList",props:{iconList:{type:Array,default:[]}},methods:{select:function(e){this.$emit("select",e)}}},C=x,k=i("2877"),_=Object(k["a"])(C,w,y,!1,null,null,null),L=_.exports,S={name:"IconSelect",components:{IconList:L},props:{value:{type:String,default:"sdfsd"}},data:function(){return{iconList:v,iconfontList:b["b"].list,currentValue:this.value,hasValue:!0,pickerOpen:!1,hovering:!1,activeName:"first"}},watch:{value:function(e){this.currentValue=e}},mounted:function(){},methods:{showPopover:function(){this.pickerOpen=!0},hidePopover:function(){this.pickerOpen=!1},select:function(e){this.currentValue=e,this.$emit("input",e),this.$refs.popover.doClose()},handleClear:function(){this.currentValue="",this.$emit("input","")},handleTabClick:function(){}}},I=S,F=(i("090c"),Object(k["a"])(I,u,h,!1,null,"700688ce",null)),T=F.exports,D={components:{IconSelect:T,TreeSelect:d["a"],TableList:c["a"]},props:{},data:function(){var e=this;return{title:"角色管理",dataList:[],authorityList:[],loading:!1,dialogVisible:!1,dialogTitle:"",updateLoading:!1,valid:!0,isExpand:!1,form:{name:"",parentId:"",authority:"",path:"",component:"",icon:"",sortNumber:"",menuType:0,hide:!1},pagination:{pageIndex:1,pageSize:15,pageTotal:0},queryCondition:{name:"",code:"",remarks:"",sortProp:"",sortOrder:""},tableHeader:[{prop:"name",label:"菜單名稱",noScope:!0,align:"left"},{prop:"icon",label:"圖標",icon:!0,formatData:function(e){return e},width:50},{prop:"path",label:"路由地址"},{prop:"component",label:"組件路徑"},{prop:"authority",label:"權限標識"},{prop:"sortNumber",label:"排序",width:50},{prop:"hide",label:"隱藏",width:50,formatData:function(e){return e?"是":"否"}},{prop:"menuType",label:"類型",width:100,tag:!0,formatData:function(e){switch(e){case 0:return[{name:"首頁菜單"}];case 1:return[{name:"按鈕"}];case 2:return[{name:"設置菜單"}];case 3:return[{name:"頂部菜單"}];case 4:return[{name:"右上角菜單"}]}}},{label:"操作",minWidth:this.$pc?0:130,active:[{name:"修改",icon:"el-icon-edit",handle:function(t){return e.handleEdit(t.id)}},{name:"刪除",icon:"el-icon-delete",color:"#ff4d4f",handle:function(t){return e.handleDelete([t.id])}}]}],multipleSelection:[],rules:{name:[{required:!0,message:"請輸入菜單名稱",trigger:"blur"}],sortNumber:[{required:!0,message:"請輸入排序號",trigger:"blur"}]},editMove:1}},computed:{},mounted:function(){this.getMenuTree(),this.getAuthorityList(),this.resize()},methods:{resize:function(){document.querySelector(".container").clientWidth},selectFun:function(e){this.multipleSelection=e.backData},sortChange:function(e){var t=e.backData;this.queryCondition.sortProp=t.prop,this.queryCondition.sortOrder=t.order,this.getRoleList()},pageChange:function(e){this.pagination=e.backData,this.getMenuTree()},getAuthorityList:function(){var e=this;l["a"].authorityList().then((function(t){e.authorityList=t.data}))},getMenuTree:function(){var e=this;this.loading=!0,l["a"].menuTree(Object(r["a"])({page:this.pagination.pageIndex,pageSize:this.pagination.pageSize},this.queryCondition)).then((function(t){e.dataList=t.data,e.pagination.pageTotal=t.count,e.loading=!1}))},add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogVisible=!0,this.dialogTitle="添加角色",this.editMove=1,e.next=5,this.$nextTick();case 5:this.$refs.managerForm.resetFields(),this.$refs.selectTree.clearHandle();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleExpand:function(){this.isExpand=!this.isExpand,this.$refs.tableMenu.handleExpand()},setFormData:function(){var e=new FormData;for(var t in this.form)this.form.hasOwnProperty(t)&&e.append(t,this.form[t]);return e.delete("createTime"),e.delete("updateTime"),e},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.updateLoading=!0,1===e.editMove&&e.addMenu(e.setFormData()),2===e.editMove&&e.updateMenu(e.setFormData())}))},handleEdit:function(e){var t=this;this.editMove=2,this.dialogVisible=!0,this.dialogTitle="修改菜單",l["a"].menuInfo({menuId:e}).then((function(e){t.form=e.data}))},resetPassword:function(){var e=this;this.$confirm("確定重置該用戶密碼嗎, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){resetPass(e.form.id).then((function(){})).catch((function(){e.onError()}))}))},handleSelectDelete:function(){var e=this;this.$confirm("確定要刪除選中的角色嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=[];e.multipleSelection.forEach((function(e){t.push(e.id)})),e.deleteMenu(t)}))},handleDelete:function(e){var t=this;this.$confirm("確定要刪除嗎？","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteMenu(e)}))},deleteMenu:function(e){var t=this;l["a"].delete({menuIds:e}).then((function(){t.onSuccess("刪除成功!")})).catch((function(){t.onError()}))},updateMenu:function(e){var t=this;l["a"].update(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},addMenu:function(e){var t=this;l["a"].add(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},onSuccess:function(e){this.getMenuTree();var t="保存成功!";e&&(t=e),this.updateLoading=!1,this.dialogVisible=!1,this.$message({message:t,type:"success",duration:1e3})},onError:function(){this.updateLoading=!1}}},$=D,N=(i("e1e7"),Object(k["a"])($,a,n,!1,null,"bf95861c",null));t["default"]=N.exports},b0d9:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:e.title,fullscreen:!0,visible:e.newArticleDialogVisible,"before-close":e.handleClose,"destroy-on-close":!0},on:{"update:visible":function(t){e.newArticleDialogVisible=t},open:e.openDialog,close:e.closeDialog}},[i("markdown-editor",{ref:"editor",attrs:{"has-change":e.hasChange,"alone-page":e.alonePage,"site-url":e.siteUrl,"is-edit":e.isEdit},on:{"update:hasChange":function(t){e.hasChange=t},"update:has-change":function(t){e.hasChange=t},onTitle:e.onTitle,onRelease:e.onRelease}})],1),e._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("div",{staticClass:"clearfix card-header-back"},[i("span",[e._v(e._s(e.alonePage?"管理獨立頁面":"管理文章"))]),e._v(" "),i("el-button",{staticClass:"card-button",attrs:{size:"mini",type:"primary"},on:{click:e.newArticle}},[e._v(e._s(e.newArticleText))])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:this.multipleSelection.length>0,expression:"this.multipleSelection.length > 0"}],staticClass:"card-header-right"},[i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.handleDelete()}}},[e._v("刪除")])],1)])]),e._v(" "),i("div",[i("div",{staticClass:"table-top"},[i("el-row",[i("el-col",{attrs:{xs:24,sm:5}},[i("div",{staticClass:"query-item"},[i("el-badge",{attrs:{hidden:0===e.draftNums,value:e.draftNums,type:"primary"}},[i("el-radio-group",{attrs:{size:"mini"},on:{change:e.getArticleList},model:{value:e.query.radioStatus,callback:function(t){e.$set(e.query,"radioStatus",t)},expression:"query.radioStatus"}},[i("el-radio-button",{attrs:{label:""}},[e._v("可用")]),e._v(" "),e.alonePage?e._e():i("el-radio-button",{attrs:{label:"release"}},[e._v("已發佈")]),e._v(" "),i("el-radio-button",{attrs:{label:"draft"}},[e._v("草稿")])],1)],1)],1)]),e._v(" "),i("el-col",{attrs:{xs:24,sm:5}},[i("div",{staticClass:"query-item"},[i("span",{staticClass:"table-top-author"},[e._v("作者:")]),e._v(" "),i("el-radio-group",{attrs:{size:"mini"},on:{change:e.getArticleList},model:{value:e.query.radioUser,callback:function(t){e.$set(e.query,"radioUser",t)},expression:"query.radioUser"}},[i("el-radio-button",{attrs:{label:"all"}},[e._v("所有")]),e._v(" "),i("el-radio-button",{attrs:{label:"my"}},[e._v("我的")])],1)],1)]),e._v(" "),i("el-col",{staticClass:"text-align-right",attrs:{xs:24,sm:14}},[e.isFilter?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.cancelFilter}},[e._v("取消篩選")]):e._e(),e._v(" "),i("el-input",{staticClass:"query-item",staticStyle:{width:"unset"},attrs:{clearable:"",size:"mini",placeholder:"請輸入關鍵字"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getArticleList.apply(null,arguments)}},model:{value:e.query.keyword,callback:function(t){e.$set(e.query,"keyword",t)},expression:"query.keyword"}}),e._v(" "),i("multiple-tree-select",{ref:"selectTree",staticClass:"query-item",attrs:{placeholder:"請選擇分類",size:"mini","collapse-tags":"",options:e.categories},model:{value:e.categoryIdsList,callback:function(t){e.categoryIdsList=t},expression:"categoryIdsList"}}),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.theFilter}},[e._v("篩選")])],1)],1)],1),e._v(" "),i("el-table",{class:{"el-table-alone-page":e.alonePage},attrs:{data:e.articleList,"max-height":e.tableMaxHeight,"row-key":"id",size:"medium"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name","show-overflow-tooltip":!0,"min-width":"200",label:"標題"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("a",{attrs:{title:"編輯 "+t.row.name},on:{click:function(i){return e.editArticle(t.row.id)}}},[e._v(e._s(t.row.name)),i("svg-icon",{attrs:{"icon-class":"bianji-"}})],1),e._v(" "),i("a",{attrs:{title:"瀏覽 "+t.row.name,href:(e.alonePage?e.siteUrl+"/o/":e.siteUrl+"/s/")+t.row.slug,target:"_blank"}},[i("svg-icon",{staticClass:"wailian",attrs:{"icon-class":"wailian"}})],1)]}}])}),e._v(" "),e.alonePage?e._e():i("el-table-column",{attrs:{"min-width":"100",label:"狀態"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.draft?i("el-tag",{attrs:{size:"medium",type:"warning"}},[e._v("草稿")]):e._e(),e._v(" "),t.row.release?i("el-tag",{attrs:{size:"medium",type:"success"}},[e._v("已發佈")]):e._e(),e._v(" "),t.row.release?e._e():i("el-tag",{attrs:{size:"medium",type:"info"}},[e._v("未發佈")])]}}],null,!1,4167391289)}),e._v(" "),e.alonePage?i("el-table-column",{attrs:{prop:"slug",label:"縮略名"}}):e._e(),e._v(" "),i("el-table-column",{attrs:{prop:"username",label:"作者"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.alonePage?e._e():i("a",{on:{click:function(i){return e.theFilterUserId(t.row.userId)}}},[e._v(e._s(t.row.username))]),e._v(" "),e.alonePage?i("span",[e._v(e._s(t.row.username))]):e._e()]}}])}),e._v(" "),e.alonePage?e._e():i("el-table-column",{attrs:{prop:"categories",label:"分類"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.categories,(function(t,a){return i("span",[e._v("\n            "+e._s(a>0?",":"")+"\n            "),i("a",{on:{click:function(i){return e.theFilterCategoty(t.id)}}},[e._v(e._s(t.name))])])}))}}],null,!1,3795730018)}),e._v(" "),i("el-table-column",{attrs:{prop:"updateDate",label:"發佈日期",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.uploadDate.substring(0,16)))])]}}])})],1)],1),e._v(" "),i("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"","hide-on-single-page":!0,"current-page":e.pagination.pageIndex,"page-sizes":e.pagination.pageSizes,"page-size":e.pagination.pageSize,total:e.pagination.total,layout:"total, prev, pager, next"},on:{"update:currentPage":function(t){return e.$set(e.pagination,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageIndex",t)},"current-change":e.currentChange}})],1)],1)},n=[],s=(i("a481"),i("28a5"),i("7f7f"),i("ac6a"),i("aa47")),o=i("816e"),r=i("021e"),l=i("c405"),c=i("5cfc"),d=i("9bf0"),u=i("eea1"),h={name:"articleManager",components:{MultipleTreeSelect:u["a"],MarkdownEditor:o["default"]},props:{pageTitle:{type:String,default:""},alonePage:{type:Boolean,default:!1},newArticleText:{type:String,default:""}},data:function(){return{tableMaxHeight:document.documentElement.clientHeight,newArticleDialogVisible:!1,title:this.pageTitle,hasChange:!1,articleList:[],pagination:{pageIndex:this.$route.query.page?parseInt(decodeURI(this.$route.query.page)):1,pageSize:12,total:0},categories:[],categoryIdsList:[],isFilter:!1,query:{radioStatus:"",radioUser:"my",userId:void 0,keyword:void 0,categoryIds:void 0},draftNums:0,multipleSelection:[],siteUrl:"".concat(window.location.origin,"/articles"),isEdit:!1}},computed:{},created:function(){this.$route.query.keyword&&(this.query.keyword=this.$route.query.keyword,this.isFilter=!0),this.$route.query.categoryIds&&(this.query.categoryIds=this.$route.query.categoryIds,this.isFilter=!0)},mounted:function(){var e=this;this.getArticleList(),this.categoryTree(),this.getWebsiteSetting(),this.newArticleDialogVisible=!!this.$route.query.operation,window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1)),window.addEventListener("beforeunload",(function(t){return e.beforeunloadFn(t)})),this.alonePage&&(document.body.ondrop=function(e){e.preventDefault(),e.stopPropagation()},this.rowDrop()),this.setMaxHeight();var t=this;window.onresize=function(){t.setMaxHeight()}},watch:{hasChange:function(e){window.onbeforeunload=e?function(){return"還有文件正在上傳, 確定退出嗎?"}:null}},methods:{setMaxHeight:function(){this.tableMaxHeight=document.documentElement.clientHeight-265},rowDrop:function(){var e=document.querySelector(".el-table__body-wrapper tbody"),t=this;s["a"].create(e,{onEnd:function(e){var i=e.newIndex,a=e.oldIndex,n=t.articleList.splice(a,1)[0];t.articleList.splice(i,0,n);var s=[];t.articleList.forEach((function(e){s.push(e.id)})),r["a"].sortMarkdown(s).then((function(){})).catch((function(){}))}})},handleSelectionChange:function(e){this.multipleSelection=e},handleDelete:function(){var e=this,t=[];this.multipleSelection.length>0&&this.multipleSelection.forEach((function(e){t.push(e.id)})),this.$confirm("此操作將永久刪除選中的文章, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){c["a"].delete({username:e.$store.state.user.name,fileIds:t}).then((function(){e.getArticleList()})).then((function(){e.$notify({title:"刪除成功",type:"success",duration:1e3})}))}))},beforeunloadFn:function(){return"確定要退出嗎？"},goBack:function(){var e=this.$route.query.operation;this.newArticleDialogVisible=!!e},getWebsiteSetting:function(){var e=this;Object(d["c"])({userId:this.$store.state.user.userId}).then((function(t){t.data&&(e.siteUrl=t.data.siteUrl)}))},cancelFilter:function(){this.query.userId="",this.query.keyword="",this.categoryIdsList=[],this.theFilter()},theFilter:function(){var e=this;this.query.categoryIds="",this.categoryIdsList.length>0&&(this.categoryIdsList.forEach((function(t){e.query.categoryIds+=t+","})),this.query.categoryIds=this.query.categoryIds.substring(0,this.query.categoryIds.length-1)),this.getArticleList()},theFilterUserId:function(e){this.query.userId=e,this.theFilter()},theFilterCategoty:function(e){this.categoryIdsList=[e],this.theFilter()},filterQuery:function(){this.isFilter=!1,this.query.keyword&&0!==this.query.keyword.length?this.isFilter=!0:this.query.keyword=void 0,this.query.categoryIds&&0!==this.query.categoryIds.length?this.isFilter=!0:this.query.categoryIds=void 0,this.query.userId&&0!==this.query.userId.length?this.isFilter=!0:this.query.userId=void 0,this.$route.query.operation||this.$router.push({query:{uid:this.query.userId,keyword:this.query.keyword,categoryIds:this.query.categoryIds}})},getArticleList:function(){var e=this;this.filterQuery(),r["a"].getMarkdown({pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize,userId:"my"===this.query.radioUser?this.$store.state.user.userId:this.query.userId?this.query.userId:null,isRelease:"release"===this.query.radioStatus,isDraft:"draft"===this.query.radioStatus,isAlonePage:this.alonePage,keyword:this.query.keyword,categoryIds:this.query.categoryIds}).then((function(t){e.articleList=t.data,e.pagination.total=t.count,e.$nextTick((function(){e.isLoading=!1}))})),r["a"].getMarkdown({pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize,isAlonePage:this.alonePage,isDraft:!0}).then((function(t){e.draftNums=t.count}))},currentChange:function(){this.$router.push({query:{page:this.pagination.pageIndex}}),this.getArticleList()},newArticle:function(){this.newArticleDialogVisible=!0,this.$router.push({query:{operation:"new"}}),this.isEdit=!1},editArticle:function(e){this.isEdit=!0,this.newArticleDialogVisible=!0,this.$router.push({query:{operation:"editor",id:e}}),this.$refs.editor&&this.$refs.editor.reload()},categoryTree:function(){var e=this;l["a"].categoryTree().then((function(t){e.categories=t.data,e.$route.query.categoryIds&&(e.query.categoryIds=e.$route.query.categoryIds,e.categoryIdsList=e.query.categoryIds.split(","))}))},handleClose:function(e){this.hasChange?this.$confirm("還有未保存的內容，確定要離開嗎？","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){e()})):e()},onTitle:function(e){var t=this.$route.query.operation;"new"===t&&(this.title="撰寫新文章 "+e,this.alonePage&&(this.title="創建新頁面 "+e),this.isEdit=!1),"editor"===t&&(this.title="編輯："+e,this.isEdit=!0)},openDialog:function(){this.title="撰寫新文章",this.alonePage&&(this.title="創建新頁面")},onRelease:function(){this.newArticleDialogVisible=!1,this.closeDialog()},closeDialog:function(){this.title=this.pageTitle,this.$router.replace({path:this.$route.path}),window.onbeforeunload=null,this.hasChange=!1,this.getArticleList()}}},f=h,p=(i("5ba2"),i("2877")),m=Object(p["a"])(f,a,n,!1,null,"8aff5c9a",null);t["default"]=m.exports},b12d:function(e,t,i){},b2233:function(e,t,i){"use strict";i("9bd6")},b47a:function(e,t,i){"use strict";i("9ea1")},b62b:function(e,t,i){},b801:function(e,t,i){},b8c1:function(e,t,i){},bb40:function(e,t,i){"use strict";i("fc9a")},bb52:function(e,t,i){},bb64:function(e,t,i){},bbd7:function(e,t,i){},bcb5:function(e,t,i){"use strict";i("7088")},c056:function(e,t,i){"use strict";i("fff3")},c145:function(e,t,i){},c1b6:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{queryFileType:"video",orderCustom:!0,defaultGrid:!1,sortable:e.sortable,queryCondition:e.queryCondition,emptyStatus:"還沒有視頻呢~"}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFolder:!1}}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"3c27bffe",null);t["default"]=c.exports},c1fe:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{queryFileType:"document",orderCustom:!0,defaultGrid:!1,sortable:e.sortable,queryCondition:e.queryCondition,emptyStatus:"還沒有文檔呢~"}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFolder:!1}}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"70ae0430",null);t["default"]=c.exports},c405:function(e,t,i){"use strict";var a=i("b775"),n=i("4328");t["a"]={categories:function(e){return Object(a["a"])({url:"category/list",method:"get",params:e})},categoryTree:function(e){return Object(a["a"])({url:"category/tree",method:"get",params:e})},categoryInfo:function(e){return Object(a["a"])({url:"category/info",method:"get",params:e})},add:function(e){return Object(a["a"])({url:"category/add",method:"post",data:e})},update:function(e){return Object(a["a"])({url:"category/update",method:"put",data:e})},setDefault:function(e){return Object(a["a"])({url:"category/setDefault",method:"put",params:e})},delete:function(e){return Object(a["a"])({url:"category/delete",method:"delete",params:e,paramsSerializer:function(e){return n.stringify(e,{arrayFormat:"repeat"})}})}}},c41c:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"resize",rawName:"v-resize",value:e.containerResize,expression:"containerResize"}],staticClass:"dashboard-container",attrs:{onselectstart:"return false"}},[a("v-contextmenu",{ref:"homeContextmenu",attrs:{disabled:e.contextmenuDisabled}},e._l(e.contextMenus,(function(t){return a("div",{key:t.operation},[t.child?e._e():a("v-contextmenu-item",{attrs:{divider:!!t.divider},on:{click:function(i){return e.contextmenuClick(t.operation)}}},[t.iconClass?a("svg-icon",{attrs:{"icon-class":t.iconClass}}):e._e(),e._v("\n          "+e._s(t.label)+"\n        ")],1),e._v(" "),t.child?a("v-contextmenu-submenu",{attrs:{title:t.label}},e._l(t.child,(function(t){return a("div",{key:t.operation},[t.child?e._e():a("v-contextmenu-item",{attrs:{divider:!!t.divider},on:{click:function(i){return e.contextmenuClick(t.operation)}}},[t.iconClass?a("svg-icon",{attrs:{"icon-class":t.iconClass}}):e._e(),e._v("\n              "+e._s(t.label)+"\n            ")],1),e._v(" "),t.child?a("v-contextmenu-submenu",{attrs:{title:t.label}}):e._e()],1)})),0):e._e()],1)})),0),e._v(" "),a("el-breadcrumb",{staticClass:"app-breadcrumb",attrs:{separator:""}},[e.showNavigation?a("transition-group",{attrs:{name:"breadcrumb"}},e._l(e.pathList,(function(t,i){return a("el-breadcrumb-item",{key:t.folder+i},[0===i&&e.pathList.length>1?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"返回上一級",placement:"top"}},[a("a",{on:{click:function(t){return t.preventDefault(),e.lastLink()}}},[a("svg-icon",{staticStyle:{"font-size":"24px","margin-left":"20px"},attrs:{"icon-class":"back"}}),e._v(" ")],1)]):e._e(),e._v(" "),0===i&&e.pathList.length>2?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"根目錄",placement:"top"}},[a("a",{staticClass:"home-link",on:{click:function(a){return a.preventDefault(),e.handleLink(t,i)}}},[a("svg-icon",{staticStyle:{"font-size":"24px"},attrs:{"icon-class":"home"}})],1)]):e._e(),e._v(" "),a("breadcrumb-file-path",{attrs:{pathList:e.pathList,item:t,index:i},on:{clickLink:e.handleLink}})],1)})),1):e._e(),e._v(" "),a("div",{staticClass:"search-content"},[a("div",{staticClass:"search-class"},[a("el-popover",{directives:[{name:"show",rawName:"v-show",value:e.showUploadButton,expression:"showUploadButton"}],attrs:{placement:"bottom",trigger:"hover"},on:{click:e.showNewFolderClick,"after-leave":e.hideNewFolderName},model:{value:e.isShowNewFolder,callback:function(t){e.isShowNewFolder=t},expression:"isShowNewFolder"}},[a("div",{staticClass:"newFileMenu",staticStyle:{display:"block"}},[a("ul",[a("li",{on:{click:e.upload}},[a("label",{staticClass:"menuitem"},[a("svg-icon",{attrs:{"icon-class":"file-upload"}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v(e._s(""!==e.singleFileType?e.singleFileType:"上傳文件"))])],1)]),e._v(" "),""===e.singleFileType?a("li",{on:{click:e.uploadFolder}},[a("label",{staticClass:"menuitem"},[a("svg-icon",{attrs:{"icon-class":"folder-upload"}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v("上傳文件夾")])],1)]):e._e(),e._v(" "),""===e.singleFileType?a("li",{on:{click:function(t){return t.preventDefault(),e.newDocument.apply(null,arguments)}}},[a("a",{staticClass:"menuitem",attrs:{href:"#"}},[a("svg-icon",{attrs:{"icon-class":"md"}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v("寫文章")])],1)]):e._e(),e._v(" "),""===e.singleFileType?a("li",{on:{click:function(t){return t.preventDefault(),e.newFolder.apply(null,arguments)}}},[a("a",{staticClass:"menuitem",attrs:{href:"#"}},[a("svg-icon",{attrs:{"icon-class":"folder-add"}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v("新建文件夾")])],1)]):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showNewFolder,expression:"showNewFolder"}],staticClass:"folder-name-form"},[a("el-input",{ref:"newFolderName",attrs:{placeholder:"請輸入文件夾名稱",clearable:!0},on:{focus:e.setInputFocus,blur:function(t){return e.setInputBlur()}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.newFolderNameClickEnter.apply(null,arguments)}},model:{value:e.newFolderName,callback:function(t){e.newFolderName=t},expression:"newFolderName"}},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.newFolderLoading,expression:"newFolderLoading"}],staticClass:"el-icon-right",attrs:{slot:"append","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:e.newFolderNameClick},slot:"append"})],1)],1)])]),e._v(" "),a("button-upload",{staticStyle:{"margin-right":"5px"},attrs:{slot:"reference",name:""},nativeOn:{click:function(t){return e.upload.apply(null,arguments)}},slot:"reference"})],1),e._v(" "),a("el-input",{directives:[{name:"show",rawName:"v-show",value:e.showSearchButton,expression:"showSearchButton"}],attrs:{placeholder:"搜索",clearable:!0},on:{focus:e.setInputFocus,blur:function(t){return e.setInputBlur()}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchFile(e.searchFileName)}},model:{value:e.searchFileName,callback:function(t){e.searchFileName=t},expression:"searchFileName"}},[a("el-button",{attrs:{slot:"prepend"},on:{click:function(t){return e.searchFile(e.searchFileName)}},slot:"prepend"},[a("svg-icon",{staticStyle:{"font-size":"22px"},attrs:{"icon-class":"search"}})],1)],1),e._v(" "),a("el-dropdown",{staticStyle:{height:"40px"},attrs:{size:"medium"},on:{command:e.contextmenuClick}},[a("el-button",{staticClass:"sort",attrs:{type:"text"}},[a("svg-icon",{attrs:{"icon-class":"sort"}})],1),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"orderName"}},[a("span",{class:{"al-file-sort-item":!0,active:"name"===e.sortable.prop}},[a("i",{class:{"al-file-sort-item-icon":!0,"el-icon-top":"ascending"===e.sortable.order,"el-icon-bottom":"descending"===e.sortable.order}}),e._v(" "),a("span",[e._v("名稱")])])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"orderSize"}},[a("span",{class:{"al-file-sort-item":!0,active:"size"===e.sortable.prop}},[a("i",{class:{"al-file-sort-item-icon":!0,"el-icon-top":"ascending"===e.sortable.order,"el-icon-bottom":"descending"===e.sortable.order}}),e._v(" "),a("span",[e._v("大小")])])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"orderUpdateDate"}},[a("span",{class:{"al-file-sort-item":!0,active:"updateDate"===e.sortable.prop}},[a("i",{class:{"al-file-sort-item-icon":!0,"el-icon-top":"ascending"===e.sortable.order,"el-icon-bottom":"descending"===e.sortable.order}}),e._v(" "),a("span",[e._v("日期")])])])],1)],1),e._v(" "),a("el-button",{staticClass:"vmode",attrs:{type:"text"},on:{click:e.changeVmode}},[a("svg-icon",{attrs:{"icon-class":e.grid?"list":"grid"}})],1)],1)])],1),e._v(" "),a("div",[a("div",{staticClass:"info-statistics"},[e.tableLoading?a("span",[e._v("獲取更多數據...")]):e._e(),e._v(" "),e.tableLoading?e._e():a("span",[e._v(e._s(e.finished?"已全部加載 "+e.getSummaries3:"已加載 "+e.getSummaries3))])])]),e._v(" "),a("e-vue-contextmenu",{ref:"contextShow",staticClass:"newFileMenu",class:e.menuTriangle,on:{"ctx-show":e.show,"ctx-hide":e.hide}},[a("div",{staticClass:"popper-arrow"}),e._v(" "),e._l(e.menus,(function(t,i){return a("ul",{key:t.label},["unFavorite"===t.operation||"favorite"===t.operation?a("li",{on:{click:function(i){return e.menusOperations(t.operation)},mouseover:function(t){return t.preventDefault(),t.stopPropagation(),e.menuFavoriteOver(i,e.rowContextData.isFavorite)},mouseleave:function(t){return t.preventDefault(),t.stopPropagation(),e.menuFavoriteLeave(i,e.rowContextData.isFavorite)}}},[a("label",{staticClass:"menuitem"},[a("svg-icon",{attrs:{"icon-class":t.iconClass}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v(e._s(t.label))])],1)]):a("li",{on:{click:function(i){return e.menusOperations(t.operation)}}},[a("label",{staticClass:"menuitem"},[a("svg-icon",{attrs:{"icon-class":t.iconClass}}),e._v(" "),a("span",{staticClass:"menuitem text"},[e._v(e._s(t.label))])],1)])])}))],2),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.fileList.length>0,expression:"fileList.length > 0"}],style:{width:"100%",height:e.clientHeight+"px"},attrs:{id:"v-draw-rectangle"}},[a("pl-table",{directives:[{name:"show",rawName:"v-show",value:!e.grid,expression:"!grid"},{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"fileListTable",staticStyle:{width:"100%",margin:"20px 0 0 0"},attrs:{"max-height":e.clientHeight,"default-sort":e.sortable,"highlight-current-row":!1,"empty-text":"無文件","use-virtual":!0,"row-height":51.5,border:!1,"excess-rows":10,"pagination-show":!1,stripe:"","cell-style":e.rowStyle,"height-change":!1,"row-class-name":e.tableRowClassName,"element-loading-text":"文件加載中","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{"selection-change":e.handleSelectionChange,"row-contextmenu":e.rowContextmenu,"cell-click":e.cellClick,"row-dblclick":e.dblclick,"cell-mouse-enter":e.cellMouseEnter,"cell-mouse-leave":e.cellMouseLeave,"sort-change":e.sortChange,"table-body-scroll":e.tableBodyScroll,select:e.pinSelect}},[e._l(e.tableHead,(function(t,i){return[1===i?a("pl-table-column",{key:i,attrs:{index:i,align:"center","header-align":"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("icon-file",{attrs:{item:t.row,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl}})]}}],null,!0)}):e._e(),e._v(" "),2===i?a("pl-table-column",{key:i,attrs:{"show-overflow-tooltip":!0,"max-width":"200",index:i,prop:t.name,label:t.label,"sort-orders":["ascending","descending"],sortable:!!t.sortable&&(!e.orderCustom||"custom")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.editingIndex?a("el-input",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{span:10,placeholder:"",size:"small"},on:{focus:function(i){return e.renameInputFocus(i.currentTarget,t.row.suffix)},blur:function(t){return e.setInputBlur()}},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.rowRename(e.renameFileName,t.row)}},model:{value:e.renameFileName,callback:function(t){e.renameFileName=t},expression:"renameFileName"}}):a("span",{staticClass:"table-file-name"},[e._v(e._s(t.row.name))])]}}],null,!0)}):e._e(),e._v(" "),3===i&&e.showShareItem?a("pl-table-column",{key:i,attrs:{width:"50",index:i,align:"center","header-align":"center","tooltip-effect":"dark"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.cellMouseIndex?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"分享",placement:"top"}},[a("svg-icon",{staticClass:"button-class",attrs:{title:"分享","icon-class":"share"},on:{click:function(i){return i.stopPropagation(),e.share(t.row)}}})],1):e._e()]}}],null,!0)}):e._e(),e._v(" "),4===i&&e.showMoreItem?a("pl-table-column",{key:i,staticClass:"el-icon-more",attrs:{width:"50",prop:t.name,label:t.label,index:i,align:"center","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.index===e.cellMouseIndex?a("svg-icon",{staticClass:"button-class",attrs:{"icon-class":"more"},on:{click:function(i){return i.stopPropagation(),e.moreClick(t.row,i)}}}):e._e()]}}],null,!0)},[a("template",{slot:"header"},[""!==t.name?a("svg-icon",{staticClass:"button-class",attrs:{"icon-class":"more"},on:{click:function(t){return t.stopPropagation(),e.moreOperation(t)}}}):e._e()],1)],2):e._e(),e._v(" "),5===i&&e.showSizeItem?a("pl-table-column",{key:i,attrs:{width:"200",prop:t.name,index:i,label:t.label,"sort-orders":["ascending","descending"],sortable:!!t.sortable&&(!e.orderCustom||"custom"),"show-overflow-tooltip":!0,align:"left","header-align":"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.formatSize(t.row.size)))])]}}],null,!0)}):e._e(),e._v(" "),6===i&&e.showUpdateDateItem?a("pl-table-column",{key:i,attrs:{width:"250",prop:t.name,index:i,label:t.label,"sort-orders":["ascending","descending"],sortable:!!t.sortable&&(!e.orderCustom||"custom"),"show-overflow-tooltip":!0,align:"left","header-align":"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:t.row.updateDate,placement:"top"}},[a("span",[e._v("   "+e._s(e.formatTime(t.row.agoTime)))])])]}}],null,!0)}):e._e()]}))],2),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.grid,expression:"grid"},{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"文件加載中","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"}},[a("van-checkbox-group",{ref:"checkboxGroup",on:{change:e.handleSelectionChange},model:{value:e.selectRowData,callback:function(t){e.selectRowData=t},expression:"selectRowData"}},[a("van-grid",{style:{width:"100%","max-height":e.clientHeight-45+"px",overflow:"auto"},attrs:{square:"",center:!0,"column-num":e.gridColumnNum,gutter:10,border:!1}},e._l(e.fileList,(function(t,i){return a("van-grid-item",{key:t.id,ref:"gridItem",refInFor:!0,attrs:{title:"大小："+e.formatSize(t.size)+"\r\n"+(t.w&&t.h?"分辨率："+t.w+"x"+t.h+"\r\n":"")+"名稱："+t.name+"\r\n創建時間："+t.uploadDate+"\r\n修改時間："+t.updateDate+"\r\n路徑："+t.path}},[a("div",{staticClass:"grid-time van-grid-item__content van-grid-item__content--center van-grid-item__content--square",style:{background:e.selectRowData.includes(t)?"#caeaf991":"","background-size":"cover","background-position":"center",border:e.selectRowData.includes(t)?"solid 1px #409eff":""},on:{click:function(i){return e.gridItemClick(t)},dblclick:function(i){return e.fileClick(t)},contextmenu:function(i){return i.preventDefault(),e.rowContextmenu(t)}}},[a("div",{staticClass:"grid-item-icon"},[a("icon-file",{attrs:{item:t,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl,grid:!0,"grid-width":e.gridColumnWidth}})],1),e._v(" "),t.index===e.editingIndex?a("el-input",{directives:[{name:"focus",rawName:"v-focus"}],staticClass:"grid-item-text",attrs:{placeholder:"",type:"textarea",autosize:"",size:"small"},on:{focus:function(i){return e.renameInputFocus(i.currentTarget,t.suffix)},blur:function(t){return e.setInputBlur()}},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.rowRename(e.renameFileName,t)}},model:{value:e.renameFileName,callback:function(t){e.renameFileName=t},expression:"renameFileName"}}):a("div",{staticClass:"grid-item-text"},[e._v(e._s(t.name))])],1)])})),1)],1)],1),e._v(" "),a("table",{staticClass:"drag-table",attrs:{id:"drag-table"}})],1),e._v(" "),e.fileList.length<1&&!e.tableLoading?a("empty-file",{attrs:{emptyStatus:e.emptyStatus}}):e._e(),e._v(" "),a("img",{staticStyle:{position:"fixed",opacity:"0"},attrs:{id:"dragImage",draggable:"false",src:i("5116")}}),e._v(" "),e.selectFile?e._e():a("div",{staticClass:"number-files",attrs:{id:"numberFiles"}},[a("img",{staticClass:"icon",staticStyle:{display:"none"},attrs:{src:i("943c")}}),e._v(" "),a("div",{staticClass:"number",staticStyle:{display:"inline"}},[e._v("1個文件")]),e._v(" "),a("div",{staticClass:"operate",staticStyle:{display:"none","white-space":"nowrap"}},[e._v("\n        移動到：\n      ")]),e._v(" "),e._m(0)])],1),e._v(" "),a("sim-text-preview",{attrs:{file:e.textPreviewRow,status:e.textPreviewVisible},on:{"update:file":function(t){e.textPreviewRow=t},"update:status":function(t){e.textPreviewVisible=t}}}),e._v(" "),a("image-viewer",{attrs:{fileList:e.fileList,file:e.imagePreviewRow,status:e.imagePreviewVisible},on:{"update:status":function(t){e.imagePreviewVisible=t}}}),e._v(" "),a("video-preview",{attrs:{file:e.videoPreviewRow,status:e.videoPreviewVisible},on:{"update:status":function(t){e.videoPreviewVisible=t}}}),e._v(" "),a("office-preview",{attrs:{file:e.officePreviewRow,status:e.officePreviewVisible},on:{"update:status":function(t){e.officePreviewVisible=t}}}),e._v(" "),a("el-drawer",{attrs:{title:e.rowContextData.name,visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[a("div",{staticClass:"drawer-icon"},[a("icon-file",{staticClass:"drawer-icon-font",attrs:{grid:!0,details:!0,item:e.rowContextData,"image-url":e.imageUrl,"audio-cover-url":e.audioCoverUrl}})],1),e._v(" "),a("el-form",{staticClass:"details-form"},[a("el-form-item",{attrs:{label:"名稱:"}},[a("span",[e._v(e._s(e.rowContextData.name))])]),e._v(" "),a("el-form-item",{staticClass:"details-name",attrs:{label:"類型:"}},[a("span",[e._v(e._s(e.rowContextData.isFolder?"文件夾":e.rowContextData.contentType))])]),e._v(" "),e.rowContextData.music?a("div",[a("el-form-item",{attrs:{label:"🎵 歌手:"}},[a("span",[e._v(e._s(e.rowContextData.music.singer))])]),e._v(" "),a("el-form-item",{attrs:{label:"🎵 專輯:"}},[a("span",[e._v(e._s("《"+e.rowContextData.music.album+"》"))])]),e._v(" "),a("el-form-item",{attrs:{label:"🎵 歌名:"}},[a("span",[e._v(e._s("《"+e.rowContextData.music.songName+"》"))])])],1):e._e(),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.rowContextData.w&&e.rowContextData.h,expression:"rowContextData.w && rowContextData.h"}],staticClass:"details-resolution",attrs:{label:"分辨率:"}},[a("span",[e._v(e._s(e.rowContextData.w+" x "+e.rowContextData.h))])]),e._v(" "),a("el-form-item",{attrs:{label:"大小:"}},[a("span",[e._v(" "+e._s(e.rowContextData.size)+"字節 "+e._s(e.rowContextData.size>0?"("+e.formatSize(e.rowContextData.size)+")":""))])]),e._v(" "),a("el-form-item",{staticClass:"details-position",attrs:{label:"位置:"}},[a("a",{attrs:{href:"/?path="+e.rowContextData.path}},[e._v(e._s(e.rowContextData.path))])]),e._v(" "),a("el-form-item",{attrs:{label:"創建時間:"}},[a("span",[e._v(e._s(e.rowContextData.uploadDate))])]),e._v(" "),a("el-form-item",{attrs:{label:"修改時間:"}},[a("span",[e._v(e._s(e.rowContextData.updateDate))])])],1)],1),e._v(" "),a("el-dialog",{staticClass:"open-file-dialog",attrs:{title:"提示",top:"35vh",visible:e.openCompressionVisible},on:{"update:visible":function(t){e.openCompressionVisible=t}}},[a("svg-icon",{attrs:{"icon-class":"open-folder"}}),e._v(" "),a("span",{staticClass:"dialog-msg"},[e._v("查看壓縮文件")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.unzipTo(e.openingFile)}}},[e._v("解壓到...")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.unzip(e.openingFile,e.openingFile.id,!1)}}},[e._v("解壓到當前目錄")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.compressionFilePreview(e.openingFile)}}},[e._v("預覽")])],1)],1),e._v(" "),a("message-dialog",{attrs:{title:"提示",content:"此文件不支持預覽, 是否下載該文件?",show:e.notPreviewDialogVisible,operatButtonText:"強行使用文本編輯器打開",confirmButtonText:"下載"},on:{"update:show":function(t){e.notPreviewDialogVisible=t},operating:function(t){return e.forciblyOpen(e.openingFile)},confirm:function(t){return e.determineDownload(e.openingFile)}}}),e._v(" "),a("el-dialog",{attrs:{title:"預覽:"+e.compressedFileName,visible:e.compressedFileVisible},on:{"update:visible":function(t){e.compressedFileVisible=t}}},[a("file-tree",{attrs:{directoryTreeData:e.compressedFileData,tempDir:e.compressedFileTempDir}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.titlePrefix+e.selectTreeNode.showName,visible:e.dialogMoveOrCopyVisible},on:{"update:visible":function(t){e.dialogMoveOrCopyVisible=t},close:e.clearTreeNode}},[a("el-tree",{ref:"directoryTree",attrs:{data:e.directoryTreeData,"node-key":"id",props:e.directoryTreeProps,load:e.directoryTreeLoadNode,"highlight-current":!0,"default-expanded-keys":["0"],"render-content":e.renderContent,hight:"100",lazy:""},on:{"node-click":e.treeNodeClick,"node-expand":e.treeNodeExpand}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.fileTreeAndNewFolder}},[a("i",{staticClass:"el-icon-folder-add"}),e._v("  新建文件夾\n      ")]),e._v(" "),e.unzipOperating?e._e():a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.moveFileTree}},[e._v("移 動")]),e._v(" "),e.unzipOperating?e._e():a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.copyFileTree}},[e._v("複製")]),e._v(" "),e.unzipOperating?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmUnzip}},[e._v("解壓")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogMoveOrCopyVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分享:"+e.shareFileName,visible:e.shareDialog,center:""},on:{"update:visible":function(t){e.shareDialog=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.generateShareLinkLoading,expression:"generateShareLinkLoading"}]},[a("el-input",{attrs:{readonly:"readonly"},on:{focus:e.setInputFocus,blur:function(t){return e.setInputBlur()}},model:{value:e.shareLink,callback:function(t){e.shareLink=t},expression:"shareLink"}}),e._v(" "),a("div",{staticClass:"dialog-footer share-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"tag-share-link",attrs:{type:"primary","data-clipboard-text":e.shareLink},on:{click:e.copyShareLink}},[e._v("\n          複製鏈接\n        ")])],1)],1)]),e._v(" "),a("el-dialog",{staticClass:"new-text-file-dialog",attrs:{title:e.newCreateFileDialogTitle,"close-on-click-modal":!1,visible:e.newCreateFileDialog},on:{"update:visible":function(t){e.newCreateFileDialog=t}}},[a("el-input",{ref:"newCreateFileName",staticClass:"dialog-msg",attrs:{size:"small",clearable:!0},on:{focus:function(t){return e.renameInputFocus(t.currentTarget,"")},blur:function(t){return e.setInputBlur()}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.createFile(e.newCreateFileName)}},model:{value:e.newCreateFileName,callback:function(t){e.newCreateFileName=t},expression:"newCreateFileName"}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.newCreateFileDialog=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.createFileLoading,expression:"createFileLoading"}],attrs:{size:"small",type:"primary"},on:{click:function(t){return e.createFile(e.newCreateFileName)}}},[e._v("確定")])],1)],1)],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"target"},[i("span",{staticClass:"folder",staticStyle:{display:"none","white-space":"nowrap"}},[e._v("document")])])}],s=(i("55dd"),i("a481"),i("386d"),i("6762"),i("2fdb"),i("7514"),i("f559"),i("28a5"),i("7f7f"),i("20d6"),i("ac6a"),i("db72")),o=(i("c5f6"),i("2f62")),r=i("7f29"),l=i("26a1"),c=i("1000"),d=i("9dce"),u=i("5cfc"),h=i("573f"),f=i("0dcf"),p=i("71e9"),m=i("b311"),g=i.n(m),v=i("2d53"),b=i("1638"),w=i("ae1f"),y=i("140f"),x=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("button",{staticClass:"button"},[i("div",{staticClass:"icon"},[i("div",{staticClass:"arrow"}),e._v(" "),i("svg",{staticClass:"line",attrs:{viewBox:"0 0 24 24"}})]),e._v("\n    "+e._s(e.name)+"\n  ")])])},C=[],k=i("cffa"),_={name:"ButtonUpload",props:{name:{type:String,default:"上傳"}},data:function(){return{interval:null}},mounted:function(){this.init()},methods:{init:function(){var e=this,t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelector(e)},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelectorAll(e)};function a(e,t,i,a){var n=function(e,t,i,n){var s=t||e,o=i||e,r={length:Math.sqrt(Math.pow(o[0]-s[0],2)+Math.pow(o[1]-s[1],2)),angle:Math.atan2(o[1]-s[1],o[0]-s[0])},l=r.angle+(n?Math.PI:0),c=r.length*a;return[e[0]+Math.cos(l)*c,e[1]+Math.sin(l)*c]},s=n(i[t-1],i[t-2],e,!1),o=n(e,i[t-1],i[t+1],!0);return"C ".concat(s[0],",").concat(s[1]," ").concat(o[0],",").concat(o[1]," ").concat(e[0],",").concat(e[1])}function n(e,t,i){var n=i||[[5,12],[12,e],[19,12]],s=n.reduce((function(e,i,n,s){return 0===n?"M ".concat(i[0],",").concat(i[1]):"".concat(e," ").concat(a(i,n,s,t))}),"");return'<path d="'.concat(s,'" />')}i(".button").forEach((function(i){var a=t(".icon",i),s=t(".line",a),o=new Proxy({y:null},{set:function(e,t,i){return e[t]=i,null!==e.y&&(s.innerHTML=n(e.y,.25,null)),!0},get:function(e,t){return e[t]}}),r=k["a"].timeline({paused:!0});o.y=12,r.to(a,{"--arrow-y":6,"--arrow-rotate":70,ease:"elastic.in(1.1, .8)",duration:.7}).to(a,{"--arrow-y":0,"--arrow-rotate":45,ease:"elastic.out(1.1, .8)",duration:.7}),r.to(o,{y:15,duration:.15},.65).to(o,{y:12,ease:"elastic.out(1.2, .7)",duration:.6},.8),e.interval=setInterval((function(){return r.restart()}),1500)}))}},destroyed:function(){clearInterval(this.interval)}},L=_,S=(i("ab66"),i("2877")),I=Object(S["a"])(L,x,C,!1,null,"6b41cb42",null),F=I.exports,T=i("5a87"),D=i("9476"),$=(i("3b6a"),i("2690")),N=i("4308"),M=i("fd35"),O={name:"ShowFile",components:{OfficePreview:M["a"],EditElement:N["default"],MessageDialog:T["a"],AudioPreview:y["a"],VideoPreview:w["a"],ImageViewer:b["a"],SimTextPreview:v["a"],IconFile:f["a"],BreadcrumbFilePath:h["a"],EmptyFile:p["a"],ButtonUpload:F,FileTree:D["a"]},props:{selectFile:{type:Boolean,defalut:!1},lessClientHeight:{type:Number,default:150},showUploadButton:{type:Boolean,default:!0},showSearchButton:{type:Boolean,default:!0},showShareItem:{type:Boolean,default:!0},showMoreItem:{type:Boolean,default:!0},isCollectView:{type:Boolean,default:!1},emptyStatus:{type:String,default:"空空如也~"},singleFileType:{type:String,default:""},showNavigation:{type:Boolean,default:!0},queryFileType:{type:String,default:null},defaultGrid:{type:Boolean,default:!0},orderCustom:{type:Boolean,default:!1},sortable:{type:Object,default:function(){return{prop:"",order:null}}},queryCondition:{type:Object,default:function(){return{isFolder:null}}},singleMenus:{type:Array,default:function(){return[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"share",label:"分享",operation:"share"},{iconClass:"menu-favorite",label:"收藏",operation:"favorite"},{iconClass:"menu-details",label:"詳細信息",operation:"details"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}]}},singleMenusEdit:{type:Array,default:function(){return[{iconClass:"menu-open",label:"打開",operation:"open"},{iconClass:"share",label:"分享",operation:"share"},{iconClass:"menu-favorite",label:"收藏",operation:"favorite"},{iconClass:"menu-edit1",label:"編輯",operation:"edit"},{iconClass:"menu-details",label:"詳細信息",operation:"details"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}]}},multipleMenus:{type:Array,default:function(){return[{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}]}},multipleRightMenus:{type:Array,default:function(){return[{iconClass:"menu-deselect",label:"取消選定",operation:"deselect"},{iconClass:"menu-copy",label:"移動或複製",operation:"copy"},{iconClass:"menu-download",label:"下載",operation:"download"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}]}},contextMenus:{type:Array,default:function(){return[]}}},data:function(){return{imageUrl:"/api/view/thumbnail?jmal-token="+this.$store.state.user.token+"&id=",audioCoverUrl:"/api/view/cover?jmal-token="+this.$store.state.user.token+"&id=",fileMenuActive:"",path:this.$route.query.path,showNewFolder:!1,isShowNewFolder:!1,listModeSearch:!1,listModeSearchOpenDir:!1,newFolderName:"新建文件夾",renameFileName:"",searchFileName:"",pathList:[{folder:""}],fileList:[],pagination:{pageIndex:1,pageSize:50,total:0,pageSizes:[10,20,30,40,50]},isIndeterminate:!1,isSelectAll:!1,clientHeight:500,tableHead:[{name:"",label:"",index:0},{name:"",label:"",index:1},{name:"name",label:"名稱",sortable:!0,index:2},{name:"",label:"",index:3},{name:"",label:"",more:!0,index:4},{name:"size",label:"大小",sortable:!0,index:5},{name:"updateDate",label:"修改日期",sortable:!0,index:6}],isJustHideMenus:!1,menusIsMultiple:!1,menus:[],contextmenuDisabled:!1,rowContextData:{},tableLoading:!0,finished:!1,newFolderLoading:!1,renameLoading:!1,menuTriangle:"",cellMouseIndex:-1,editingIndex:-1,titlePrefix:"",unzipOperating:!1,dialogMoveOrCopyVisible:!1,directoryTreeData:[],compressedFileVisible:!1,compressedFileData:[],compressedFileName:"",compressedFileTempDir:!1,selectTreeNode:{},directoryTreeProps:{label:"name",children:"children",isLeaf:"isLeaf"},dragLoop:null,positionX:0,positionY:0,grid:this.defaultGrid,vmode:this.defaultGrid?"grid":"list",gridColumnNum:-1,gridColumnWidth:120,allChecked:!1,summaries:"",shareDialog:!1,newCreateFileDialog:!1,newCreateFileName:"",newCreateFileDialogTitle:"",createFileLoading:!1,shareLink:"",shareFileName:"",generateShareLinkLoading:!0,textPreviewVisible:!1,textPreviewRow:{},imagePreviewRow:{},imagePreviewVisible:!1,videoPreviewRow:{},videoPreviewVisible:!1,officePreviewRow:{},officePreviewVisible:!1,audioPreviewRow:{},audioPreviewVisible:!1,drawer:!1,rowStyleExecuting:!1,selectRowData:[],selectOrgin:-1,selectEnd:-1,selectPin:!1,inputting:!1,isCmd:!1,dragElementList:[],drawFlag:!1,fileListScrollTop:0,notPreviewDialogVisible:!1,openingFile:"",openCompressionVisible:!1,stompClient:void 0,showUpdateDateItem:!0,showSizeItem:!0,stopSortChange:!1}},computed:Object(s["a"])(Object(s["a"])({},Object(o["b"])(["name"])),{},{getSummaries2:function(){var e=0;this.fileList.forEach((function(t){e+=t.size}));var t=this.getShowSumFileAndFolder(this.fileList),i=this.getShowSumSize(e);return this.summaries=t+i,e>0?t+i:""},getSummaries3:function(){var e=0;return this.fileList.forEach((function(t){e+=t.size})),e>0?this.fileList.length+"項 "+this.getShowSumSize(e):""}}),created:function(){},mounted:function(){var e=this;if(d["a"].$on("fileSuccess",(function(){})),d["a"].$on("loadFileFaild",(function(){e.notPreviewDialogVisible=!0})),d["a"].$on("clickMore",(function(t){e.$refs.fileListTable.tableSelectData=t,e.preliminaryRowData()})),d["a"].$on("renameRow",(function(t){var i=e.fileList.findIndex((function(e){return e.name===t.oldName}));if(i>-1){var a=e.fileList[i];a.suffix=t.suffix,a.name=t.name,e.$refs.fileListTable.clearSelection()}})),window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.goBack,!1)),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.$route.query.vmode&&(this.vmode=this.$route.query.vmode,"list"===this.vmode?this.grid=!1:this.grid=!0),"/"!==this.$route.query.path){var t=decodeURI(this.$route.query.path);this.pathList.splice(1,1),t.split("/").forEach((function(t,i){if(i>0){var a={};a["folder"]=t,e.pathList.push(a)}}))}var i=this;window.onresize=function(){i.clientHeight=document.documentElement.clientHeight-i.lessClientHeight},this.darwRectangle(),d["a"].$on("msg/file/change",(function(t){return e.onmessage(t)}))},beforeDestroy:function(){window.removeEventListener("keydown",this.keydown,!1),window.removeEventListener("keyup",this.keyup,!1),window.removeEventListener("popstate",this.goBack,!1),this.stompClient&&this.stompClient.unsubscribe()},directives:{focus:{inserted:function(e){var t=e.querySelector("input");t||(t=e.querySelector("textarea")),t.focus()}},resize:{bind:function(e,t){var i="",a="";function n(){var n=document.defaultView.getComputedStyle(e);i===n.width&&a===n.height||t.value(),i=n.width,a=n.height}e.__vueSetInterval__=setInterval(n,300)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},methods:{keydown:function(e){var t=this,i=navigator.platform.startsWith("Mac"),a=(e.key,e.c,e.keyCode),n=e.ctrlKey,s=e.metaKey;this.isCmd=i&&s||!i&&n,16===e.keyCode&&e.shiftKey&&(this.selectPin=!0),this.isCmd&&65==a&&(this.inputting||-1!==this.editingIndex?e.target.select():(this.$nextTick((function(){t.$refs.fileListTable&&t.$refs.fileListTable.toggleAllSelection()})),e.preventDefault(),e.stopPropagation()))},keyup:function(e){var t=navigator.platform.startsWith("Mac"),i=(e.key,e.c,e.keyCode,e.ctrlKey),a=e.metaKey;this.isCmd=t&&a||!t&&i,16===e.keyCode&&(this.selectPin=!1)},onmessage:function(e){var t=JSON.parse(e.body),i=e.headers.url,a=this.fileList.findIndex((function(e){return e.id===t.id}));"updateFile"===i&&a>-1&&(this.fileList[a].size=t.size,this.fileList[a].agoTime=1,this.fileList[a].updateDate=t.updateDate),"deleteFile"===i&&a>-1&&this.fileList.splice(a,1),"createFile"===i&&(this.path||(this.path=""),this.path+"/"===t.$set.path&&this.getFileList())},load:function(){this.getFileList(!0)},gridItemClick:function(e){if(this.selectFile&&this.fileClick(e),this.isCmd)return this.pinSelect(null,e),void this.$refs.fileListTable.toggleRowSelection([{row:e}]);this.pinSelect(null,e)},containerResize:function(){var e=document.querySelector(".dashboard-container"),t=e.clientWidth;this.clientHeight=document.documentElement.clientHeight-this.lessClientHeight,"image"===this.queryFileType?this.gridColumnNum=Math.round((t-10)/165):this.gridColumnNum=Math.round((t-10)/135),this.gridColumnWidth=(t-11*this.gridColumnNum)/this.gridColumnNum-4.5,this.showUpdateDateItem=!(t<900),this.showSizeItem=!(t<500),this.rowDrop()},darwRectangle:function(){var e=this,t=document.querySelector(".el-table__body-wrapper");if(this.grid&&(document.querySelector(".van-grid").onscroll=function(t){e.tableBodyScroll(null,t)},t=document.querySelector(".van-grid")),!this.selectFile){var i=this,a=function(e){return document.getElementById(e)},n=a("v-draw-rectangle"),s="rectangle1",o=0,r=0,l=0,c=0,d=0,u=0;i.drawFlag=!1;var h="el-table__row";i.grid&&(h="grid-time van-grid-item__content van-grid-item__content--center van-grid-item__content--square"),n.onmousedown=null,n.onmousedown=function(e){if(!(i.fileListScrollTop>0)){var t=window.event||e,a=e.path||e.composedPath&&e.composedPath();if(!i.grid&&i.selectRowData.length>0){var v=a.findIndex((function(e){if("el-table__header-wrapper"===e.className)return e}));v>-1&&(i.stopSortChange=!0)}var b=a.find((function(e){if(e.className===h||"el-table__row el-table__row--striped"===e.className)return e}));if(b)i.selectRowData.includes(i.fileList[b.rowIndex])||(i.editingIndex=-1,i.isCmd||i.selectPin||(i.$refs.fileListTable.clearSelection(),i.$refs.fileListTable.toggleRowSelection([{row:i.fileList[b.rowIndex],selected:!0}])));else if(i.editingIndex=-1,0===t.button){if(!i.isCmd&&!i.selectPin){var w=a.findIndex((function(e){return e.className===h||"el-table__row el-table__row--striped"===e.className}));w<0&&i.$refs.fileListTable.clearSelection()}var y=n.scrollTop||n.scrollTop,x=n.scrollLeft||n.scrollLeft;o=t.clientX+x,r=t.clientY+y;var C=document.createElement("div");C.id=s,C.className="draw-rectangle",C.style.left=o+"px",C.style.top=r+"px",C.style.position="fixed",C.style.border="1px dashed #2898ff",C.style.width="0px",C.style.height="0px",C.style.left="0px",C.style.top="0px",C.style.overflow="hidden",n.appendChild(C),document.onmousemove=function(e){var t=window.event||e,a=document.body.scrollTop||document.documentElement.scrollTop,n=document.body.scrollLeft||document.documentElement.scrollLeft;if(l=o-t.clientX-n>0?t.clientX+n:o,c=r-t.clientY-a>0?t.clientY+a:r,d=Math.abs(r-t.clientY-a),u=Math.abs(o-t.clientX-n),i.drawFlag=!0,!(d+u<4)){var h=document.getElementById(s);h&&(f(),h.style.left=l+"px",h.style.top=c+"px",h.style.width=u+"px",h.style.height=d+"px",h.style.backgroundColor="#f2f5fa55"),i.drawFlag&&d+u>4&&(m||g({x:l,y:c,w:u,h:d}))}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,i.stopSortChange&&(i.stopSortChange=!1,setTimeout((function(){i.changeSelectedStyle(i.selectRowData)}),200)),setTimeout((function(){p(),i.drawFlag=!1}),50);var t=document.getElementById(s);t&&n.removeChild(t),i.grid||(n=document.getElementById("drag-table"));var a=Array.prototype.slice.call(n.getElementsByClassName("dragingDiv"));a.forEach((function(e){return n.removeChild(e)}))}}}};var f=function(){t.onmousewheel=function(e){return e=e||window.event,e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1),!1}},p=function(){t.onmousewheel=function(e){return!0}},m=!1,g=function(e){m=!0,i.dragElementList.forEach((function(t){v(t,e)?i.$refs.fileListTable.toggleRowSelection([{row:i.fileList[t.rowIndex],selected:!0}]):i.$refs.fileListTable.toggleRowSelection([{row:i.fileList[t.rowIndex],selected:!1}])})),setTimeout((function(){return m=!1}),10)},v=function(e,t){var i=e.x,a=e.y,n=t.x,s=t.y,o=e.w,r=e.h,l=t.w,c=t.h;return(i-n<=0&&n-i<o||i-n>=0&&i-n<l)&&(a-s<=0&&s-a<r||a-s>=0&&a-s<c)}}},rowDrop:function(){if(!this.selectFile&&!(this.fileListScrollTop>0&&"/"!==this.$route.path)){var e=null,t=this,i=null,a=-1,n="van-grid",s="van-grid-item van-grid-item--square",o="grid-time van-grid-item__content van-grid-item__content--center van-grid-item__content--square";t.grid||(s="el-table__row",n="el-table__body");var r=null,c=document.querySelector(".dashboard-container"),u=document.querySelector(".el-table__body-wrapper tbody");this.grid&&(u=document.querySelector(".van-checkbox-group .van-grid"));var h=document.getElementById("v-draw-rectangle");this.grid||(h=document.getElementById("drag-table"));var f=0,p=Object(l["a"])(h),m=0,g="";setTimeout((function(){f=u.childElementCount,t.dragElementList=[];for(var e=0;e<u.childElementCount;e++){var i=u.children[e];t.grid&&(i.rowIndex!==e&&(i.rowIndex=e),i.children[0].children[0].rowIndex=e,i=i.children[0].children[0]);var a=k(i);i.w=i.offsetWidth,i.h=i.offsetHeight,i.x=a.x,i.y=a.y,a.rowIndex=i.rowIndex,t.dragElementList.push(i),i.draggable=!0,i.slot="jmal";var n=i.querySelector(".el-avatar > img");t.grid&&(n=i.querySelector(".el-image > img")),n&&(n.draggable=!1)}}),300);var v=-1,b=function(e,i){var a=e.path||e.composedPath&&e.composedPath();if("enter"===i){var r=null;e.toElement.className;if(t.grid?(e.toElement.className===s&&(r=e.toElement),e.toElement.className===n&&(r=e.fromElement)):r="v-draw-rectangle"===a[0].id||"el-table__virtual-wrapper"===a[0].className?e.toElement:a.find((function(e){if("el-table__header-wrapper"===e.className)return e})),r){if(v>-1){var l=u.children[v];C(l)}v=-1}}var c=null;return t.grid?(a[0].className===o||(c=a.find((function(e){if(e.className===o)return e}))),c):("TD"===a[0].tagName&&(c=a.find((function(e){if("el-table__row el-table__row--striped"===e.className||"el-table__row"===e.className)return e}))),c)},w=function(e){e?(t.selectRowData.forEach((function(e){var t=document.getElementById("dragingDiv"+e.index);t.style.transition="all 0.3s",t.style.top=t.original.top,t.style.left=t.original.left})),setTimeout((function(){t.selectRowData.forEach((function(e){h.removeChild(document.getElementById("dragingDiv"+e.index))}))}),300)):t.selectRowData.forEach((function(e){h.removeChild(document.getElementById("dragingDiv"+e.index))}))};c.ondragend=function(e){d["a"].$emit("onDragStart",!1),e.dataTransfer.effectAllowed="none";var t=u.children[v];C(t),i.style.cursor="default",e.target.parentNode.parentNode.title=g},c.ondragstart=function(n){if(t.drawFlag||t.isCmd||t.selectPin)return n.preventDefault(),void n.stopPropagation();if(!n.target.slot||"jmal"!==n.target.slot)return!0;if(n.target.rowIndex===t.editingIndex)return n.preventDefault(),void n.stopPropagation();if(n.target.style.cursor="no-drop",0===t.fileListScrollTop){g=n.target.parentNode.parentNode.title,n.target.parentNode.parentNode.title="",t.selectRowData.forEach((function(e,i){var a=t.dragElementList[e.index],n=a.rowIndex;r=a.cloneNode(!0),r.id="dragingDiv"+n,r.classList.add("dragingDiv"),r.classList.remove("el-table_row"),r.style.transition="all 0.3s",r.style.zIndex=-1,r.style.position="absolute";var s=t.dragElementList[n];if(r.style.width=s.w+"px",r.style.height=s.h+"px",r.style.left=s.x-p+"px",t.grid)r.style.top=s.y-s.h/2+10+"px";else{r.firstChild.style.textAlign="center";var o=Array.prototype.slice.call(r.childNodes);o.forEach((function(e,t){if(4===t)return e.style.borderRadius="0 3px 3px 0",e.style.borderRight="1px solid #409eff",e.firstChild.style.width="80px",!0;0!==t&&1!==t&&r.removeChild(e)})),r.style.top=s.y-51.5+"px"}if(0===i){var l=document.getElementById("numberFiles").cloneNode(!0);l.id="numberFilesCopy",l.querySelector(".number").innerHTML=t.selectRowData.length+"個文件",r.appendChild(l)}r.original={top:r.style.top,left:r.style.left},h.appendChild(r)})),m=0;var s=document.getElementById("dragImage");n.dataTransfer.setDragImage(s,10,10),d["a"].$emit("onDragStart",!0),t.drawFlag=!1;var o=document.getElementById("rectangle1");o&&document.getElementById("v-draw-rectangle").removeChild(o),i=n.target,a=i.rowIndex,t.cellMouseIndex=-1,e=i.style.backgroundColor}},c.ondragenter=function(e){clearTimeout(y);var n=b(e,"enter");if(n){if(v!==n.rowIndex){if(v>-1){var s=u.children[v];C(s)}if(a!==n.rowIndex&&t.fileList[n.rowIndex].isFolder&&-1===t.selectRowData.findIndex((function(e){return e.index===n.rowIndex}))){i.style.cursor="copy";var o=document.getElementById("numberFilesCopy");o.style.backgroundColor="#40a9ffc9",o.querySelector(".number").style.display="none",o.querySelector(".icon").style.display="inline",o.querySelector(".operate").style.display="inline";var r=o.querySelector(".target .folder");r.style.display="inline",r.innerHTML=t.fileList[n.rowIndex].name,n.style.backgroundColor;var l="#9fcdfc99";t.grid?n.style.backgroundColor=l:n.childNodes.forEach((function(e){return e.style.backgroundColor=l}))}v=n.rowIndex}x=-1}},c.ondragover=function(e){t.selectRowData.forEach((function(t,i){var a=document.getElementById("dragingDiv"+t.index);a&&(a.style.left=e.clientX-p+3*i+10+"px",a.style.top=e.clientY-50+3*i+10+"px",0===m&&(a.style.zIndex=999,setTimeout((function(){a.style.transition=""}),300)))})),e.preventDefault(),x=-1,m++};var y=null,x=-1;c.ondragleave=function(e){clearTimeout(y);var i=b(e,"leave");i&&(t.grid||0!==i.rowIndex&&i.rowIndex!==f-1||(x=i.rowIndex,y=setTimeout((function(){if(x>-1){var e=u.children[x];C(e),v=-1}}),100)))},c.ondrop=function(){var e=t.fileList[a],i=t.fileList[v];if(e&&i&&e.id!==i.id&&i.isFolder&&!t.selectRowData.includes(i)){var n=[];t.selectRowData.forEach((function(e){n.push(e.id)})),t.$confirm("是否將選中的".concat(t.selectRowData.length,"項移動到 ").concat(i.name,"?"),"提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"info"}).then((function(){t.copyOrMoveApi("move",n,i.id),w(!1)})).catch((function(){w(!0)}))}else w(!0)};var C=function(a){if(i){if(a){t.grid?(a=a.children[0].children[0],"rgba(159, 205, 252, 0.6)"===a.style.backgroundColor&&(a.style.backgroundColor=null)):"rgba(159, 205, 252, 0.6)"===a.firstChild.style.backgroundColor&&a.childNodes.forEach((function(e){e.style.backgroundColor=null})),i.style.cursor="default";var n=document.getElementById("numberFilesCopy");n&&(n.style.backgroundColor="#d2eefa66",n.querySelector(".number").style.display="inline",n.querySelector(".icon").style.display="none",n.querySelector(".operate").style.display="none",n.querySelector(".target .folder").style.display="none")}i.style.backgroundColor=e}}}function k(e){var t={x:0,y:0};while(e)t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent;return t}},formatTime:function(e){return Object(r["c"])(e)},formatSize:function(e){return Object(r["b"])(e)},upload:function(){d["a"].$emit("openUploader",{currentDirectory:this.path,username:this.$store.state.user.name,userId:this.$store.state.user.userId})},uploadFolder:function(){window.uploader.supportDirectory?d["a"].$emit("uploadFolder",{currentDirectory:this.path,username:this.$store.state.user.name,userId:this.$store.state.user.userId}):this.$message({message:"該瀏覽器不支持上傳文件夾",type:"warning"})},goBack:function(){this.pathList.length<=1?this.$router.push("/?vmode=".concat(this.vmode,"&path=").concat(encodeURI(this.path))):this.lastLink()},lastLink:function(){this.handleLink(this.pathList[this.pathList.length-2],this.pathList.length-2)},handleLink:function(e,t,i,a){var n=this;e&&e.search?(e.searchKey?this.searchFileByKeyWord(e.searchKey):e.row&&this.searchFileAndOpenDir(e.row),this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1))):(this.pathList.splice(this.pathList.findIndex((function(e,i){return i===t+1})),this.pathList.length-(t+1)),this.pathList.forEach((function(e,t){0===t?n.path="":t===n.pathList.length||(n.path+="/"+n.pathList[t].folder)})),i||(this.$route.query.path,this.$router.push("?vmode=".concat(this.vmode,"&path=").concat(encodeURI(this.path)))),a||(this.pagination.pageIndex=1,this.getFileList()))},newDocument:function(){window.open("/setting/website/manager-articles?operation=new","_blank")},newFolder:function(){var e=this;this.newFolderName=this.getNewFileName(this.fileList,"新建文件夾"),this.showNewFolder=!0,this.$nextTick((function(){e.$refs.newFolderName.focus(),e.$refs.newFolderName.select()}))},getNewFileName:function(e,t){var i=0,a=[];e.forEach((function(e){var t=e.name||e.label;a.push(t)}));var n=t;while(a.includes(t))if(i+=1,n.indexOf(".")>0){var s=n.substring(0,n.lastIndexOf(".")),o=n.substring(n.lastIndexOf("."));t="".concat(s).concat(i).concat(o)}else t="".concat(n).concat(i);return t},hideNewFolderName:function(){this.showNewFolder=!1,this.isShowNewFolder=!1},showNewFolderClick:function(){this.isShowNewFolder=!0},setInputFocus:function(){this.inputting=!0},setInputBlur:function(){this.inputting=!1},newFolderNameClickEnter:function(){this.newFolderNameClick()},newFolderNameClick:function(){var e=this;if(this.newFolderName){if(/[\[\]\/\\"<>\?\*]/gi.test(this.newFolderName))return void this.$message({message:"文件名不能包含以下字符:<,>,|,*,?,,/,[,]",type:"warning"});this.newFolderLoading=!0,u["a"].uploadFolder({isFolder:!0,filename:encodeURI(this.newFolderName),currentDirectory:encodeURI(this.path),username:this.$store.state.user.name,userId:this.$store.state.user.userId}).then((function(t){1===t.data?(e.newFolderLoading=!1,e.$message({message:"該文件夾已存在",type:"warning"})):(e.newFolderLoading=!1,e.showNewFolder=!1,e.isShowNewFolder=!1,e.$notify({title:"新建文件夾成功",type:"success",duration:1e3}),e.listModeSearch?e.getFileListBySearchMode():e.getFileList())})).catch((function(){e.newFolderLoading=!1}))}else this.newFolderLoading=!1,this.$message({message:"請輸入文件夾名稱",type:"warning"})},createFile:function(e){var t=this;if(e){if(/[\[\]\/\\"<>\?\*]/gi.test(e))return void this.$message({message:"文件名不能包含以下字符:<,>,|,*,?,,/,[,]",type:"warning"});this.createFileLoading=!0;var i="/";this.path&&this.path.length>0&&(i=this.path);var a=e.substring(e.lastIndexOf(".")+1);u["a"].addFile({fileName:encodeURI(e),isFolder:!1,username:this.$store.state.user.name,parentPath:encodeURI(i)}).then((function(e){switch(t.createFileLoading=!1,a){case"txt":t.textPreviewRow=e.data,t.textPreviewVisible=!0;break;case"drawio":case"mind":case"docx":case"xlsx":case"pptx":t.officePreviewRow=e.data,t.officePreviewVisible=!0;break}var i=t;setTimeout((function(){i.newCreateFileDialog=!1}),200)})).catch((function(){t.createFileLoading=!1}))}},searchFileByKeyWord:function(e){this.searchFile(e)},changeVmode:function(){this.grid=!this.grid,this.vmode="list",this.grid?this.vmode="grid":this.$refs.fileListTable.setHeight(),this.path||(this.path=""),this.editingIndex=-1,this.$router.push("?vmode=".concat(this.vmode,"&path=").concat(this.path)),this.rowDrop(),this.darwRectangle(),this.loadContextMenus()},loadContextMenus:function(){var e=this;if(this.contextMenus.length<1)this.contextmenuDisabled=!0;else{var t=document.querySelector(".dashboard-container");0===this.$refs.homeContextmenu.references.length&&this.$refs.homeContextmenu.addRef({el:t,vnode:t});var i=this.contextMenus.findIndex((function(e){return"viewMode"===e.operation})),a=this.contextMenus.findIndex((function(e){return"arrangement"===e.operation}));if(i>-1){var n=this.contextMenus[i].child;this.grid?(n[0].iconClass="menu-empty",n[1].iconClass="menu-point"):(n[0].iconClass="menu-point",n[1].iconClass="menu-empty")}if(a>-1){var s=this.contextMenus[a].child,o=this.sortable.prop;s.forEach((function(t){var i=t.orderProp;i===o&&s.map((function(t){return i===t.orderProp?t.iconClass="menu-"+e.sortable.order:t.iconClass="menu-null",t}))}))}}},beforeLoadData:function(e){e?this.pagination.pageIndex++:this.pagination.pageIndex=1,this.tableLoading=!0,this.finished=!1},loadData:function(e,t){var i=this;this.$refs.fileListTable&&(t?e.data.forEach((function(e,t){e["index"]=(i.pagination.pageIndex-1)*i.pagination.pageSize+t,i.fileList.push(e)})):(this.fileList=e.data,this.fileList.map((function(e,t){e.index=t})),this.$refs.fileListTable.reloadData(this.fileList),setTimeout((function(){i.$refs.fileListTable.reloadData(i.fileList)}),0)),this.fileList.length>=e.count&&(this.finished=!0),this.tableLoading=!1,this.clientHeight=document.documentElement.clientHeight-this.lessClientHeight,this.listModeSearch=!1,this.pagination["total"]=e.count,this.$nextTick((function(){i.containerResize(),i.tableLoading=!1})),this.loadContextMenus(),t||this.grid||this.fileListScrollTop>0&&this.$refs.fileListTable.pagingScrollTopLeft(),this.fileListScrollTop=0)},searchFile:function(e,t){var i=this;if(e){this.beforeLoadData(t),this.pathList=[{folder:""}];var a={};a["folder"]='搜索: "'+e+'"',a["search"]=!0,a["searchKey"]=e,this.pathList.push(a),this.$router.push("?vmode=".concat(this.vmode,"&search-file=").concat(e)),u["a"].searchFile({userId:this.$store.state.user.userId,username:this.$store.state.user.name,keyword:e,sortableProp:this.sortable.prop,order:this.sortable.order,currentDirectory:encodeURI(this.$route.query.path),pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(e){i.loadData(e,t),i.path="",i.listModeSearch=!0,i.listModeSearchOpenDir=!1}))}},searchFileAndOpenDir:function(e,t){var i=this;this.beforeLoadData(t),u["a"].searchFileAndOpenDir({userId:this.$store.state.user.userId,id:e.id,currentDirectory:encodeURI(this.$route.query.path),pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(a){i.loadData(a,t),i.listModeSearch=!0,i.listModeSearchOpenDir=e})),this.path=e.path+e.name},openDir:function(e,t){var i=this;this.beforeLoadData(t),u["a"].searchFileAndOpenDir({userId:this.$store.state.user.userId,id:e.id,currentDirectory:encodeURI(this.$route.query.path),pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(e){i.loadData(e,t)})),this.path=e.path+e.name},getFileList:function(e){var t=this;this.beforeLoadData(e),u["a"].fileList({userId:this.$store.state.user.userId,username:this.$store.state.user.name,currentDirectory:encodeURI(this.$route.query.path),queryFileType:this.queryFileType,sortableProp:this.sortable.prop,order:this.sortable.order,isFolder:this.queryCondition.isFolder,isFavorite:this.queryCondition.isFavorite,queryCondition:this.queryCondition,pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(i){t.loadData(i,e)}))},getFileListBySearchMode:function(e){var t=this;this.beforeLoadData(e),u["a"].fileList({userId:this.$store.state.user.userId,currentDirectory:encodeURI(this.$route.query.path),pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize}).then((function(i){t.loadData(i,e)}))},tableBodyScroll:function(e,t){this.fileListScrollTop=t.target.scrollTop,d["a"].$emit("fileListScrollTop",this.fileListScrollTop);var i=t.target.scrollHeight-t.target.clientHeight-t.target.scrollTop;i<200&&(this.finished||(this.listModeSearch?this.listModeSearchOpenDir?this.searchFileAndOpenDir(this.listModeSearchOpenDir,!0):this.searchFile(this.searchFileName,!0):this.getFileList(!0)))},pinSelect:function(e,t){if(this.selectPin&&this.selectOrgin>-1){var i=this.selectOrgin;this.selectEnd=t.index;var a=this.selectEnd-i;if(this.$refs.fileListTable.clearSelection(),0===a&&(this.selectOrgin=-1),a>0)for(var n=i;n<=this.selectEnd;n++)this.$refs.fileListTable.toggleRowSelection([{row:this.fileList[n],selected:!0}]),this.$refs.fileListTable.tableSelectData.push(this.fileList[n]);if(a<0)for(var s=this.selectEnd;s<=i;s++)this.$refs.fileListTable.toggleRowSelection([{row:this.fileList[s],selected:!0}]),this.$refs.fileListTable.tableSelectData.push(this.fileList[s])}this.changeSelectedStyle(this.$refs.fileListTable.tableSelectData)},sortChangeOfMenu:function(e,t){var i=this,a=document.querySelector(".el-table__header thead tr");a.childNodes.forEach((function(e){e.className.indexOf("is-sortable")>-1&&(i.removeClass(e,"descending"),i.removeClass(e,"ascending"))}));var n="ascending"===this.sortable.order?"descending":"ascending";this.addClass(a.children[t],n),this.orderCustom=!0,this.sortChange({prop:e,order:n})},sortChange:function(e){var t=e.prop,i=e.order;(this.orderCustom||this.listModeSearch)&&(this.sortable.prop=t,this.sortable.order=i,this.pagination.pageIndex=1,this.listModeSearch?this.searchFile(this.searchFileName):this.getFileList())},removeClass:function(e,t){var i=e.className;i.indexOf(t)>-1&&(e.className=i.replace(t,""))},addClass:function(e,t){if(e){e.className;e.className=e.className+" "+t}},getShowSumFileAndFolder:function(e){var t=0,i=0;e.forEach((function(e){e.isFolder?t+=1:i+=1}));var a="";t>0&&(a=t+"個文件夾");var n="";return i>0&&(n=i+"個文件"),a+" "+n},getShowSumSize:function(e){var t="";return t+=e<1024?e+"B":e>=1024&&e<1048576?(e/1024).toFixed(2)+"K":e>=1048576&&e<1073741824?(e/1048576).toFixed(2)+"M":(e/1073741824).toFixed(2)+"G",t},selectAll:function(e){var t=this;this.isSelectAll=e,e?this.fileList.forEach((function(e){t.selectRowData.push(e)})):this.isIndeterminate=!1},handleSelectionChange:function(e){if(e.length>0){if(this.selectPin||(this.selectOrgin=e[0].index),this.selectPin)return;this.rowContextData=e[0]}this.$refs.fileListTable.tableSelectData=e,this.selectRowData=e,this.changeSelectedStyle(e)},changeSelectedStyle:function(e){if(!this.stopSortChange){var t=0;e.forEach((function(e){t+=e.size}));var i=this.tableHead[2],a=this.tableHead[4],n=this.tableHead[5],s=this.tableHead[6];if(e.length>0){var o=this.getShowSumFileAndFolder(e),r=this.getShowSumSize(t);i.label=o,i.sortable=!1,a.name="more",n.label=r,n.sortable=!1,s.label="",s.sortable=!1}else i.label="名稱",i.sortable=!0,a.name="",n.label="大小",n.sortable=!0,s.label="修改日期",s.sortable=!0;this.selectRowData.length===this.fileList.length?this.allChecked=!0:this.allChecked=!1}},rowStyle:function(e){e.row,e.column;var t=e.rowIndex,i=e.columnIndex;if(this.$refs.fileListTable.tableSelectData.findIndex((function(e){return e.index===t}))>-1)return 0===i?{backgroundColor:"#e0f3fc !important",borderRadius:"3px 0 0 3px",borderLeft:"1px solid #409eff",borderTop:"1px solid #409eff",borderBottom:"1px solid #409eff"}:5===i?{backgroundColor:"#e0f3fc !important",borderRadius:"0 3px 3px 0",borderRight:"1px solid #409eff",borderTop:"1px solid #409eff",borderBottom:"1px solid #409eff"}:{backgroundColor:"#e0f3fc !important",borderTop:"1px solid #409eff",borderBottom:"1px solid #409eff"}},tableRowClassName:function(e){e.row,e.rowIndex},preliminaryRowData:function(e){e&&(this.rowContextData=e);var t=this.rowContextData.isFavorite;this.highlightFavorite(!!this.isCollectView||t,!1)},cellMouseEnter:function(e){"moreClick"===this.$refs.contextShow.locals.menuType&&this.$refs.contextShow.locals.rowIndex!==e.index&&this.$refs.contextShow.hideMenu(),-1!==this.editingIndex||this.$refs.contextShow.ctxVisible||this.selectRowData.length<=1&&(this.cellMouseIndex=e.index)},cellMouseLeave:function(e){if("moreClick"===this.$refs.contextShow.locals.menuType&&this.$refs.contextShow.locals.rowIndex!==e.index)return this.$refs.contextShow.hideMenu(),void(this.$refs.contextShow.locals={});this.$refs.contextShow.ctxVisible&&"moreClick"===this.$refs.contextShow.locals.menuType&&this.$refs.contextShow.locals.rowIndex===e.index||(this.cellMouseIndex=-1)},dblclick:function(e){this.fileClick(e)},cellClick:function(e,t){if(this.selectFile)this.fileClick(e);else if(clearTimeout(this.Loop),-1===this.editingIndex){var i=t.index;if(2===i&&this.selectRowData.length<1&&e.index!==this.editingIndex&&(this.editingIndex=-1),this.isCmd)return this.pinSelect(null,e),void this.$refs.fileListTable.toggleRowSelection([{row:e}]);this.pinSelect(null,e)}},renameInputFocus:function(e,t){this.setInputFocus(),e.focus(),e.selectionStart=0,e.selectionEnd=e.value.length,t&&(e.selectionEnd-=t.length+1)},rowRename:function(e,t){var i=this;if(e=e.replace(/[\r\n]/g,""),e){if(/[\[\]\/\\"<>\?\*]/gi.test(e))return void this.$message({message:"文件名不能包含以下字符:<,>,|,*,?,,/,[,]",type:"warning"});var a=e.replace(/(.*\/)*([^.]+).*/gi,"$2"),n=e.replace(/.+\./,"");t.isFolder?this.rename(t,e):t.suffix!==n?this.$confirm("您確定要將擴展名“.".concat(t.suffix,"”更改爲“.").concat(n,"”嗎？"),"提示",{type:"warning",showClose:!1,closeOnClickModal:!1,confirmButtonText:"保持.".concat(t.suffix),cancelButtonText:"使用.".concat(n)}).then((function(){e=a+"."+t.suffix})).catch((function(){})).then((function(){i.rename(t,e)})):this.rename(t,e)}else this.editingIndex=-1},rename:function(e,t){var i=this;if(e.name!==t){this.renameLoading=!0;var a=this.fileList.findIndex((function(e){if(t===e.name)return e}));if(a>-1){var n="該文件已存在";return e.isFolder&&(n="該文件夾已存在"),this.$message({message:n,type:"warning"}),void(this.renameLoading=!1)}u["a"].rename({newFileName:encodeURI(t),username:this.$store.state.user.name,id:e.id}).then((function(a){a.data&&(i.renameLoading=!1,e.name=t,e.suffix=t.replace(/.+\./,""),i.fileList[e.index]=e,i.editingIndex=-1)})).then((function(){i.$refs.fileListTable.clearSelection(),i.$message.success("重命名成功")})).catch((function(){i.renameLoading=!1,i.editingIndex=-1}))}else this.editingIndex=-1},moreOperation:function(e){this.menusIsMultiple=!0,this.menus=this.multipleMenus,this.showOperationMenus(e)},moreClick:function(e,t){this.menusIsMultiple=!1,e.contentType&&e.contentType.includes("text")?this.menus=this.singleMenusEdit:this.menus=this.singleMenus,this.preliminaryRowData(e),this.showOperationMenus(t,{menuType:"moreClick",rowIndex:e.index})},rowContextmenu:function(e){if(!this.selectFile){this.$refs.fileListTable.tableSelectData.length>1&&this.$refs.fileListTable.tableSelectData.findIndex((function(t){return t.index===e.index}))>-1?(this.menusIsMultiple=!0,this.menus=this.multipleRightMenus,this.highlightFavorite(this.isCollectView,!1)):(this.$refs.fileListTable.clearSelection(),this.$refs.fileListTable.toggleRowSelection([{row:e}]),this.menusIsMultiple=!1,e.suffix&&e.suffix.includes("md")?this.menus=this.singleMenusEdit:this.menus=this.singleMenus,this.preliminaryRowData(e)),event.preventDefault(),this.menuTriangle="";var t={};t.pageX=event.pageX+5,t.pageY=event.pageY+2,t.clientX=event.clientX+5,t.clientY=event.clientY+2,this.$refs.contextShow.showMenu(t),this.cellMouseIndex=-1}},showOperationMenus:function(e,t){var i=e.pageY;e.target.clientHeight>0&&(i+=e.target.clientHeight/2-e.offsetY);var a={};document.body.scrollHeight-i>400?(this.menuTriangle="menu-triangle-top",a.pageX=e.pageX-78,a.pageY=i+25):(this.menuTriangle="menu-triangle-bottom",a.pageX=e.pageX-78,a.pageY=i-38*this.menus.length-36),this.isJustHideMenus||this.$refs.contextShow.showMenu(a,t)},menuFavoriteOver:function(e,t){this.highlightFavorite(!!this.isCollectView||t,!1)},menuFavoriteLeave:function(e,t){this.highlightFavorite(!!this.isCollectView||t,!1)},highlightFavorite:function(e,t){var i=this.menus.find((function(e){if("favorite"===e.operation||"unFavorite"===e.operation)return e}));i&&(e?(i.label="取消收藏",i.iconClass="menu-unfavorite-hover",i.operation="unFavorite"):(i.iconClass=t?"menu-favorite-hover":"menu-favorite",i.label="收藏",i.operation="favorite"))},show:function(){var e=this;this.contextmenuDisabled=!0,setTimeout((function(){e.contextmenuDisabled=!1}),1e3)},hide:function(){var e=this;this.isJustHideMenus=!0,setTimeout((function(){e.isJustHideMenus=!1}),100),this.cellMouseIndex=-1},contextmenuClick:function(e){switch(e){case"vmode-list":this.grid=!0,this.changeVmode();break;case"vmode-grid":this.grid=!1,this.changeVmode();break;case"orderName":this.sortChangeOfMenu("name",2);break;case"orderSize":this.sortChangeOfMenu("size",5);break;case"orderUpdateDate":this.sortChangeOfMenu("updateDate",6);break;case"refresh":this.getFileList();break;case"createTextFile":this.newCreateFileDialogTitle="新建文本文件",this.createNewFile("txt");break;case"createDrawioFile":this.newCreateFileDialogTitle="新建流程圖",this.createNewFile("drawio");break;case"createMinderFile":this.newCreateFileDialogTitle="新建思維導圖",this.createNewFile("mind");break;case"createWordFile":this.newCreateFileDialogTitle="新建Word文檔",this.createNewFile("docx");break;case"createExcelFile":this.newCreateFileDialogTitle="新建Excel工作表",this.createNewFile("xlsx");break;case"createPPTFile":this.newCreateFileDialogTitle="新建PPT演示文檔",this.createNewFile("pptx");break;case"createMarkdownFile":this.newDocument();break}},createNewFile:function(e){var t=this;this.newCreateFileName="未命名文件.".concat(e),this.newCreateFileName=this.getNewFileName(this.fileList,this.newCreateFileName),this.newCreateFileDialog=!0,this.$nextTick((function(){var i=t.$refs.newCreateFileName.$el.querySelector(".el-input__inner");t.renameInputFocus(i,e)}))},menusOperations:function(e){switch(e){case"share":this.share();break;case"favorite":this.favoriteOperating(!0);break;case"edit":window.open("/setting/website/manager-articles?operation=editor&id=".concat(this.rowContextData.id),"_blank");break;case"open":this.fileClick(this.rowContextData);break;case"deselect":this.$refs.fileListTable.clearSelection();break;case"unFavorite":this.favoriteOperating(!1);break;case"details":this.drawer=!0;break;case"rename":this.renameFileName=this.rowContextData.name,this.editingIndex=this.rowContextData.index;break;case"copy":this.moveOrCopy();break;case"download":this.downloadFile();break;case"remove":this.deleteFile();break}this.$refs.contextShow.hideMenu()},clearTreeNode:function(){var e=this.$refs.directoryTree.getNode("0");e.loaded=!1,e.expanded=!1},directoryTreeLoadNode:function(e,t){var i=null;if(0===e.level){var a=this;return setTimeout((function(){a.$refs.directoryTree.setCurrentKey("0")}),0),t([{id:"0",name:"全部文件"}])}e.level>1&&(i=e.data.id),u["a"].queryFileTree({userId:this.$store.state.user.userId,username:this.$store.state.user.name,fileId:i}).then((function(e){var i=e.data;return t(i)}))},treeNodeClick:function(e,t,i){this.selectTreeNode=e,this.selectTreeNode.showName=' "'+e.name+'"'},treeNodeExpand:function(e,t,i){},fileTreeAndNewFolder:function(){var e="newFolderNodeKey",t=this.$refs.directoryTree.getNode(e);null!==t&&this.$refs.directoryTree.remove(t);var i=this.$refs.directoryTree.store.currentNode.childNodes,a=this.getNewFileName(i,"新建文件夾"),n={id:e,newFolder:!0,name:a,showName:a,isLeaf:!0};this.$refs.directoryTree.append(n,this.selectTreeNode);setTimeout((function(){var e=document.getElementById("treeInput");e&&(e.value=a,e.focus(),e.select())}),100)},moveFileTree:function(){this.copyOrMove("move")},copyFileTree:function(){this.copyOrMove("copy")},confirmUnzip:function(){this.unzip(this.openingFile,this.selectTreeNode.id,!1)},moveOrCopy:function(){this.dialogMoveOrCopyVisible=!0,this.titlePrefix="移動或複製到: ";var e=this;setTimeout((function(){e.selectTreeNode=e.$refs.directoryTree.getCurrentNode(),e.selectTreeNode.showName=' "'+e.selectTreeNode.name+'"'}),100)},copyOrMove:function(e){var t=this,i="複製";"move"===e&&(i="移動");var a="/";this.selectTreeNode.path&&(a=this.selectTreeNode.path+this.selectTreeNode.name+"/");var n=[];if(this.menusIsMultiple||this.selectRowData.length>1){var s=this.$refs.fileListTable.tableSelectData.some((function(e){n.push(e.id);var s=e.path;if(s===a)return t.$message({message:"不能將文件"+i+"到自身或其子目錄下",type:"warning"}),!0}));if(s)return}else this.rowContextData.id?n.push(this.rowContextData.id):n.push(this.rowContextData[0].id);this.copyOrMoveApi(e,n,this.selectTreeNode.id)},copyOrMoveApi:function(e,t,i){var a=this,n="複製";"move"===e&&(n="移動");var s=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,message:"<span>&nbsp;&nbsp;正在"+n+"</span>"});this.dialogMoveOrCopyVisible=!1,u["a"][e]({userId:this.$store.state.user.userId,username:this.$store.state.user.name,froms:t,to:i}).then((function(){s.iconClass=null,s.type="success",s.message=n+"成功",a.rowContextData.isFolder&&a.$refs.directoryTree.append(a.rowContextData,i),"move"===e&&a.getFileList(),setTimeout((function(){s.close()}),1e3)})).catch((function(){s.close()}))},renderContent:function(e,t){var i=this,a=t.node,n=t.data;t.store;return n.newFolder?e("span",{class:"custom-tree-node"},[e("span",[e("svg-icon",{attrs:{"icon-class":"folder"}})]),e("span",[e("div",{class:"el-input el-input--mini el-input-tree"},[e("input",{attrs:{type:"text",autocomplete:"on",value:"新建文件夾",id:"treeInput"},class:"el-input__inner"})]),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){var e="/",t=a.parent.data;t.path&&(e=t.path+t.name+e),u["a"].newFolder({isFolder:!0,filename:encodeURI(n.name),currentDirectory:encodeURI(i.$route.query.path),username:i.$store.state.user.name,userId:i.$store.state.user.userId}).then((function(e){n.newFolder=!1,n.id=e.data.id})).catch((function(){window.event.preventDefault(),window.event.stopPropagation()}))}},class:"el-button el-icon-check el-button--mini el-input-tree-button"}),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){i.$refs.directoryTree.remove(a),window.event.preventDefault(),window.event.stopPropagation()}},class:"el-button el-icon-close el-button--mini el-input-tree-button"})])]):a.expanded?e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"open-folder"}}),e("span",{style:"margin-left: 5px;"},[a.label]),e("span")]):e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"folder"}}),e("span",{style:"margin-left: 5px;"},[a.label]),e("span")])},share:function(e){var t=this;e&&e.id||(e=this.rowContextData.id?this.rowContextData:this.$refs.fileListTable.tableSelectData[0]),this.shareFileName=e.name,u["a"].generate({userId:e.userId,fileId:e.id,isFolder:e.isFolder}).then((function(e){t.shareDialog=!0,e.data&&(t.shareLink=window.location.origin+"/s?s="+e.data,t.generateShareLinkLoading=!1)})).catch((function(){t.shareDialog=!1,t.generateShareLinkLoading=!1}))},copyShareLink:function(){var e=this,t=new g.a(".tag-share-link");t.on("success",(function(i){e.$message({message:"複製成功",type:"success",duration:1e3}),e.shareDialog=!1,t.destroy()})),t.on("error",(function(i){e.$message({message:"該瀏覽器不支持自動複製",type:"warning",duration:1e3}),t.destroy()}))},downloadFile:function(){var e=0;if(this.$refs.fileListTable.tableSelectData.length>0?this.$refs.fileListTable.tableSelectData.forEach((function(t){e+=t.size})):e+=this.rowContextData.size,e>0){var t=[];if(this.$refs.fileListTable.tableSelectData.length>0?this.$refs.fileListTable.tableSelectData.forEach((function(e){t.push(e.id)})):t.push(this.rowContextData.id),t.length>1||this.rowContextData.isFolder)return void $["a"].packageDownload(t,this.$store.state.user.token);$["a"].download(this.$store.state.user.name,this.rowContextData,this.$store.getters.token)}else this.$message({message:"所選文件爲空",type:"warning"})},favoriteOperating:function(e){var t=this,i=this.getSelectIdList();this.rowContextData.isFavorite=e,this.highlightFavorite(e,!0),u["a"].favoriteUrl({fileIds:i,isFavorite:e}).then((function(i){!e&&t.isCollectView&&t.removeSelectItme()})).catch((function(){t.rowContextData.isFavorite=!e}))},deleteFile:function(){var e=this,t=[],i=[];this.menusIsMultiple||this.selectRowData.length>1?(t=this.$refs.fileListTable.tableSelectData,this.$refs.fileListTable.tableSelectData.forEach((function(e){i.push(e.id)}))):i.push(this.rowContextData.id);var a=this.getShowSumFileAndFolder(t);this.$confirm("此操作將永久刪除"+a+", 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){u["a"].delete({username:e.$store.state.user.name,fileIds:i}).then((function(){e.removeSelectItme()})).then((function(){e.$notify({title:"刪除成功",type:"success",duration:1e3})}))}))},getSelectIdList:function(){var e=[];return this.selectRowData.length>1||this.menusIsMultiple?this.$refs.fileListTable.tableSelectData.forEach((function(t){e.push(t.id)})):e.push(this.rowContextData.id),e},removeSelectItme:function(){var e=this,t=[];this.$refs.fileListTable.tableSelectData.length>0&&this.$refs.fileListTable.tableSelectData.forEach((function(i){var a=e.fileList.findIndex((function(e){return e.id===i.id}));a>-1&&t.push(a)})),this.$refs.fileListTable.doLayout(),this.$refs.fileListTable.clearSelection(),this.$refs.fileListTable.tableSelectData=[],t=t.sort((function(e,t){return t-e})),setTimeout((function(){for(var i=0;i<t.length;i++)e.fileList.splice(t[i],1);e.fileList.map((function(e,t){e.index=t})),e.rowDrop(),e.darwRectangle()}),300)},compressionFilePreview:function(e){this.unzip(e,void 0,!0)},unzipTo:function(e){this.dialogMoveOrCopyVisible=!0,this.titlePrefix="解壓到: ",this.unzipOperating=!0;var t=this;setTimeout((function(){t.openCompressionVisible=!1,t.selectTreeNode=t.$refs.directoryTree.getCurrentNode(),t.selectTreeNode.showName=' "'+t.selectTreeNode.name+'"'}),100)},unzip:function(e,t,i){var a=this,n="解壓",s=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,message:"<span>&nbsp;&nbsp;正在"+n+"</span>"});u["a"].unzip({fileId:e.id,destFileId:t}).then((function(o){s.iconClass=null,s.type="success",s.message=n+"成功",i&&(a.compressedFileData=o.data,a.compressedFileVisible=!0,a.compressedFileName=e.name,a.compressedFileTempDir=i);var r=a;setTimeout((function(){s.close(),r.openCompressionVisible=!1,e.id===t&&r.getFileList(),t&&e.id!==t&&!i&&(r.dialogMoveOrCopyVisible=!1)}),1e3)})).catch((function(){s.close()}))},fileClick:function(e){if(this.editingIndex!==e.index)if(this.openingFile=e,e.isFolder)if(this.editingIndex=-1,this.listModeSearch){var t={};t["folder"]=e.name,t["search"]=!0,t["row"]=e,this.pathList.push(t),this.pagination.pageIndex=1,this.$router.push("?vmode=".concat(this.vmode,"&search-file=").concat(e.id)),this.searchFileAndOpenDir(e)}else{this.path?this.path+="/"+e.name:this.path="/"+e.name;var i={folder:e.name};this.pathList.push(i),this.pagination.pageIndex=1;var a=encodeURI(this.path);this.$router.push("?vmode=".concat(this.vmode,"&path=").concat(a)),this.openDir(e)}else{if(this.selectFile){var n=e,s=this.$refs.fileListTable.tableSelectData;return s.length<1||s[0].id!==e.id?(this.$refs.fileListTable.clearSelection(),this.$refs.fileListTable.toggleRowSelection([{row:e}]),this.pinSelect(null,e)):(this.$refs.fileListTable.clearSelection(),n={}),void this.$emit("selectedFile",n)}if(e.contentType.startsWith("image"))return this.imagePreviewVisible=!0,void(this.imagePreviewRow=e);if(c["c"].simText.includes(e.suffix))return this.textPreviewRow=e,void(this.textPreviewVisible=!0);if(e.contentType.indexOf("video")>-1)return this.videoPreviewVisible=!0,void(this.videoPreviewRow=e);if(e.contentType.indexOf("audio")>-1)return void d["a"].$emit("onAddAudio",e,this.audioCoverUrl);if(c["c"].compressedFile.includes(e.suffix))return void(this.openCompressionVisible=!0);if(e.contentType.indexOf("office")>-1||["pdf","csv","drawio","mind"].includes(e.suffix))return this.officePreviewVisible=!0,void(this.officePreviewRow=e);this.notPreviewDialogVisible=!0}},forciblyOpen:function(e){this.textPreviewRow=e,this.textPreviewVisible=!0;var t=this;setTimeout((function(){t.notPreviewDialogVisible=!1}),100)},determineDownload:function(e){this.downLaod(e),this.notPreviewDialogVisible=!1},downLaod:function(e){$["a"].download(this.$store.state.user.name,e,this.$store.getters.token)}}},E=O,P=(i("32d9"),Object(S["a"])(E,a,n,!1,null,"2f747bb2",null));t["default"]=P.exports},cbbd:function(e,t,i){"use strict";i("6980")},cc5e:function(e,t,i){"use strict";var a=i("b775"),n=i("4328");t["a"]={roleList:function(e){return Object(a["a"])({url:"/role/list",method:"get",params:e})},add:function(e){return Object(a["a"])({url:"/role/add",method:"post",data:e})},update:function(e){return Object(a["a"])({url:"role/update",method:"put",data:e})},delete:function(e){return Object(a["a"])({url:"/role/delete",method:"delete",params:e,paramsSerializer:function(e){return n.stringify(e,{arrayFormat:"repeat"})}})}}},ce76:function(e,t,i){"use strict";i("bbd7")},d28d:function(e,t,i){"use strict";var a=i("b775"),n=i("4328");t["a"]={tagList:function(e){return Object(a["a"])({url:"tag/list",method:"get",params:e})},tagInfo:function(e){return Object(a["a"])({url:"tag/info",method:"get",params:e})},add:function(e){return Object(a["a"])({url:"tag/add",method:"post",data:e})},update:function(e){return Object(a["a"])({url:"tag/update",method:"put",data:e})},delete:function(e){return Object(a["a"])({url:"tag/delete",method:"delete",params:e,paramsSerializer:function(e){return n.stringify(e,{arrayFormat:"repeat"})}})}}},d693:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-select",{ref:"treeSelect",attrs:{value:e.valueTitle,clearable:e.clearable,filterable:"",placeholder:e.placeholder,"filter-method":e.filterMethod},on:{clear:e.clearHandle}},[i("el-option",{staticClass:"options",attrs:{value:e.valueTitle,label:e.valueTitle}}),e._v(" "),i("el-tree",{ref:"selectTree",attrs:{id:"tree-option",accordion:e.accordion,data:e.options,props:e.props,"empty-text":"未找到結果","node-key":e.props.value,"highlight-current":"","default-expand-all":"","expand-on-click-node":!1,"default-expanded-keys":e.defaultExpandedKey,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)},n=[],s=(i("7f7f"),i("ac6a"),{name:"TreeSelect",props:{props:{type:Object,default:function(){return{value:"id",label:"name",children:"children"}}},options:{type:Array,default:function(){return[]}},value:{type:String,default:""},clearable:{type:Boolean,default:function(){return!0}},accordion:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:function(){return"檢索關鍵字"}}},data:function(){return{valueId:this.value,valueTitle:"",defaultExpandedKey:[]}},mounted:function(){this.initHandle()},methods:{initHandle:function(){var e=this;this.valueId?this.$nextTick((function(){e.$refs.selectTree.setCurrentKey(e.valueId);var t=e;setTimeout((function(){t.valueTitle=t.$refs.selectTree.getNode(t.valueId).data[t.props.label]}),100),e.defaultExpandedKey=[e.valueId]})):this.valueTitle=""},handleNodeClick:function(e){this.valueTitle=e[this.props.label],this.valueId=e[this.props.value],this.defaultExpandedKey=[],this.$refs.treeSelect.blur(),this.$emit("input",this.valueId)},clearHandle:function(){this.valueTitle="",this.valueId=null,this.defaultExpandedKey=[],this.clearSelected(),this.$emit("input","")},clearSelected:function(){var e=document.querySelectorAll("#tree-option .el-tree-node");e.forEach((function(e){return e.classList.remove("is-current")}))},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},filterMethod:function(e){this.$refs.selectTree.filter(e)}},watch:{value:function(){this.valueId=this.value,this.initHandle()}}}),o=s,r=(i("7f44"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"3cdaaf24",null);t["a"]=l.exports},d801:function(e,t,i){},daba:function(e,t,i){},daf3:function(e,t,i){"use strict";i("e7ba")},ddfe:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("log-list",{attrs:{type:"LOGIN","table-header":e.tableHeader}})],1)},n=[],s=i("4d8d"),o={components:{LogList:s["default"]},data:function(){return{tableHeader:[{prop:"username",label:"賬號",sortable:"custom"},{prop:"showName",label:"用戶名",sortable:"custom"},{prop:"ip",label:"IP地址",sortable:"custom"},{prop:"deviceModel",label:"設備型號",sortable:"custom"},{prop:"operatingSystem",label:"操作系統",sortable:"custom"},{prop:"browser",label:"瀏覽器",sortable:"custom"},{prop:"status",minWidth:80,label:"狀態",tag:!0,formatData:function(e){return 0===e?[{name:"登錄成功",type:"success"}]:[{name:"登錄失敗",type:"danger"}]}},{prop:"remarks",label:"備註",sortable:"custom"},{prop:"createTime",label:"創建時間",minWidth:150,sortable:"custom"}]}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"02daad4f",null);t["default"]=c.exports},de32:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{queryFileType:"image",orderCustom:!0,sortable:e.sortable,queryCondition:e.queryCondition,emptyStatus:"還沒有圖片呢~"}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFolder:!1}}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"75bb1bd0",null);t["default"]=c.exports},e053:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{defaultGrid:!1,orderCustom:!0,sortable:e.sortable,queryCondition:e.queryCondition,showNavigation:!0}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFolder:!1}}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"1d30c42b",null);t["default"]=c.exports},e054:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("show-file",{attrs:{queryFileType:"audio",orderCustom:!0,defaultGrid:!1,sortable:e.sortable,queryCondition:e.queryCondition,singleFileType:"音樂",emptyStatus:"還沒有音樂呢~"}})],1)},n=[],s=i("c41c"),o={components:{ShowFile:s["default"]},data:function(){return{sortable:{prop:"updateDate",order:"descending"},queryCondition:{isFolder:!1}}}},r=o,l=i("2877"),c=Object(l["a"])(r,a,n,!1,null,"fa6b93b2",null);t["default"]=c.exports},e134:function(e,t,i){"use strict";i("5a56")},e1e7:function(e,t,i){"use strict";i("5747")},e528:function(e,t,i){"use strict";i("a1f0")},e7ba:function(e,t,i){},ec88:function(e,t,i){"use strict";i("daba")},ed66:function(e,t,i){},eea1:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-select",{ref:"treeSelect",attrs:{size:e.size,clearable:e.clearable,multiple:"","collapse-tags":e.collapseTags,placeholder:e.placeholder},on:{clear:e.clearHandle,"remove-tag":e.removeTag},model:{value:e.valueTitles,callback:function(t){e.valueTitles=t},expression:"valueTitles"}},[e._l(e.options,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),i("el-tree",{ref:"selectTree",staticClass:"multiple-tree",attrs:{"node-key":"id",data:e.options,props:e.props,"icon-class":"-","check-on-click-node":!0,"expand-on-click-node":!1,"check-strictly":!0,"highlight-current":!1,"default-expand-all":"","default-checked-keys":e.value,"show-checkbox":""},on:{check:e.selectNode}})],2)},n=[],s=(i("7f7f"),{name:"MultipleTreeSelect",props:{props:{type:Object,default:function(){return{value:"id",label:"name",children:"children"}}},options:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}},clearable:{type:Boolean,default:function(){return!0}},accordion:{type:Boolean,default:function(){return!1}},placeholder:{type:String,default:function(){return"請選擇"}},size:{type:String,default:"small"},collapseTags:{type:Boolean,default:function(){return!1}},selectPackUp:{type:Boolean,default:function(){return!1}}},data:function(){return{valueIds:this.value,valueTitles:[],data:[]}},mounted:function(){this.initHandle()},methods:{initHandle:function(){var e=this;this.valueIds?this.$nextTick((function(){e.$refs.selectTree.setCheckedKeys(e.valueIds);var t=e;setTimeout((function(){t.valueIds.length>0?t.valueTitles=t.$refs.selectTree.getCheckedNodes().map((function(e){return e.name})):t.valueTitles=[]}),100)})):this.valueTitles=[]},selectNode:function(e,t){this.valueIds=t.checkedKeys,this.$emit("input",this.valueIds),this.selectPackUp&&this.$refs.treeSelect.blur()},removeTag:function(e){this.valueTitles=this.valueTitles.filter((function(t){return t!==e}));var t=this.$refs.selectTree.getCheckedKeys(),i=this.$refs.selectTree.getCheckedNodes().filter((function(t){return t.name===e}))[0].id;t=t.filter((function(e){return e!==i})),this.valueIds=t,this.$refs.selectTree.setCheckedKeys(t),this.$emit("input",this.valueIds)},clearHandle:function(){this.valueTitles=[],this.valueIds=[],this.$refs.selectTree.setCheckedKeys([]),this.$emit("input",this.valueIds)}},watch:{value:function(e){this.valueIds=e,this.initHandle()}}}),o=s,r=(i("ce76"),i("2877")),l=Object(r["a"])(o,a,n,!1,null,"39fc518d",null);t["a"]=l.exports},f406:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-input-image"},[i("el-row",[i("el-col",{attrs:{xs:24}},[i("select-file",{attrs:{title:"選擇圖片",visible:e.dialogSelectFile},on:{select:e.selectedFile,"update:visible":function(t){e.dialogSelectFile=t}}}),e._v(" "),i("div",{staticClass:"upload"},[e.enableSelect?i("el-button",{staticClass:"upload-select-btn",attrs:{title:"選擇文件",type:"primary",size:"small",icon:"el-icon-folder",circle:""},on:{click:function(t){e.dialogSelectFile=!0}}}):e._e(),e._v(" "),i("el-upload",{ref:"uploadRef",staticClass:"upload",attrs:{action:"/api/upload-markdown-image",headers:e.headers,data:e.extraData,name:"files",accept:e.accept,"show-file-list":!1,"file-list":e.fileList,limit:1,"before-upload":e.handleBeforeUpload,"on-success":e.handleSuccess,"on-remove":e.handleFileListRemove,"on-progress":e.handleProgress}},[i("el-button",{attrs:{title:"上傳",type:"primary",size:"small",icon:"el-icon-upload2",circle:""}}),e._v(" "),e.desc.length>0?i("span",[e._v(e._s(e.desc))]):e._e(),e._v(" "),e.uploadState>0?i("div",{staticClass:"url-desc",attrs:{slot:"tip"},slot:"tip"},[i("span",{directives:[{name:"show",rawName:"v-show",value:1===e.uploadState,expression:"uploadState === 1"}]},[e._v("圖片上傳中"+e._s(e.uploadPercentage)+"%")]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:2===e.uploadState,expression:"uploadState === 2"}]},[e._v("圖片上傳成功")]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:3===e.uploadState,expression:"uploadState === 3"}]},[e._v("該圖片不支持自動上傳")]),e._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:4===e.uploadState,expression:"uploadState === 4"}]},[e._v("圖片加載中")]),e._v(" "),i("i",{class:{"el-icon-loading":1===e.uploadState||4===e.uploadState,"el-icon-check":2===e.uploadState,"el-icon-warning-outline":3===e.uploadState}})]):e._e()],1)],1)],1),e._v(" "),i("el-col",{attrs:{xs:24}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"bottom"}},[i("el-input",{attrs:{autosize:e.intputAutosize,placeholder:(e.enableUrl?"請輸入圖片的url 或 ":"")+e.placeholder,type:"textarea",width:"100%"},on:{change:e.change,input:e.input,focus:function(t){e.isLocked=!0}},model:{value:e.currentValue,callback:function(t){e.currentValue=t},expression:"currentValue"}}),e._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("el-image",{style:{maxWidth:e.tipImageMaxWidth+"px"},attrs:{src:e.currentValue,fit:"contain"},on:{load:e.loadSuccess}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("i",{staticClass:"el-icon-picture-outline"})])])],1)],1)],1)],1)],1)},n=[],s=(i("28a5"),i("a481"),i("f559"),i("7f7f"),i("c5f6"),i("5cfc")),o=i("2690"),r=i("8ea6"),l={name:"UploadImageInput",components:{SelectFile:r["a"]},props:{value:{type:String,default:""},accept:{type:String,default:"image/*"},tipImageMaxWidth:{type:Number,default:250},placeholder:{type:String,default:"點擊上傳"},intputAutosize:{type:Object,default:function(){return{minRows:1,maxRows:6}}},enableSelect:{type:Boolean,default:!0},enableUrl:{type:Boolean,default:!0},desc:{type:String,default:""}},data:function(){return{headers:{"jmal-token":this.$store.state.user.token,username:this.$store.state.user.name,userId:this.$store.state.user.userId},extraData:{username:this.$store.state.user.name,userId:this.$store.state.user.userId},currentValue:this.value,fileList:[],isLocked:!1,timer:null,uploadState:0,uploadTip:"",dialogSelectFile:!1,uploadPercentage:0}},watch:{value:function(e){this.currentValue=e}},methods:{change:function(e){this.isLocked=!1,this.$emit("input",e)},input:function(e){},selectedFile:function(e){var t=this;s["a"].setPublic({fileId:e.id}).then((function(){t.currentValue=window.location.origin+o["a"].previewUrl(t.$store.state.user.name,e,void 0),t.change(t.currentValue)}))},handleBeforeUpload:function(){this.uploadState=1},handleProgress:function(e,t){this.onpregress(0|t.percentage)},onpregress:function(e){this.uploadPercentage=e},handleSuccess:function(e){0===e.code&&e.data&&e.data.length>0&&this.format(e.data[0].filepath,e.data[0].filename),this.uploadSuccessAfter()},uploadSuccessAfter:function(){this.uploadState=2,this.fileList=[];var e=this;setTimeout((function(){e.uploadState=0}),3e3)},handleFileListRemove:function(e,t){this.fileList=t},format:function(e){this.currentValue=o["a"].mardownPreviewUrl(e),this.change(this.currentValue)},urlToBlob:function(e,t){var i=this,a=new XMLHttpRequest;a.open("get",e,!0),a.responseType="blob",a.onload=function(){200===this.status&&t&&t(this.response)},a.onerror=function(){i.uploadState=3},a.send()},loadSuccess:function(){if(null==this.timer&&this.enableUrl){if(this.isLocked){var e=this;this.timer=setTimeout((function(){e.currentValue.startsWith(window.location.origin)||(e.uploadState=4,e.urlToBlob(e.currentValue,(function(t){e.uploadState=1;var i=e.getFileNameByUrl(e.currentValue);if(t.type.startsWith("image")&&i.indexOf(".")){var a=t.type.replace("image/",".");i+=a}var n=new window.File([t],i,{type:t.type}),s=new FormData;s.append("files",n),s.append("username",e.$store.state.user.name),s.append("userId",e.$store.state.user.userId),e.uploadImage(e,s)})))}),300)}}else clearTimeout(this.timer),this.timer=null},uploadImage:function(e,t){axios.post("/api/upload-markdown-image",t,{headers:{"Content-Type":"multipart/form-data","jmal-token":e.$store.state.user.token},onUploadProgress:function(t){e.onpregress(t.loaded/t.total*100|0)}}).then((function(t){var i=t.data.data[0];e.format(i.filepath,i.filename),e.uploadSuccessAfter(),e.$refs.uploadRef.clearFiles()}))},getFileNameByUrl:function(e){var t=/[a-zA-z]+:\/\/[^\s]*/;if(t.test(e)){e.indexOf("-1")>-1&&(e=e.split("?")[0]);var i=e.split("/");return i[i.length-1]}}}},c=l,d=(i("c056"),i("2877")),u=Object(d["a"])(c,a,n,!1,null,"69ff93a2",null);t["a"]=u.exports},f40d:function(e,t,i){"use strict";i("c145")},f440:function(e,t,i){},f620:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{staticClass:"dialog-form",attrs:{width:"400px",title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium","label-width":"90px",model:e.form,rules:e.rules}},[i("el-form-item",{attrs:{label:"角色名稱:",prop:"name"}},[i("el-input",{attrs:{placeholder:"請輸入角色名稱",width:"100%"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色標識:",prop:"code"}},[i("el-input",{attrs:{placeholder:"請輸入角色標識"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"備註:",prop:"remarks"}},[i("el-input",{attrs:{type:"textarea",autosize:"",autosize:{minRows:3,maxRows:6},placeholder:"請輸入備註"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.updateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.onSave()}}},[e._v("保 存")])],1)],1),e._v(" "),i("el-dialog",{attrs:{width:"400px",title:"分配權限",visible:e.dialogAuthVisible},on:{"update:visible":function(t){e.dialogAuthVisible=t}}},[i("el-scrollbar",[i("el-tree",{ref:"authTree",staticStyle:{"max-height":"50vh"},attrs:{data:e.menuList,"check-strictly":!0,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":e.menuCheckedList,props:{value:"id",label:"name"}}})],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogAuthVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary",loading:e.updateLoading},nativeOn:{click:function(t){return t.preventDefault(),e.saveAuth()}}},[e._v("保 存")])],1)],1),e._v(" "),i("el-card",{staticClass:"box-card table-search-header"},[i("div",{attrs:{slot:"header"},slot:"header"},[i("div",{staticClass:"box-card-header"},[i("el-form",{ref:"queryForm",staticClass:"search-form",attrs:{size:"medium","label-width":"77px",model:e.queryCondition,rules:e.rules}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12,md:6}},[i("el-form-item",{attrs:{label:"角色名稱:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:6}},[i("el-form-item",{attrs:{label:"角色標識:"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.code,callback:function(t){e.$set(e.queryCondition,"code",t)},expression:"queryCondition.code"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:5,xl:6}},[i("el-form-item",{attrs:{label:"備註:","label-width":"50px"}},[i("el-input",{attrs:{clearable:"",placeholder:"請輸入"},model:{value:e.queryCondition.remarks,callback:function(t){e.$set(e.queryCondition,"remarks",t)},expression:"queryCondition.remarks"}})],1)],1),e._v(" "),i("el-col",{attrs:{sm:12,md:7,xl:6}},[i("div",{staticClass:"el-form-actions"},[i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-search",type:"primary"},on:{click:function(t){return e.getRoleList()}}},[e._v("查詢")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{size:"medium",icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.add()}}},[e._v("添加")]),e._v(" "),i("el-button",{staticClass:"card-btn-icon",attrs:{disabled:e.multipleSelection.length<1,size:"medium",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.handleSelectDelete()}}},[e._v("刪除")])],1)])],1)],1)],1)]),e._v(" "),i("table-list",{attrs:{"less-client-height":280,tableData:e.dataList,loading:e.loading,tableHeader:e.tableHeader,pagination:e.pagination},on:{pageChange:e.pageChange,sizeChange:e.pageChange,selectFun:e.selectFun,sortChange:e.sortChange}})],1)],1)},n=[],s=(i("ac6a"),i("20d6"),i("c80c")),o=(i("96cf"),i("3b8d")),r=i("db72"),l=i("cc5e"),c=i("1f27"),d=i("7c83"),u={components:{TableList:d["a"]},props:{},data:function(){var e=this;return{title:"角色管理",dataList:[],menuList:[],menuCheckedList:[],loading:!1,dialogVisible:!1,dialogAuthVisible:!1,dialogTitle:"",updateLoading:!1,updateAuthLoading:!1,valid:!0,form:{name:"",code:"",remarks:"",menuIds:[]},pagination:{pageIndex:1,pageSize:15,pageTotal:0},queryCondition:{name:"",code:"",remarks:"",sortProp:"",sortOrder:""},tableHeader:[{prop:"name",label:"角色名稱",minWidth:110,sortable:"custom"},{prop:"code",label:"角色標識",minWidth:110,sortable:"custom"},{prop:"remarks",label:"備註",minWidth:110,sortable:"custom"},{prop:"createTime",label:"創建時間",minWidth:110,sortable:"custom"},{label:"操作",minWidth:this.$pc?0:160,active:[{name:"修改",icon:"el-icon-edit",handle:function(t){return e.handleEdit(t.id)}},{name:"分配權限",icon:"el-icon-finished",handle:function(t){return e.authorization(t.id)}}]}],multipleSelection:[],rules:{name:[{required:!0,message:"請輸入角色名稱",trigger:"blur"}],code:[{required:!0,message:"請輸入角色標識",trigger:"blur"}]},editMove:1}},computed:{},mounted:function(){this.getRoleList(),this.getMenuTree(),this.resize()},methods:{resize:function(){var e=document.querySelector(".container").clientWidth,t=e<=768;this.tableHeader[2].disabled=t,this.tableHeader[3].disabled=t},selectFun:function(e){this.multipleSelection=e.backData},sortChange:function(e){var t=e.backData;this.queryCondition.sortProp=t.prop,this.queryCondition.sortOrder=t.order,this.getRoleList()},pageChange:function(e){this.pagination=e.backData,this.getRoleList()},getRoleList:function(){var e=this;this.loading=!0,l["a"].roleList(Object(r["a"])({page:this.pagination.pageIndex,pageSize:this.pagination.pageSize},this.queryCondition)).then((function(t){e.dataList=t.data,e.pagination.pageTotal=t.count,e.loading=!1}))},getMenuTree:function(){var e=this;c["a"].menuTree().then((function(t){e.menuList=t.data}))},add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogVisible=!0,this.dialogTitle="添加角色",this.editMove=1,e.next=5,this.$nextTick();case 5:this.$refs.managerForm.resetFields();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setFormData:function(){var e=new FormData;for(var t in this.form)this.form.hasOwnProperty(t)&&e.append(t,this.form[t]);return e.delete("createTime"),e.delete("updateTime"),e},onSave:function(){var e=this;this.$refs.managerForm.validate((function(t){if(e.valid=t,!t)return!1;e.updateLoading=!0,1===e.editMove&&e.addRole(e.setFormData()),2===e.editMove&&e.updateRole(e.setFormData())}))},saveAuth:function(){this.form.menuIds=this.$refs.authTree.getCheckedKeys(),this.updateRole(this.setFormData())},authorization:function(e){i("51ff");this.dialogAuthVisible=!0;var t=this.dataList.findIndex((function(t){return t.id===e})),a=this.dataList[t];this.form=a,this.$refs.authTree?this.$refs.authTree.setCheckedKeys(a.menuIds):this.menuCheckedList=a.menuIds},handleEdit:function(e){this.editMove=2,this.dialogVisible=!0,this.dialogTitle="修改角色";var t=this.dataList.findIndex((function(t){return t.id===e}));this.form=this.dataList[t]},resetPassword:function(){var e=this;this.$confirm("確定重置該用戶密碼嗎, 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){resetPass(e.form.id).then((function(){})).catch((function(){e.onError()}))}))},handleSelectDelete:function(){var e=this;this.$confirm("確定要刪除選中的角色嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=[];e.multipleSelection.forEach((function(e){t.push(e.id)})),e.deleteRole(t)}))},handleDelete:function(e){var t=this;this.$confirm("確定要刪除此角色嗎？","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){t.deleteRole(e)}))},deleteRole:function(e){var t=this;l["a"].delete({roleIds:e}).then((function(){t.onSuccess("刪除成功!")})).catch((function(){t.onError()}))},updateRole:function(e){var t=this;l["a"].update(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},addRole:function(e){var t=this;l["a"].add(e).then((function(){t.onSuccess()})).catch((function(){t.onError()}))},onSuccess:function(e){this.getRoleList();var t="保存成功!";e&&(t=e),this.updateLoading=!1,this.dialogVisible=!1,this.dialogAuthVisible=!1,this.$message({message:t,type:"success",duration:1e3})},onError:function(){this.updateLoading=!1}}},h=u,f=(i("9ef7"),i("2877")),p=Object(f["a"])(h,a,n,!1,null,"486e4fe2",null);t["default"]=p.exports},f856:function(e,t,i){},f8fd:function(e,t,i){},f9ca:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("select-file",{attrs:{title:"選擇頭像",visible:e.dialogSelectFile},on:{select:e.selectedFile,"update:visible":function(t){e.dialogSelectFile=t}}}),e._v(" "),i("el-dialog",{staticClass:"dialog-avatar",attrs:{title:"修改頭像",visible:e.dialogAvatar},on:{"update:visible":function(t){e.dialogAvatar=t},close:e.handleCloseDialogAvatar}},[i("cropper-dialog",{ref:"cropperDialog",attrs:{"file-img":e.fileImg,"select-img":e.selectedImgRow,avatar:e.userInfo.avatar},on:{noCropSave:e.saveNoCropAvatar,croppedCanvas:e.saveAvatar}})],1),e._v(" "),i("el-dialog",{staticClass:"dialog-cm",attrs:{width:"400px",title:e.passwordFormTitle,visible:e.dialogChangePassword},on:{"update:visible":function(t){e.dialogChangePassword=t}}},[i("el-form",{ref:"passwordForm",attrs:{size:"medium",model:e.passwordForm,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.validOldPass,expression:"!validOldPass"}],attrs:{label:"舊密碼",prop:"oldPassword"}},[i("el-input",{attrs:{type:"password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSavePassword.apply(null,arguments)}},model:{value:e.passwordForm.oldPassword,callback:function(t){e.$set(e.passwordForm,"oldPassword",t)},expression:"passwordForm.oldPassword"}})],1),e._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.validOldPass,expression:"validOldPass"}],attrs:{label:"新密碼",prop:"password"}},[i("el-input",{ref:"newPasswordInput",attrs:{type:"password"},model:{value:e.passwordForm.password,callback:function(t){e.$set(e.passwordForm,"password",t)},expression:"passwordForm.password"}})],1),e._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.validOldPass,expression:"validOldPass"}],attrs:{label:"確認新密碼",prop:"checkPass"}},[i("el-input",{attrs:{type:"password"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSavePassword.apply(null,arguments)}},model:{value:e.passwordForm.checkPass,callback:function(t){e.$set(e.passwordForm,"checkPass",t)},expression:"passwordForm.checkPass"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("a",{staticClass:"forget-password",on:{click:e.forget}},[e._v("忘記密碼?")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogChangePassword=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",loading:e.userUpdateLoading,type:"primary"},on:{click:e.onSavePassword}},[e._v("確 定")])],1)],1),e._v(" "),i("el-form",{ref:"cusomerInfoForm",attrs:{model:e.cusomerInfoForm,"label-width":"80px"}},[i("el-form-item",{staticClass:"form-item-avatar",attrs:{label:"頭像"}},[i("div",{staticStyle:{height:"100px",width:"100px"}},[i("el-avatar",{staticClass:"avatar-value",attrs:{icon:"el-icon-user-solid",shape:"circle",size:100,fit:"fit",src:e.srcImage}})],1),e._v(" "),i("div",{staticClass:"avatar-button"},[i("el-button",{attrs:{title:"選擇文件",type:"primary",icon:"el-icon-folder",circle:""},on:{click:e.selectImg}}),e._v(" "),i("el-button",{attrs:{title:"上傳",type:"primary",icon:"el-icon-upload2",circle:""},on:{click:e.uploadImg}}),e._v(" "),i("input",{ref:"selectImg",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.changImg}})],1)]),e._v(" "),i("el-form-item",{attrs:{label:"密碼"}},[i("el-button",{attrs:{size:"mini",round:""},on:{click:e.changePassword}},[e._v("修改密碼")])],1),e._v(" "),i("el-form-item",{attrs:{label:"用戶名"}},[i("el-input",{staticClass:"input-none-width",model:{value:e.cusomerInfoForm.showName,callback:function(t){e.$set(e.cusomerInfoForm,"showName",t)},expression:"cusomerInfoForm.showName"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"標語"}},[i("el-input",{staticClass:"form-slogan",model:{value:e.cusomerInfoForm.slogan,callback:function(t){e.$set(e.cusomerInfoForm,"slogan",t)},expression:"cusomerInfoForm.slogan"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"個人簡介"}},[i("el-input",{staticClass:"form-slogan",attrs:{type:"textarea"},model:{value:e.cusomerInfoForm.introduction,callback:function(t){e.$set(e.cusomerInfoForm,"introduction",t)},expression:"cusomerInfoForm.introduction"}})],1),e._v(" "),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.percentage>0,expression:"percentage > 0"}],attrs:{label:"使用情況"}},[i("el-progress",{staticClass:"quota-space",attrs:{percentage:e.percentage,format:e.progressFormat,color:e.customColors}})],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",size:"medium",loading:e.userUpdateLoading},on:{click:e.onSubmit}},[e._v("保 存")])],1)],1)],1)},n=[],s=(i("7f7f"),i("c5f6"),i("c80c")),o=(i("6762"),i("2fdb"),i("96cf"),i("3b8d")),r=i("c24f"),l=i("7f29"),c=i("74e6"),d=i("8ea6"),u=(i("2690"),{name:"cusomerInfo",components:{CropperDialog:c["a"],SelectFile:d["a"]},props:{},data:function(){var e=this,t=function(t,i,a){""===i?a(new Error("請再次輸入密碼")):i!==e.passwordForm.password?a(new Error("兩次輸入密碼不一致!")):a()};return{imageUrl:"/api/view/thumbnail?jmal-token="+this.$store.state.user.token+"&id=",title:"個人信息",userUpdateLoading:!1,dialogAvatar:!1,dialogChangePassword:!1,cropper:"",percentage:0,userInfo:{},customColors:[{color:"#f56c6c",percentage:100},{color:"#e6a23c",percentage:80},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:40},{color:"#6f7ad3",percentage:20}],cusomerInfoForm:{},passwordForm:{oldPassword:"",password:"",checkPass:""},srcImage:"",fileImg:new Blob,selectedImgRow:{},rules:{oldPassword:[{required:!0,message:"請輸入舊密碼",trigger:"blur"},{min:6,message:"密碼不能小於6個字符",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"},{min:6,message:"密碼不能小於6個字符",trigger:"blur"}],checkPass:[{required:!0,validator:t,trigger:"blur"}]},validOldPass:!1,passwordFormTitle:"",dialogSelectFile:!1}},computed:{},mounted:function(){this.getInfo()},methods:{uploadImg:function(){this.$refs.selectImg.click()},selectImg:function(){this.dialogSelectFile=!0},selectedFile:function(e){this.dialogAvatar=!0,this.selectedImgRow=e,this.$refs.cropperDialog&&this.$refs.cropperDialog.setSelectImg(this.selectedImgRow)},handleCloseDialogAvatar:function(){this.$refs.selectImg.value=""},changImg:function(e){var t=e.target.files;t.length<1||(t[0].size/1024/1024>5?this.$message({message:"選擇的圖片不能超過5M",type:"warning"}):(this.fileImg=t[0],this.dialogAvatar=!0,this.selectedImgRow={},this.$refs.cropperDialog&&this.$refs.cropperDialog.changImg(t[0])))},getInfo:function(){var e=this;Object(r["c"])({id:this.$store.state.user.userId,takeUpSpace:!0}).then(function(){var t=Object(o["a"])(Object(s["a"])().mark((function t(a){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.userInfo=a.data,e.userInfo.roles&&e.userInfo.roles.includes("admin")&&e.$emit("isAdmin",!0),t.next=4,e.$nextTick();case 4:e.cusomerInfoForm=e.userInfo,e.srcImage=e.userInfo.avatar?e.imageUrl+e.userInfo.avatar:i("889b");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},changePassword:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.validOldPass=!1,this.dialogChangePassword=!0,e.next=4,this.$nextTick();case 4:this.passwordFormTitle="舊密碼",this.$refs.passwordForm.resetFields();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSubmit:function(){this.userUpdate(this.setFormData())},forget:function(){this.$alert("請聯繫管理員重置密碼","提示",{confirmButtonText:"確定"})},onSavePassword:function(){var e=this;this.validOldPass?this.$refs.passwordForm.validate((function(t){if(e.valid=t,t){if(e.validOldPass){e.userUpdateLoading=!0;var i=new FormData;i.append("id",e.$store.state.user.userId),i.append("password",e.passwordForm.password),Object(r["i"])(i).then((function(){e.userUpdateLoading=!1,e.dialogChangePassword=!1})).catch((function(){e.userUpdateLoading=!1}))}return!0}return!1})):(this.userUpdateLoading=!0,Object(r["l"])({id:this.$store.state.user.userId,password:this.passwordForm.oldPassword}).then((function(){e.userUpdateLoading=!1,e.validOldPass=!0,e.passwordFormTitle="新密碼";var t=e;setTimeout((function(){t.$refs.newPasswordInput.focus()}))})).catch((function(){e.userUpdateLoading=!1})))},progressFormat:function(){var e=this.userInfo.takeUpSpace/1024/1024/1024,t=this.userInfo.quota;if(e&&t>0){var i=Number((e/t*100).toFixed(1));return this.percentage=i>100?100:i,"".concat(this.percentage,"% (").concat(Object(l["b"])(this.userInfo.takeUpSpace),"/").concat(t,"GB)")}},setFormData:function(){var e=new FormData;for(var t in this.cusomerInfoForm)this.cusomerInfoForm.hasOwnProperty(t)&&"avatar"!==t&&e.append(t,this.cusomerInfoForm[t]);return e.delete("createTime"),e.delete("updateTime"),e},saveAvatar:function(e,t){this.dialogAvatar=!1,this.srcImage=e;var i=new FormData;i.append("id",this.$store.state.user.userId),i.append("blobAvatar",t),this.userUpdate(i,e)},blobToFile:function(e){return new window.File([e],e.name,{type:e.type})},saveNoCropAvatar:function(e){this.dialogAvatar=!1;var t=new FormData;t.append("id",this.$store.state.user.userId),t.append("avatar",e),this.userUpdate(t)},userUpdate:function(e,t){var i=this;this.userUpdateLoading=!0,Object(r["k"])(e).then((function(a){i.userUpdateLoading=!1,i.$message({message:"保存成功!",type:"success",duration:1e3}),(t||a.data)&&(i.srcImage=i.imageUrl+a.data,i.$store.state.user.avatar=a.data),null!=e.get("showName")&&(i.$store.state.user.showName=e.get("showName"))})).catch((function(){i.userUpdateLoading=!1}))}}}),h=u,f=(i("ec88"),i("2877")),p=Object(f["a"])(h,a,n,!1,null,"73c5706c",null);t["default"]=p.exports},f9f9:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{staticClass:"dialog-form",attrs:{width:"600px",title:"詳情",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"managerForm",attrs:{size:"medium","label-width":"90px",model:e.detailsData}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{sm:12}},[i("el-form-item",{attrs:{label:"操作人:"}},[i("div",[e._v(e._s(e.detailsData.showName)+"("+e._s(e.detailsData.username)+")")])]),e._v(" "),i("el-form-item",{attrs:{label:"操作模塊:"}},[i("div",[e._v(e._s(e.detailsData.operationModule))])]),e._v(" "),i("el-form-item",{attrs:{label:"設備型號:"}},[i("div",[e._v(e._s(e.detailsData.deviceModel))])]),e._v(" "),i("el-form-item",{attrs:{label:"瀏覽器:"}},[i("div",[e._v(e._s(e.detailsData.browser))])]),e._v(" "),i("el-form-item",{attrs:{label:"方式:"}},[i("div",[e._v(e._s(e.detailsData.method))])])],1),e._v(" "),i("el-col",{attrs:{sm:12}},[i("el-form-item",{attrs:{label:"操作時間:"}},[i("div",[e._v(e._s(e.detailsData.createTime))])]),e._v(" "),i("el-form-item",{attrs:{label:"操作功能:"}},[i("div",[e._v(e._s(e.detailsData.operationFun))])]),e._v(" "),i("el-form-item",{attrs:{label:"操作系統:"}},[i("div",[e._v(e._s(e.detailsData.operatingSystem))])]),e._v(" "),i("el-form-item",{attrs:{label:"請求耗時:"}},[i("div",[e._v(e._s(e.detailsData.time)+"ms")])]),e._v(" "),i("el-form-item",{attrs:{label:"請求狀態:"}},[i("el-tag",{attrs:{size:"mini",type:0===e.detailsData.status?"success":"danger"}},[e._v("\n              "+e._s(0===e.detailsData.status?"正常":"異常")+"\n            ")])],1)],1)],1),e._v(" "),i("el-divider"),e._v(" "),i("el-row",[i("el-col",[i("el-form-item",{attrs:{label:"IP地址:"}},[i("div",[e._v(e._s(e.detailsData.ip+" "+e.ipInfo))])])],1),e._v(" "),i("el-col",[i("el-form-item",{attrs:{label:"請求地址:"}},[i("div",[e._v(e._s(e.detailsData.url))])])],1),e._v(" "),i("el-col",[i("el-form-item",{attrs:{label:"備註:"}},[i("div",[e._v(e._s(e.detailsData.remarks))])])],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("關閉")])],1)],1),e._v(" "),i("log-list",{attrs:{type:"OPERATION","table-header":e.tableHeader}})],1)},n=[],s=i("4d8d"),o={components:{LogList:s["default"]},data:function(){var e=this;return{tableHeader:[{prop:"username",label:"賬號",minWidth:105,sortable:"custom"},{prop:"showName",label:"用戶名",minWidth:105,sortable:"custom"},{prop:"ip",label:"IP地址",minWidth:105,sortable:"custom"},{prop:"operationModule",label:"操作模塊",minWidth:105,sortable:"custom"},{prop:"operationFun",label:"操作功能",minWidth:105,sortable:"custom"},{prop:"url",label:"請求地址",minWidth:105,sortable:"custom"},{prop:"method",label:"方式",minWidth:75,sortable:"custom"},{prop:"status",minWidth:75,label:"狀態",tag:!0,sortable:"custom",formatData:function(e){return 0===e?[{name:"正常",type:"success"}]:[{name:"異常",type:"danger"}]}},{prop:"time",label:"耗時",minWidth:75,sortable:"custom",formatData:function(e){return e+"ms"}},{prop:"createTime",label:"創建時間",minWidth:150,sortable:"custom"},{label:"操作",minWidth:75,active:[{name:"詳情",icon:"el-icon-view",handle:function(t){return e.details(t)}}]}],dialogVisible:!1,detailsData:{},ipInfo:{}}},methods:{details:function(e){this.detailsData=e;var t=e.ipInfo;this.ipInfo="",t&&(this.ipInfo="".concat(t.country?t.country+"|":"").concat(t.area?t.area+"|":"").concat(t.province?t.province+"|":"").concat(t.city?t.city+"|":"").concat(t.operators?t.operators:"")),this.dialogVisible=!0}}},r=o,l=(i("1414"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"1141d9cb",null);t["default"]=c.exports},fc9a:function(e,t,i){},fe71:function(e,t,i){"use strict";i("6e63")},fff3:function(e,t,i){}}]);