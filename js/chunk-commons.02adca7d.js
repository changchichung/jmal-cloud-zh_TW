(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-commons"],{"0dcf":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[e.item.isFavorite&&!e.public?i("div",[e.pc?i("div",[e.grid?e._e():i("svg-icon",{staticClass:"favorite",staticStyle:{"font-size":"1rem",float:"right","margin-left":"1rem",position:"absolute"},attrs:{"icon-class":"menu-favorite-hover"}}),e._v(" "),e.grid?i("svg-icon",{staticClass:"favorite",staticStyle:{"font-size":"1.5rem",right:"0",top:"-1rem",position:"absolute","z-index":"1"},attrs:{"icon-class":"menu-favorite-hover"}}):e._e()],1):i("div",[e.grid?e._e():i("svg-icon",{staticClass:"favorite",staticStyle:{"font-size":"0.5rem",float:"right","margin-left":"0.5rem",position:"absolute"},attrs:{"icon-class":"menu-favorite-hover"}}),e._v(" "),e.grid?i("svg-icon",{staticClass:"favorite",staticStyle:{"font-size":"1rem",right:"0",top:"-1rem",position:"absolute","z-index":"1"},attrs:{"icon-class":"menu-favorite-hover"}}):e._e()],1)]):e._e(),e._v(" "),e.item.isFolder?i("svg-icon",{attrs:{"icon-class":"folder"}}):e.item.contentType.indexOf("video")>-1?i("svg-icon",{attrs:{"icon-class":"video"}}):e.item.contentType.indexOf("audio")>-1?i("div",{on:{mousedown:function(t){return e.noDrag(t)}}},[void 0!==e.item.music?i("div",[null!==e.item.music.name?i("div",[e.grid?i("el-image",{style:{height:e.details?"110px":e.gridWidth-35+"px"},attrs:{fit:"contain",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("svg-icon",{staticClass:"avatar-default-image",attrs:{"icon-class":"audio"}})],1)]):e._e(),e._v(" "),e.grid?e._e():i("el-avatar",{attrs:{shape:"square",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[i("div",{attrs:{slot:"default"},slot:"default"},[i("svg-icon",{staticClass:"avatar-default-image",attrs:{"icon-class":"audio"}})],1)])],1):e._e()]):i("svg-icon",{attrs:{"icon-class":"audio"}})],1):e.item.contentType.startsWith("image")?i("div",{on:{mousedown:function(t){return e.noDrag(t)}}},[e.grid||"details"===e.grid?i("el-image",{style:{height:e.details?"110px":e.gridWidth-35+"px"},attrs:{fit:"contain",src:e.item.fileId?e.imageUrl+e.item.fileId:e.imageUrl+e.item.id}},[i("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[i("svg-icon",{attrs:{"icon-class":"loading-image-error"}})],1)]):e._e(),e._v(" "),e.grid?e._e():i("el-avatar",{attrs:{shape:"square",src:e.item.fileId?e.imageUrl+e.item.fileId:e.imageUrl+e.item.id}})],1):i("svg-icon",{attrs:{"icon-class":e.findIconClass}})],1)},a=[],s=(i("c5f6"),i("1000")),o={name:"IconFile",props:{imageUrl:{type:String,default:""},audioCoverUrl:{type:String,default:""},grid:{type:Boolean,default:!1},gridWidth:{type:Number,default:120},details:{type:Boolean,default:!1},public:{type:Boolean,default:!1},item:{type:Object,default:function(){return{}}}},data:function(){return{pc:window.pc}},mounted:function(){},computed:{findIconClass:function(){var e=this.item.suffix;return!e&&this.item.fileName&&(e=this.item.fileName.substring(this.item.fileName.lastIndexOf(".")+1)),s["a"].has(e)?s["a"].get(e):"file"}},methods:{noDrag:function(e){}}},r=o,l=(i("4fdd"),i("2877")),d=Object(l["a"])(r,n,a,!1,null,"738b30aa",null);t["a"]=d.exports},1123:function(e,t,i){},1638:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("viewer",{directives:[{name:"show",rawName:"v-show",value:e.pc,expression:"pc"}],ref:"viewer",staticClass:"viewer",attrs:{options:e.options,images:e.images},on:{inited:e.inited},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.images,(function(e,t){return i("div",{key:t},[i("img",{attrs:{src:e.thumbnail,"data-src":e.source}})])}))}}])})],1)},a=[],s=(i("7f7f"),i("ac6a"),i("f559"),i("2690")),o=i("9dce"),r={name:"ImageViewer",components:{},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},fileList:{type:Array,default:function(){return[]}},status:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{imageThumbnailUrl:"/api/view/thumbnail?jmal-token="+this.$store.state.user.token+"&id=",publicImageThumbnailUrl:"/api/public/s/view/thumbnail?id=",currentSrc:"",images:[],imagesFristIndex:-1,imagesLastIndex:-1,imageFiles:[],vantImagePreview:null,pc:this.$pc,options:{url:"data-src",initialViewIndex:3,ready:function(e){},show:function(e){},shown:function(e){},hide:function(e){},hidden:function(){o["a"].$emit("updateImageViewerStatus",!1)},view:function(e){},viewed:function(e){},zoom:function(e){},zoomed:function(e){}}}},watch:{status:function(e){var t=this;if(this.pc=this.$pc,e){this.images=[];var i=0;this.imageFiles=this.fileList.filter((function(e){return!e.isFolder&&e.contentType.startsWith("image")})),this.imageFiles.forEach((function(e){t.images.push({thumbnail:t.getImageUrlbyThumbnail(e.id),source:t.getImageUrl(e)}),t.file.id===e.id&&(i=t.images.length-1)})),this.show(i)}}},mounted:function(){var e=this;o["a"].$on("updateImageViewerStatus",(function(){e.imagesFristIndex=-1,e.imagesLastIndex=-1,e.$emit("update:status",!1)}))},methods:{inited:function(e){this.$viewer=e},getImageUrl:function(e){var t=s["a"].previewUrl(this.$store.state.user.name,e,this.$store.getters.token);return this.shareId&&(t=s["a"].publicPreviewUrl(e.id,window.shareId)),t},getImageUrlbyThumbnail:function(e){return this.$store.getters.token?this.imageThumbnailUrl+e:this.publicImageThumbnailUrl+e},show:function(e){var t=0;e&&(t=e),this.$pc?(this.$viewer.index=t,this.$viewer.show()):this.imagePreview(t)},imagePreview:function(e){var t=[];this.images.forEach((function(e){t.push(e.source)})),this.vantImagePreview=vant.ImagePreview({images:t,startPosition:e,onClose:function(){o["a"].$emit("updateImageViewerStatus",!1)}})}}},l=r,d=(i("26eb"),i("2877")),c=Object(d["a"])(l,n,a,!1,null,"67326f31",null);t["a"]=c.exports},"17a8":function(e,t,i){},"1a01":function(e,t,i){},"1fa4":function(e,t,i){"use strict";i("5312")},"26eb":function(e,t,i){"use strict";i("d298")},"2d53":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("message-dialog",{attrs:{title:"確認信息",content:"檢測到未保存的內容，是否在離開前保存修改？",show:e.isSaveDialogVisible,operatButtonText:"放棄修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isSaveDialogVisible=t},operating:e.closeDialog,confirm:e.confirmUpdate}}),e._v(" "),i("message-dialog",{attrs:{title:"確認信息",content:"是否在關閉前保存修改？",show:e.isTabSaveDialogVisible,operatButtonText:"放棄修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isTabSaveDialogVisible=t},operating:e.closeTabDialog,confirm:e.saveTabAndClose}}),e._v(" "),i("el-dialog",e._g(e._b({directives:[{name:"resize",rawName:"v-resize",value:e.containerResize,expression:"containerResize"},{name:"dialogDrag",rawName:"v-dialogDrag",value:{dialogWidthPercent:e.dialogWidthPercent},expression:"{ dialogWidthPercent: dialogWidthPercent}"}],ref:"simTextDialog",staticClass:"simtext-dialog",attrs:{fullscreen:e.fullscreen,visible:e.textPreviewVisible,title:e.file.name,"close-on-click-modal":!1,"before-close":e.handleClose,width:e.dialogWidth+"px"},on:{"update:visible":function(t){e.textPreviewVisible=t},close:e.closeDialog}},"el-dialog",e.$attrs,!1),e.$listeners),[i("div",{staticClass:"simtext-header-title",attrs:{slot:"title"},slot:"title"},[i("span",{directives:[{name:"show",rawName:"v-show",value:!e.moblie,expression:"!moblie"}]},[i("file-path-nav",{staticClass:"title-name",attrs:{path:e.filePathNav},on:{loadPath:e.loadPath}})],1),e._v(" "),i("div",{staticClass:"title-extension"},[e.isShowUpdateBtn?i("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"small",loading:e.updating},on:{click:function(t){return e.saveAll(!1)}}},[e._v("保存所有")]):e._e(),e._v(" "),e.editableTabsValue.endsWith(".md")?i("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"small",circle:"",title:e.previewMode?"編輯":"預覽"},on:{click:e.changePreviewMode}},[i("icon",{attrs:{type:e.previewMode?e.lightTheme?"icon-quxiaoyulan1":"icon-quxiaoyulan1-copy":e.lightTheme?"icon-yulan":"icon-yulan-copy"}})],1):e._e(),e._v(" "),i("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"small",icon:e.lightTheme?"el-icon-moon":"el-icon-sunny",circle:"",title:e.lightTheme?"暗色":"亮色"},on:{click:e.skinning}}),e._v(" "),i("button",{staticClass:"title-extension-button",attrs:{size:"small"},on:{click:e.fullScreen}},[i("svg-icon",{attrs:{"icon-class":e.fullscreen?"normalscreen":"fullscreen"}})],1)],1)]),e._v(" "),i("div",{staticClass:"content",style:{height:e.editorHieght+26+"px"}},[i("div",{staticClass:"file-contents",style:{width:e.contentsWidth+"px",height:e.editorHieght+32+"px",transition:e.transition,left:e.options.readOnly||e.moblie?"-"+e.contentsWidth+"px":"0px"}},[i("div",{staticClass:"content-tree"},[i("fancy-tree",{ref:"fancTree",attrs:{editableTabs:e.editableTabs,editableTabsValue:e.editableTabsValue,contentsWidth:e.contentsWidth,contentsHieght:e.editorHieght,lightTheme:e.lightTheme,directoryTreeData:e.directoryTreeData},on:{"update:editableTabsValue":function(t){e.editableTabsValue=t},"update:editable-tabs-value":function(t){e.editableTabsValue=t},treeNodeClick:e.treeNodeClick,onLoadTreePath:e.onLoadTreePath,onRename:e.onRename,removeFile:e.removeFile}})],1)]),e._v(" "),i("div",{staticClass:"editor-resize",style:{marginLeft:e.options.readOnly||e.moblie?"0px":e.contentsWidth+"px",transition:e.transition}},[i("div",{staticClass:"darg-resize-conter"}),e._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:!e.options.readOnly&&!e.moblie,expression:"!options.readOnly && !moblie "}],staticClass:"editor-resize-conter",attrs:{icon:"el-icon-arrow-right",title:"影藏文件目錄"},on:{click:e.hideContents}})]),e._v(" "),i("div",{style:{width:e.editorWidth-2+"px"}},[i("el-tabs",{attrs:{type:"card",closable:""},on:{"tab-remove":e.removeTab,"tab-click":e.clickTab},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,(function(t,n){return i("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("svg-icon",{staticClass:"tabs-icon-svg",attrs:{"icon-class":e.findSvgClass(t.name)}}),e._v(" "+e._s(t.title))],1),e._v(" "),e.textPreviewVisible?i("div",{staticClass:"editor"},[i("vditor-preview",{directives:[{name:"show",rawName:"v-show",value:e.editableTabsValue.endsWith(".md")&&e.previewMode,expression:"editableTabsValue.endsWith('.md') && previewMode"}],ref:"vditor"+n,refInFor:!0,staticClass:"content-body",style:{height:e.editorHieght+"px"}}),e._v(" "),i("MonacoEditor",{directives:[{name:"show",rawName:"v-show",value:!e.editableTabsValue.endsWith(".md")||!e.previewMode,expression:"editableTabsValue.endsWith('.md') ? !previewMode: true"}],ref:"monacoEditor"+n,refInFor:!0,attrs:{width:e.editorWidth,height:e.editorHieght,theme:e.lightTheme?"vs":"vs-dark",language:t.language,diffEditor:e.diffEditor,original:"...",options:e.options},on:{change:function(t){return e.change(t,n)},save:function(t){return e.save(t,n)}}})],1):e._e()])})),1)],1)]),e._v(" "),i("div",{staticClass:"nwse-resize",style:{left:e.dialogWidth-15+"px"}})])],1)},a=[],s=(i("28a5"),i("20d6"),i("aef6"),i("7f7f"),i("6762"),i("2fdb"),i("ac6a"),i("5df3"),i("f400"),i("3b6a"),i("5cfc")),o=i("021e"),r=i("1000"),l=i("db72"),d=(i("f559"),i("c5f6"),i("33f9"));function c(){}var u={name:"MonacoEditor",props:{diffEditor:{type:Boolean,default:!1},width:Number,height:Number,original:String,value:String,language:{type:String,default:"javascript"},theme:{type:String,default:"vs"},options:{type:Object,default:function(){return{}}},editorMounted:{type:Function,default:c},editorBeforeMount:{type:Function,default:c}},watch:{options:{deep:!0,handler:function(e){this.editor&&this.editor.updateOptions(e)}},value:function(){this.editor&&this.value!==this._getValue()&&this._setValue(this.value),this.editor.setScrollPosition({scrollTop:0,scrollLeft:0})},language:function(){if(this.editor)if(this.diffEditor){var e=this.editor.getModel(),t=e.original,i=e.modified;d["editor"].setModelLanguage(t,this.language),d["editor"].setModelLanguage(i,this.language)}else d["editor"].setModelLanguage(this.editor.getModel(),this.language)},theme:function(){this.editor&&d["editor"].setTheme(this.theme)},style:function(){var e=this;this.editor&&this.$nextTick((function(){e.editor.layout()}))}},computed:{style:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}}},mounted:function(){this.initMonaco()},beforeDestroy:function(){this.editor&&this.editor.dispose()},render:function(e){var t=this;return e("div",{class:"monaco_editor_container",style:this.style,on:{keydown:function(e){var i=navigator.platform.startsWith("Mac"),n=e.key,a=e.code,s=e.keyCode,o=e.ctrlKey,r=e.metaKey,l=i&&r||!i&&o;if(l){var d="s"===n||"KeyS"===a||83===s;d&&(t.$emit("save",t._getValue()),e.stopPropagation(),e.preventDefault())}}}})},methods:{keyDown:function(e){var t=navigator.platform.startsWith("Mac"),i=e.key,n=e.code,a=e.keyCode,s=e.ctrlKey,o=e.metaKey,r=t&&o||!t&&s;if(r){var l="s"===i||"KeyS"===n||83===a;l&&(this.$emit("save",this._getValue()),e.stopPropagation(),e.preventDefault())}},initMonaco:function(){var e=this.value,t=this.language,i=this.theme,n=this.options;Object.assign(n,this._editorBeforeMount()),this.editor=d["editor"][this.diffEditor?"createDiffEditor":"create"](this.$el,Object(l["a"])({value:e,language:t,theme:i},n)),this.diffEditor&&this._setModel(this.value,this.original),this._editorMounted(this.editor)},onKeyDown:function(e){var t=navigator.platform.startsWith("Mac"),i=e.key,n=e.code,a=e.keyCode,s=e.ctrlKey,o=e.metaKey,r=t&&o||!t&&s;if(r){var l="s"===i||"KeyS"===n||83===a;l&&this.textPreviewVisible&&(""!==this.newContent&&this.save(),e.stopPropagation(),e.preventDefault())}},_getEditor:function(){return this.editor?this.diffEditor?this.editor.modifiedEditor:this.editor:null},_setModel:function(e,t){var i=this.language,n=d["editor"].createModel(t,i),a=d["editor"].createModel(e,i);this.editor.setModel({original:n,modified:a})},_setValue:function(e){var t=this._getEditor();if(t)return t.setValue(e)},_getValue:function(){var e=this._getEditor();return e?e.getValue():""},_editorBeforeMount:function(){var e=this.editorBeforeMount(d);return e||{}},_editorMounted:function(e){var t=this;this.editorMounted(e,d),this.diffEditor?e.onDidUpdateDiff((function(e){var i=t._getValue();t._emitChange(i,e)})):e.onDidChangeModelContent((function(e){var i=t._getValue();t._emitChange(i,e)}))},_emitChange:function(e){this.$emit("change",e),this.$emit("input",e)}}},h=i("9476"),f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-contextmenu",{ref:"clickContextmenu",attrs:{theme:e.lightTheme?"default":"dark","event-type":"click"}},e._l(e.menus,(function(t){return i("v-contextmenu-item",{key:t.operation,on:{click:function(i){return e.contextmenuClick(t.operation)}}},[i("svg-icon",{attrs:{"icon-class":t.iconClass}}),e._v("\n      "+e._s(t.label)+"\n    ")],1)})),1),e._v(" "),i("v-contextmenu",{ref:"contextmenu",attrs:{theme:e.lightTheme?"default":"dark"},on:{contextmenu:e.contextmenu}},e._l(e.menus,(function(t){return i("v-contextmenu-item",{key:t.operation,on:{click:function(i){return e.contextmenuClick(t.operation)}}},[i("svg-icon",{attrs:{"icon-class":t.iconClass}}),e._v("\n      "+e._s(t.label)+"\n    ")],1)})),1),e._v(" "),i("div",{staticClass:"dir-tools",staticStyle:{"min-width":"272px"}},[i("el-button-group",[i("el-button",{class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-arrow-left"},on:{click:e.upperLeve}},[e._v("上一級")]),e._v(" "),i("el-button",{class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.refresh}},[e._v("刷新")]),e._v(" "),i("el-button",{directives:[{name:"contextmenu",rawName:"v-contextmenu:clickContextmenu",arg:"clickContextmenu"}],class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.newFileAndFolder}},[e._v("新建")]),e._v(" "),i("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[i("el-input",{attrs:{placeholder:"請輸入內容",size:"small"}},[i("el-button",{attrs:{slot:"append",size:"small",icon:"el-icon-search"},slot:"append"})],1)],1)],1)],1),e._v(" "),i("div",{style:{width:e.contentsWidth+"px",height:e.contentsHieght+"px"},attrs:{id:"dir-tree"}})],1)},m=[],p=(i("a481"),i("231f"),i("e8a0"),i("f020")),v=i.n(p),g=i("9dce"),b={name:"FancyTree",props:{contentsWidth:{type:Number,default:250},contentsHieght:{type:Number,default:500},directoryTreeData:{type:Object,default:function(){}},lightTheme:{type:Boolean,default:!0},editableTabs:{type:Array,default:function(){return[]}},editableTabsValue:{type:String,defalut:"1"}},data:function(){return{tree:{},currentPath:"/",contextData:{},rightClicking:!1,menus:[],folderMenus:[{iconClass:"open-folder",label:"進入該目錄",operation:"openFolder"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}],fileMenus:[{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}],fileMenus1:[{iconClass:"menu-addtab",label:"在新的標籤打開",operation:"openFileOfNewTab"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-remove",label:"刪除",operation:"remove"}],newFileMenus:[{iconClass:"add-file",label:"新建文件",operation:"addFile"},{iconClass:"folder-add",label:"新建目錄",operation:"addFolder"}]}},mounted:function(){this.loadTreeData(this.directoryTreeData)},watch:{directoryTreeData:function(e){this.directoryTreeData=e,this.loadTreeData(this.directoryTreeData,!0)}},computed:{},methods:{initTree:function(e){var t=this,i=this;this.tree=v.a.createTree("#dir-tree",{extensions:["edit"],icon:function(e,i){return t.icon(e,i)},source:this.convert(e),lazyLoad:function(e,i){return t.lazyLoad(e,i)},click:function(e,i){return t.click(e,i)},dblclick:function(e,i){return t.dblclick(e,i)},activate:function(e,i){return t.activate(e,i)},createNode:function(e,i){return t.createNode(e,i)},edit:{triggerStart:["f2","mac+enter"],beforeEdit:function(e,t){var n=i.editableTabs.some((function(e){return t.node.data.path===e.name&&"Modifying"===e.status}));return n&&i.$message.warning("不能對正在修改的文件重命名"),!n},edit:function(e,t){var i=t.node.span.querySelector(".fancytree-title .fancytree-edit-input"),n=i.style.width.substring(0,i.style.width.length-2);i.style.width=parseInt(n)+50+"px",i.value&&i.value.length-1>t.node.data.suffix.length&&(i.selectionStart=0,i.selectionEnd=i.value.length-1-t.node.data.suffix.length)},beforeClose:function(e,t){return"mousedown"===t.originalEvent.type?(t.originalEvent.preventDefault(),!1):!t.node.data.path||i.nameValid(t.input.val(),t.node.data,t.node)},save:function(e,t){return t.node.data.path?i.nodeRename(t.input.val(),t.node.data,t.node):i.createFile(t.input.val(),t.node.data,t.node),!0},close:function(e,t){return t.node&&i.addRef(t.node),!1}}})},addRef:function(e){this.$refs.contextmenu.addRef({el:e.span,vnode:e.span})},contextmenu:function(e){var t=this;this.rightClicking=!0;var i=this;setTimeout((function(){i.rightClicking=!1}),200),this.contextData=v.a.getNode(e).data;var n=document.createEvent("MouseEvents");if(n.initMouseEvent("click",!0,!0,window,1,12,345,7,220,!1,!1,!0,!1,0,null),e.dispatchEvent(n),this.contextData.isFolder)this.menus=this.folderMenus;else if(void 0===this.contextData.isFolder);else{this.menus=this.fileMenus;var a=this.editableTabs.some((function(e){return e.name===t.contextData.path}));!a&&r["c"].simText.includes(this.contextData.suffix)&&(this.menus=this.fileMenus1)}},contextmenuClick:function(e){var t=this.tree.getActiveNode();switch(e){case"openFolder":this.enterDir(this.contextData);break;case"remove":this.delFile(this.contextData);break;case"rename":this.tree.getActiveNode().editStart();break;case"addFile":this.editCreateNode(t,!1);break;case"addFolder":this.editCreateNode(t,!0);break;case"openFileOfNewTab":this.contextData.isAddTab=!0,this.$emit("treeNodeClick",this.contextData);break;default:break}},editCreateNode:function(e,t){null!==e&&void 0!==e?e.folder?e.editCreateNode("child",{title:"",folder:t}):e.editCreateNode("after",{title:"",folder:t}):this.tree.getRootNode().editCreateNode("child",{title:"",folder:t})},delFile:function(e){var t=this;this.$confirm("此操作將永久刪除"+e.name+"，\n 是否繼續?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].delFile({username:t.$store.state.user.name,path:encodeURI(e.path)}).then((function(){t.$emit("removeFile",e.path);var i=t.tree.getActiveNode();i.remove(),t.$message.success("刪除成功！")}))}))},upperLeve:function(){var e=this;if(0!==this.currentPath.length){var t=this.currentPath.split("/"),i=t[t.length-2],n=this.currentPath.substring(0,this.currentPath.length-i.length);s["a"].upperLevelList({username:this.$store.state.user.name,path:encodeURI(n)}).then((function(t){e.tree.reload(e.convert(t.data))}))}},refresh:function(){var e=this;s["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(this.currentPath)}).then((function(t){e.tree.reload(e.convert(t.data))}))},newFileAndFolder:function(){this.menus=this.newFileMenus},enterDir:function(e){var t=this,i=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:document.body.clientHeight/3,message:"<span>&nbsp;&nbsp;正在加載數據...</span>"});s["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(e.path)}).then((function(n){i.close(),0===n.data.length&&(t.currentPath=e.path+"/"),t.tree.reload(t.convert(n.data))})).catch((function(){i.close()}))},loadPath:function(e){e.name=e.title,this.loadTreeData(e,!0)},loadTreeData:function(e,t,i){var n=this;s["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(e.path)}).then((function(a){var s=e.name,o=a.data.map((function(e){return s===e.name&&(e.active=!0),e.key=e.path,e.title=e.name,e.folder=e.isFolder,e.lazy=e.isFolder,e}));t?n.$nextTick((function(){n.tree.reload(n.convert(o)),i&&n.$emit("treeNodeClick",i)})):n.initTree(n.convert(o))}))},createFile:function(e,t,i){var n=this,a="/";if(i.parent.folder)a=i.parent.data.path;else{var o=i.parent.children[0].data;o.path?a+=o.path.substring(0,o.path.length-o.name.length):a+=this.currentPath}s["a"].addFile({fileName:encodeURI(e),isFolder:i.folder,username:this.$store.state.user.name,parentPath:encodeURI(a)}).then((function(e){var t=i.folder?"文件夾":"文件";n.$message.success("新建".concat(t,"成功"));var a=e.data,s="/"+a.path.substring(0,a.path.length-a.name.length);n.loadTreeData({name:a.name,path:s},!0,a)})).catch((function(){i.remove()}))},nameValid:function(e,t,i){if(e){if(e===t.name)return!0;if(/[\[\]\/\\"<>\?\*]/gi.test(e))return this.$message({message:"文件名不能包含以下字符:<,>,|,*,?,,/,[,]",type:"warning"}),!1;var n=i.parent.children.findIndex((function(t){return e===t.data.name}));if(n>-1){var a="該文件已存在";return t.isFolder&&(a="該文件夾已存在"),this.$message({message:a,type:"warning"}),!1}return!0}return!1},nodeRename:function(e,t,i){var n=this;if(e){var a=e.replace(/.+\./,""),s=e.substring(0,e.length-a.length);return t.isFolder?this.rename(t,e,i):t.suffix!==a?this.$confirm("您確定要將擴展名“.".concat(t.suffix,"”更改爲“.").concat(a,"”嗎？"),"提示",{type:"warning",showClose:!1,closeOnClickModal:!1,confirmButtonText:"保持.".concat(t.suffix),cancelButtonText:"使用.".concat(a)}).then((function(){e=s+"."+t.suffix})).catch((function(){})).then((function(){n.rename(t,e,i)})):this.rename(t,e,i),!0}},rename:function(e,t,i){var n=this;e.name!==t?s["a"].renameByPath({newFileName:t,username:this.$store.state.user.name,path:encodeURI(i.data.path)}).then((function(a){a.data&&(e.oldName=i.data.name,e.name=t,e.suffix=t.replace(/.+\./,""),g["a"].$emit("renameRow",e),e.oldPath=e.path,e.path=e.path.substring(0,e.path.length-e.oldName.length)+t,i.setTitle(t),n.addRef(i),n.$message.success("修改成功！"),n.$emit("onRename",e),n.editableTabsValue===e.oldPath&&n.$emit("update:editableTabsValue",e.path))})):i.setTitle(t)},icon:function(e,t){return{html:this.loadSvg(this.findIconClass(t.node.data))}},findIconClass:function(e){if(e&&e.contentType){if(e.isFolder)return"folder";if(e.contentType.indexOf("video")>-1)return"video";if(e.contentType.startsWith("image"))return"image";if(e.contentType.indexOf("audio")>-1)return"audio";var t=e.suffix;return!t&&e.name&&(t=e.name.substring(e.name.lastIndexOf(".")+1)),r["a"].has(t)?r["a"].get(t):"file"}},loadSvg:function(e){if(e){var t=i("5d88")("./".concat(e,".svg"));return'<svg class="tree-icon">'.concat(t.default.render(),'<use xlink:href="#icon-').concat(e,'"/></svg>')}},lazyLoad:function(e,t){var i=t.node.data;t.result=this.lazyLoadData(i)},lazyLoadData:function(e){var t=this;return new Promise((function(i){s["a"].listfiles({username:t.$store.state.user.name,path:encodeURI(e.path)}).then((function(e){i(t.convert(e.data))}))}))},click:function(e,t){this.rightClicking||this.$emit("treeNodeClick",t.node.data)},dblclick:function(e,t){},activate:function(e,t){},createNode:function(e,t){"nodata"!==t.node.statusNodeType?this.addRef(t.node):t.node.span.querySelector(".fancytree-title").innerText="無數據"},convert:function(e){return e&&e.length>0&&(this.currentPath=e[0].path.substring(0,e[0].path.length-e[0].name.length)),0===this.currentPath.length&&(this.currentPath="/"),this.$emit("onLoadTreePath",this.currentPath),e.map((function(e){return e.key=e.path,e.title=e.name,e.folder=e.isFolder,e.lazy=e.isFolder,e}))}}},y=b,w=(i("f8b5"),i("2877")),x=Object(w["a"])(y,f,m,!1,null,"231ffc7c",null),T=x.exports,_=i("5a87"),C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-breadcrumb",{staticClass:"app-breadcrumb",attrs:{separator:""}},[i("transition-group",{attrs:{name:"breadcrumb"}},e._l(e.pathList,(function(t,n){return i("el-breadcrumb-item",{key:t.path},[0===n?i("a",{staticClass:"home-link",on:{click:function(i){return i.preventDefault(),e.handleLink(t,n)}}},[i("svg-icon",{staticStyle:{"font-size":"18px"},attrs:{"icon-class":"home"}})],1):e._e(),e._v(" "),i("breadcrumb-file-path",{attrs:{pathList:e.pathList,item:t,index:n},on:{clickLink:e.handleLink}})],1)})),1)],1)},k=[],S=i("7f29"),$=i("573f"),L={name:"FilePathNav",components:{BreadcrumbFilePath:$["a"]},props:{path:{type:String,default:""}},data:function(){return{pathList:[]}},watch:{path:function(e){var t=this;this.pathList=[{folder:"",path:"/"}];var i=e.split("/").filter((function(e){return e.length>0}));i.forEach((function(e,n){var a={folder:e,path:t.getPath(i,n)};t.pathList.push(a)}))}},created:function(){},methods:{strLength:function(e){return Object(S["d"])(e)},substring10:function(e){return Object(S["f"])(e)},substring:function(e,t){return Object(S["e"])(e,t)},getPath:function(e,t){var i="/";if(e&&e.length>t)for(var n=0;n<=t;n++)i+=e[n]+"/";return i},handleLink:function(e){this.$emit("loadPath",e)}}},I=L,P=(i("a207"),Object(w["a"])(I,C,k,!1,null,"c1933122",null)),D=P.exports,E=i("00a1"),M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{style:{height:e.height},attrs:{id:"vditor"}})])},N=[],F=i("6e08"),W=i.n(F),O=(i("ae60"),{name:"VidtorPreview",components:{},props:{height:{type:String,default:null},content:{type:String,default:""}},computed:{},data:function(){return{vditorPreviewShow:!1}},watch:{content:function(e){this.setContent(e)}},mounted:function(){this.content&&(this.vditorPreviewInit(this.content),this.vditorPreviewShow=!0)},methods:{setContent:function(e){this.vditorPreviewShow||(this.vditorPreviewInit(e),this.vditorPreviewShow=!0)},vditorPreviewInit:function(e){var t=this;W.a.preview(document.getElementById("vditor"),e,{speech:{enable:!0},hljs:{lineNumber:!0},after:function(){t.$emit("after")}})}}}),B=O,U=Object(w["a"])(B,M,N,!1,null,null,null),V=U.exports,z={name:"SimTextPreview",components:{Icon:E["a"],MonacoEditor:u,FileTree:h["a"],FancyTree:T,MessageDialog:_["a"],FilePathNav:D,VditorPreview:V},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},filepath:{type:String,default:void 0},status:{type:Boolean,default:function(){return!1}}},data:function(){return{lightTheme:!0,contentsHide:!1,defalutLanguage:"redis",lineWrapping:!1,moblie:!1,options:{fontSize:14,contextmenu:!0,codeLens:!0,readOnly:!0,lineNumbers:this.$pc,minimap:{enabled:this.$pc},wordWrap:this.lineWrapping?"wordWrapColumn":"",wordWrapMinified:!0,wrappingIndent:"indent"},diffEditor:!1,textPreviewVisible:!1,fullscreen:!1,dialogWidth:0,dialogWidthPercent:.7,lastTransform:void 0,contentsWidth:273,editorWidth:1035,editorHieght:640,transition:"all 500ms ease 0s",content:"",newContent:"",previewMode:!0,isShowUpdateBtn:!1,updating:!1,modifyMsg:void 0,isSaveDialogVisible:!1,isTabSaveDialogVisible:!1,removeIndex:0,loading:{},darkButton:{background:"#3e3e3e!important",border:"1px solid #3e3e3e!important",color:"#ffffff!important"},directoryTreeData:{},editableTabsValue:"1",nextActiveName:"",editableTabs:[],editableValueMap:new Map,filePathNav:"",toolbars:{readmodel:!0,navigation:!0}}},mounted:function(){var e=this;this.$nextTick((function(){e.dialogWidth=document.body.clientWidth*e.dialogWidthPercent}))},directives:{resize:{bind:function(e,t){var i="",n="";function a(){var a=document.defaultView.getComputedStyle(e);i===a.width&&n===a.height||t.value(),i=a.width,n=a.height}e.__vueSetInterval__=setInterval(a,0)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},watch:{file:function(e){var t=this;if(e.path){this.editableTabs=[],this.checkMobile(),this.checkReadOnly(e.userId),this.loadEditorSize(),this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:100,message:"<span>&nbsp;&nbsp;正在加載數據...</span>"}),r["b"].includes(e.suffix)?(this.options.wordWrap="wordWrapColumn",this.lineWrapping=!0):this.options.wordWrap="";var i="previewText";this.shareId&&(i="sharePreviewText"),this.filepath&&(i="previewTextByPath",e.path=this.filepath),e.id||(i="previewTextByPath"),s["a"][i]({shareId:this.shareId,fileId:e.id,id:e.id,path:encodeURI(e.path),username:this.$store.state.user.name}).then((function(e){t.loading.close(),t.directoryTreeData={name:e.data.name,isFolder:!0,isLeaf:!1,id:e.data.id,path:e.data.path},t.textPreviewVisible=!0,t.content=e.data.contentText;var n=e.data.path.substring(1,e.data.path.length)+e.data.name;"previewTextByPath"===i&&(n="/".concat(e.data.path,"/").concat(e.data.name)),t.editableTabs.push({title:e.data.name,copyTitle:e.data.name,language:t.getEditorLanguage(e.data.suffix),status:void 0,name:n}),t.setEditMap(0,e.data.contentText),t.editableTabsValue=n,t.$nextTick((function(){t.onDialogDblClick(),t.dargDialogSize(),t.dragControllerDiv(),t.setTheme()}))})).catch((function(){t.loading.close()}))}},status:function(e){e&&this.loading.closed&&(this.textPreviewVisible=!0)},editableTabsValue:function(e){e.endsWith(".md")&&(this.previewMode=!1)}},methods:{getEditorLanguage:function(e){var t=this.defalutLanguage,i=d["languages"].getLanguages(),n=i.findIndex((function(t){return t.extensions&&t.extensions.includes("."+e)}));return n>-1&&(t=i[n].id),t},hideContents:function(){var e=this,t=document.querySelector(".file-contents"),i=document.querySelector(".editor-resize");this.contentsHide?(t.style.left="0px",i.style.marginLeft="".concat(this.contentsWidth,"px"),setTimeout((function(){e.editorWidth-=e.contentsWidth}),250),this.contentsHide=!1,i.setAttribute("icon-style","show")):(t.style.left="-".concat(this.contentsWidth,"px"),i.style.marginLeft="0px",setTimeout((function(){e.editorWidth+=e.contentsWidth}),250),this.contentsHide=!0,i.setAttribute("icon-style","hide"))},onDialogDblClick:function(){var e=document.querySelector(".simtext-dialog .el-dialog__header"),t=this;e.ondblclick=function(e){e.target&&"simtext-header-title"===e.target.className&&t.fullScreen()}},dargDialogSize:function(){var e=document.querySelector(".el-dialog__body .nwse-resize");if(e){var t=this;e.onmousedown=function(i){var n=i.clientX,a=i.clientY,s=t.editorWidth,o=t.editorHieght,r=t.dialogWidth;return document.onmousemove=function(e){var i=e.clientX,l=e.clientY,d=i-n;r+d>600&&(t.dialogWidth=r+d,t.editorWidth=s+d,t.editorHieght=o+(l-a),t.loadConterSize())},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,e.releaseCapture&&resize.releaseCapture()},e.setCapture&&e.setCapture(),!1}}},dragControllerDiv:function(){var e=document.querySelector(".el-dialog__body .content"),t=document.querySelector(".el-dialog__body .content .editor-resize"),i=document.querySelector(".file-contents"),n=document.querySelector(".file-contents .dir-tools");if(t){var a=this;t.onmousedown=function(s){if(a.contentsHide)return!1;var o=s.clientX,r=i.offsetWidth,l=e.clientWidth,d=.6*l>273?.6*l:600;return document.onmousemove=function(e){a.transition="none 500ms ease 0s";var t=e.clientX,i=t-o;if(r+i>n.style.minWidth.split("px")[0]){var s=r+i;s<d&&(a.contentsWidth=s,a.editorWidth=a.dialogWidth-(r+i))}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.releaseCapture&&t.releaseCapture(),a.transition="all 500ms ease 0s"},t.setCapture&&t.setCapture(),!1}}},findSvgClass:function(e){var t=e.substring(e.lastIndexOf(".")+1);return r["a"].has(t)?r["a"].get(t):"file"},loadPath:function(e){this.$refs.fancTree.loadPath(e)},onRename:function(e){this.editableTabs.map((function(t){return t.name===e.oldPath&&(t.title=e.name,t.copyTitle=e.name,t.name=e.path),t})),this.editableTabsValue=e.path},onLoadTreePath:function(e){this.filePathNav=e},removeFile:function(e){var t=this.editableTabs.findIndex((function(t){return t.name===e}));t>-1&&this.editableTabs.splice(t,1)},treeNodeClick:function(e){var t=this;if(!e.isFolder&&r["c"].simText.includes(e.suffix)){var i=d["languages"].getLanguages(),n=i.findIndex((function(t){return t.extensions&&t.extensions.includes("."+e.suffix)}));this.language=n>-1?i[n].id:this.defalutLanguage,r["b"].includes(e.suffix)?(this.options.wordWrap="wordWrapColumn",this.lineWrapping=!0):this.options.wordWrap="",this.editableTabs.findIndex((function(t){return t.name===e.path}))<0?(this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:document.body.clientHeight/3,message:"<span>&nbsp;&nbsp;正在加載數據...</span>"}),s["a"].previewTextByPath({path:encodeURI(e.path),username:this.$store.state.user.name}).then((function(i){t.loading.close();var n={title:e.name,copyTitle:e.name,status:void 0,language:t.getEditorLanguage(e.suffix),name:e.path};if(e.isAddTab)t.editableTabs.push(n),t.setEditMap(t.editableTabs.length-1,i.data.contentText);else{var a=t.editableTabs.findIndex((function(e){return void 0===e.status}));a>-1?(t.editableTabs[a]=n,t.setEditMap(a,i.data.contentText)):(t.editableTabs.push(n),t.setEditMap(t.editableTabs.length-1,i.data.contentText))}t.editableTabsValue=e.path})).catch((function(){t.loading.close()}))):(this.editableTabsValue=e.path,this.clickTab())}},setEditMap:function(e,t){var i=this;this.editableValueMap.set(e,t),this.$nextTick((function(){var n="monacoEditor"+e;i.$refs[n][0]._setValue(t),!i.$pc&&i.dialogWidthPercent<1&&i.fullScreen()}))},containerResize:function(){this.loadEditorSize()},checkMobile:function(){this.$pc?this.moblie=!1:this.moblie=!0},checkReadOnly:function(e){var t=this;this.$store.state.user.token&&this.$store.state.user.userId===e&&(this.options.readOnly=!1),this.$pc||(this.options.readOnly=!0),(this.options.readOnly||this.moblie)&&this.$nextTick((function(){t.editorWidth+=t.contentsWidth,t.contentsHide=!0}))},loadEditorSize:function(){this.dialogWidth=document.body.clientWidth*this.dialogWidthPercent,this.contentsHide?this.editorWidth=this.dialogWidth:this.editorWidth=this.dialogWidth-this.contentsWidth,this.editorHieght=document.body.clientHeight*this.dialogWidthPercent-76,this.loadConterSize()},loadConterSize:function(){var e=document.querySelector(".editor-resize .editor-resize-conter");e&&(e.style.marginTop=(this.editorHieght+26)/2-e.clientHeight/2+"px")},handleClose:function(e){this.isShowUpdateBtn?this.isSaveDialogVisible=!0:(e(),this.closeAllTabs())},saveTabAndClose:function(){this.update(this.editableTabs[this.removeIndex].change,this.editableTabs[this.removeIndex].name),this.isTabSaveDialogVisible=!1,this.editableTabs.splice(this.removeIndex,1)},confirmUpdate:function(){this.saveAll(!0),this.textPreviewVisible=!1,this.$emit("update:status",this.textPreviewVisible),this.isSaveDialogVisible=!1,this.isShowUpdateBtn=!1},closeTabDialog:function(){this.isTabSaveDialogVisible=!1,this.editableTabsValue=this.nextActiveName,this.editableTabs.splice(this.removeIndex,1);var e=this.editableTabs.findIndex((function(e){return"Modifying"===e.status}));e<0&&(this.isShowUpdateBtn=!1)},closeDialog:function(){this.textPreviewVisible=!1,this.$emit("update:status",this.textPreviewVisible),this.isSaveDialogVisible=!1,this.isShowUpdateBtn=!1,this.closeAllTabs()},change:function(e,t){e===this.editableValueMap.get(t)?this.editableTabs[t].copyTitle!==this.editableTabs[t].title&&(this.editableTabs[t].title=this.editableTabs[t].copyTitle,this.editableTabs[t].status="Modified",this.editableTabs.findIndex((function(e){return e.title!==e.copyTitle}))<0&&(this.isShowUpdateBtn=!1)):this.editableTabs[t].copyTitle===this.editableTabs[t].title&&(this.editableTabs[t].title+="*",this.editableTabs[t].status="Modifying",this.isShowUpdateBtn=!0,this.editableTabs[t].change=e)},saveAll:function(e){var t=this;this.editableTabs.forEach((function(i,n){"Modifying"===i.status&&(e?t.update(i.change,i.name):t.update(i.change,i.name,n))})),e&&this.closeAllTabs()},closeAllTabs:function(){this.editableTabs.splice(0,this.editableTabs.length),this.$emit("update:file",{})},save:function(e,t){e!==this.editableTabs[t].content&&this.isShowUpdateBtn&&this.update(e,this.editableTabs[t].name,t)},update:function(e,t,i){var n=this;this.updating=!0,o["a"].editMarkdownByPath({relativePath:encodeURI(t),userId:this.$store.state.user.userId,username:this.$store.state.user.name,contentText:e}).then((function(){if(n.updating=!1,void 0!==i)n.editableTabs[i].content=e,n.editableTabs[i].copyTitle!==n.editableTabs[i].title&&(n.editableTabs[i].title=n.editableTabs[i].copyTitle,n.editableTabs[i].status="Modified",n.editableTabs.findIndex((function(e){return e.title!==e.copyTitle}))<0&&(n.isShowUpdateBtn=!1));else{var t=!1;n.editableTabs.forEach((function(e){"Modifying"===e.status&&(t=!0)})),t||(n.isShowUpdateBtn=!1)}if(!n.modifyMsg){n.modifyMsg=n.$message({message:"更新成功",type:"success",duration:1e3});var a=n;setTimeout((function(){a.modifyMsg=void 0}),1e3)}})).catch((function(){n.updating=!1}))},fullScreen:function(){this.fullscreen=!this.fullscreen;var e=document.querySelector(".simtext-dialog .el-dialog");if(this.fullscreen)this.lastTransform=e.style.transform,this.dialogWidthPercent=1,this.dialogWidth=document.body.clientWidth*this.dialogWidthPercent,e.style.transform="translate(0px,0px)";else{this.dialogWidthPercent=.7,this.dialogWidth=document.body.clientWidth*this.dialogWidthPercent;var t=(document.body.clientWidth-this.dialogWidth)/2,i=(document.body.clientHeight-this.dialogWidth)/2;this.lastTransform?e.style.transform=this.lastTransform:e.style.transform="translate("+t+"px,"+i+"px)"}this.containerResize()},skinning:function(){this.transition="none 500ms ease 0s",this.lightTheme=!this.lightTheme,this.setTheme();var e=this;setTimeout((function(){e.transition="all 500ms ease 0s"}),100)},setTheme:function(){var e=document.querySelector(".simtext-dialog .el-dialog"),t=document.querySelector(".simtext-dialog .el-dialog .el-dialog__header"),i=document.querySelector(".content");this.lightTheme?(t.style.background="#e6e6e6",t.style.color="#181818",i&&i.setAttribute("data-theme","light"),e&&(e.style.background="#fff"),t&&t.setAttribute("data-theme","light")):(t.style.background="#2e2e30",t.style.color="#fff",e&&(e.style.background="#181818"),i&&i.setAttribute("data-theme","dark"),t&&t.setAttribute("data-theme","dark"))},changePreviewMode:function(){var e=this,t=this.editableTabs.findIndex((function(t){return t.name===e.editableTabsValue}));if(t>-1){var i="vditor"+t;this.$refs[i][0].setContent(this.editableValueMap.get(t))}this.previewMode=!this.previewMode,this.clickTab()},clickTab:function(){this.editorWidth+=.001,this.editorHieght+=.001},removeTab:function(e){var t=this.editableTabs,i=this.editableTabsValue,n=0;i===e&&t.forEach((function(a,s){if(a.name===e){n=s;var o=t[s+1]||t[s-1];o&&(i=o.name)}})),this.nextActiveName=i,"Modifying"!==this.editableTabs[n].status?(this.editableTabsValue=i,this.editableTabs=t.filter((function(t){return t.name!==e}))):(this.removeIndex=n,this.isTabSaveDialogVisible=!0)}}},R=z,A=(i("ce72"),i("8416"),Object(w["a"])(R,n,a,!1,null,"148493b8",null));t["a"]=A.exports},"34eb":function(e,t,i){},"3c51":function(e,t,i){},"3e53":function(e,t,i){},"407b":function(e,t,i){"use strict";i("7ccc")},"4fdd":function(e,t,i){"use strict";i("562c")},5312:function(e,t,i){},"562c":function(e,t,i){},"573f":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[e.strLength(e.item.folder)>e.maxNameLength?i("a",[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.item.folder,placement:"top"}},[e.pathList.length>=e.maxPathCount?i("a",[e.index===e.pathList.length-e.maxPathCount-1?i("span",{staticClass:"redirect"},[e._v(" ")]):e._e(),e._v(" "),e.index===e.pathList.length-e.maxPathCount-1?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v("..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?i("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.pathList.length<e.maxPathCount?i("a",[e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?i("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.index===e.pathList.length-1?i("a",[e.strLength(e.item.folder)<=20?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>20&&e.strLength(e.item.folder)<=e.maxNameLengthOfLast&&e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLengthOfLast&&e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"...")]):e._e(),e._v(" "),e.strLength(e.item.folder)>20&&!e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,20))+"...")]):e._e()]):e._e()])],1):e._e(),e._v(" "),e.strLength(e.item.folder)<=e.maxNameLength?i("a",[e.pathList.length>=e.maxPathCount?i("a",[e.index===e.pathList.length-e.maxPathCount-1?i("span",{staticClass:"redirect"},[e._v(" ")]):e._e(),e._v(" "),e.index===e.pathList.length-e.maxPathCount-1?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v("..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?i("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.pathList.length<e.maxPathCount?i("a",[e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?i("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?i("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"..."),i("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.index===e.pathList.length-1?i("a",[e.strLength(e.item.folder)<=e.maxNameLength?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLength&&e.strLength(e.item.folder)<=e.maxNameLengthOfLast&&e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLengthOfLast&&e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"...")]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLength&&!e.item.searchKey?i("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"...")]):e._e()]):e._e()]):e._e()])},a=[],s=(i("c5f6"),i("7f29")),o={name:"BreadcrumbFilePath",props:{pathList:{type:Array,default:function(){return[]}},maxNameLength:{type:Number,default:10},maxPathCount:{type:Number,default:7},maxNameLengthOfLast:{type:Number,default:50},index:{type:Number,default:0},item:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{strLength:function(e){return Object(s["d"])(e)},substring:function(e,t){return Object(s["e"])(e,t)},handleLink:function(e,t){this.$emit("clickLink",e,t)}}},r=o,l=(i("5b85"),i("2877")),d=Object(l["a"])(r,n,a,!1,null,"bad8d760",null);t["a"]=d.exports},"5a87":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"jmal-message-dialog",attrs:{title:e.title,visible:e.visible,modal:e.modal,top:"0vh","close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},close:e.closeDialog}},[e.loading?e._e():i("svg-icon",{attrs:{"icon-class":"warring"}}),e._v(" "),i("span",{staticClass:"dialog-msg"},[e._v(e._s(e.content))]),e._v(" "),e.loading?e._e():i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:e.buttonSize},on:{click:e.operating}},[e._v(e._s(e.operatButtonText))]),e._v(" "),i("el-button",{attrs:{size:e.buttonSize,type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],1)],1)],1)},a=[],s={name:"MessageDialog",props:{title:{type:String,default:""},modal:{type:Boolean,default:function(){return!0}},show:{type:Boolean,default:function(){return!1}},loading:{type:Boolean,default:function(){return!1}},content:{type:String,default:""},buttonSize:{type:String,default:"small"},operatButtonText:{type:String,default:""},cancelButtonText:{type:String,default:"取 消"},confirmButtonText:{type:String,default:"確 定"}},data:function(){return{visible:!1}},watch:{show:function(e){this.visible=e}},methods:{closeDialog:function(){this.$emit("update:show",this.visible)},operating:function(){this.$emit("operating")},cancel:function(){this.visible=!1,this.$emit("update:show",this.visible),this.$emit("cancel")},confirm:function(){this.$emit("confirm")}}},o=s,r=(i("1fa4"),i("2877")),l=Object(r["a"])(o,n,a,!1,null,"3e069b1d",null);t["a"]=l.exports},"5b85":function(e,t,i){"use strict";i("17a8")},"7ccc":function(e,t,i){},"80a9":function(e,t,i){"use strict";i("3c51")},8416:function(e,t,i){"use strict";i("34eb")},9476:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-tree",{ref:"fileTree",attrs:{data:e.directoryTreeData,"node-key":e.localFileMode?"path":"id",props:e.directoryTreeProps,load:e.localFileMode?e.loadOfLocalFileMode:e.directoryTreeLoadNode,"highlight-current":!0,"default-expanded-keys":e.defaultExpandedKeys,"render-content":e.renderContent,hight:"100",lazy:""},on:{"node-click":e.treeNodeClick,"node-expand":e.treeNodeExpand}})],1)},a=[],s=(i("7f7f"),i("ac6a"),i("5cfc")),o=i("0dcf"),r=i("2d53"),l=i("1000"),d={name:"FileTree",components:{IconFile:o["a"],SimTextPreview:r["a"]},props:{directoryTreeData:{type:Array,default:function(){return[]}},localFileMode:{type:Boolean,default:!0},tempDir:{type:Boolean,default:!1}},data:function(){return{directoryTreeProps:{label:"name",children:"children",isLeaf:"isLeaf"}}},computed:{defaultExpandedKeys:function(){if(this.localFileMode){var e=[];return this.directoryTreeData.forEach((function(t){t.isLeaf||e.length<1&&e.push(t.path)})),e}return["0"]}},methods:{loadOfLocalFileMode:function(e,t){if(0===e.level)return t(this.directoryTreeData);e.level>0&&s["a"].listfiles({username:this.$store.state.user.name,path:encodeURI(e.data.path),tempDir:this.tempDir}).then((function(e){var i=e.data.map((function(e){return e.isLeaf=!e.isFolder,e}));return t(i)}))},directoryTreeLoadNode:function(e,t){var i=null;if(0===e.level){var n=[{id:"0",name:"全部文件"}],a=this;return setTimeout((function(){a.$refs.fileTree.setCurrentKey("0"),a.$emit("treeNodeClick",n[0])}),0),t(n)}e.level>1&&(i=e.data.id),s["a"].queryFileTree({userId:this.$store.state.user.userId,username:this.$store.state.user.name,fileId:i}).then((function(e){var i=e.data;return t(i)}))},treeNodeClick:function(e){this.$emit("treeNodeClick",e)},treeNodeExpand:function(e,t,i){},renderContent:function(e,t){var i=this,n=t.node,a=t.data;t.store;if(a.newFolder)return e("span",{class:"custom-tree-node"},[e("span",[e("svg-icon",{attrs:{"icon-class":"folder"}})]),e("span",[e("div",{class:"el-input el-input--mini el-input-tree"},[e("input",{attrs:{type:"text",autocomplete:"on",value:"新建文件夾",id:"treeInput"},class:"el-input__inner"})]),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){var e="/",t=n.parent.data;t.path&&(e=t.path+t.name+e),s["a"].newFolder({isFolder:!0,filename:encodeURI(a.name),currentDirectory:encodeURI(e),username:i.$store.state.user.name,userId:i.$store.state.user.userId}).then((function(e){a.newFolder=!1,a.id=e.data.id})).catch((function(){window.event.preventDefault(),window.event.stopPropagation()}))}},class:"el-button el-icon-check el-button--mini el-input-tree-button"}),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){i.$refs.fileTree.remove(n),window.event.preventDefault(),window.event.stopPropagation()}},class:"el-button el-icon-close el-button--mini el-input-tree-button"})])]);if(n.expanded)return e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"open-folder"}}),e("span",{style:"margin-left: 5px;"},[n.label]),e("span")]);var o=this.findIconClass(n.data);return this.localFileMode||"0"!==n.data.id||(o="folder"),e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":o}}),e("span",{style:"margin-left: 5px;"},[n.label]),e("span")])},findIconClass:function(e){if(e.isFolder)return"folder";var t=e.suffix;return!t&&e.name&&(t=e.name.substring(e.name.lastIndexOf(".")+1)),l["a"].has(t)?l["a"].get(t):"file"}}},c=d,u=i("2877"),h=Object(u["a"])(c,n,a,!1,null,"04cf5abf",null);t["a"]=h.exports},"9a09":function(e,t,i){"use strict";i("3e53")},a207:function(e,t,i){"use strict";i("e0df")},ae1f:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.show?i("div",{staticClass:"preview"},[i("van-overlay",{attrs:{show:e.show}},[i("div",{staticClass:"wrapper"},[i("div",{staticClass:"block",on:{mousemove:e.onmousemove,mouseout:e.onmouseout,mouseenter:e.onmouseenter,mouseleave:e.onmouseleave,touchstart:e.onmouseenter,touchend:e.onmousemove}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.closeBarShow,expression:"closeBarShow"}],staticClass:"close-bar",on:{click:e.close}},[i("svg-icon",{staticClass:"audio-player-close",attrs:{"icon-class":"close"}})],1),e._v(" "),i("video-player",{ref:"videoPlayer",staticClass:"video-player vjs-custom-skin",attrs:{playsinline:!0,options:e.playerOptions},on:{playing:e.onPlayerPlaying,ended:e.onPlayerEnded,pause:e.onPlayerPause}})],1)])])],1):e._e()},a=[],s=(i("6b54"),i("7f7f"),i("451f"),i("fda2"),i("d6d3")),o=i("2690"),r={name:"VideoPreview",components:{videoPlayer:s["videoPlayer"]},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},status:{type:Boolean,default:!1}},computed:{},data:function(){return{closeBarShow:!1,pc:this.$pc,playerOptions:{playbackRates:[.5,1,1.5,2],autoplay:!0,muted:!1,loop:!1,preload:"auto",language:"zh-CN",aspectRatio:"16:9",fluid:!0,sources:[],poster:"",notSupportedMessage:"此視頻暫無法播放，請稍後再試",controlBar:{timeDivider:!0,durationDisplay:!0,remainingTimeDisplay:!0,fullscreenToggle:!0}},show:this.status,url:"",timeout:null,playing:!1}},watch:{status:function(e){if(e){var t=o["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token);this.shareId&&(t=o["a"].publicPreviewUrl(this.file.id,window.shareId)),this.playerOptions.sources=[{type:this.file.contentType,src:t}],this.show=!0}}},methods:{close:function(){this.show=!1,this.$emit("update:status",!1)},onPlayerPlaying:function(){this.playing=!0,this.clearTimeout(),this.timeout=setTimeout(this.timeoutFun,2500)},onPlayerPause:function(){this.closeBarShow=!0,this.playing=!1},onPlayerEnded:function(){this.closeBarShow=!0,this.playing=!1},onmousemove:function(){this.closeBarShow||(this.closeBarShow=!0),this.clearTimeout(),this.timeout=setTimeout(this.timeoutFun,2500)},onmouseout:function(){},onmouseleave:function(){this.closeBarShow=!1,this.clearTimeout()},clearTimeout:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!=this.timeout&&(clearTimeout(this.timeout),this.timeout=null)})),timeoutFun:function(){if(this.playing){if(!this.$pc){var e=document.querySelector(".block .close-bar");e&&(e.style.display="none")}this.closeBarShow=!1}this.clearTimeout()},onmouseenter:function(){this.closeBarShow=!0},ontouchstart:function(){this.closeBarShow=!0},ontouchsend:function(){this.closeBarShow=!1,this.clearTimeout()}}},l=r,d=(i("80a9"),i("2877")),c=Object(d["a"])(l,n,a,!1,null,"c05d296a",null);t["a"]=c.exports},c466:function(e,t,i){"use strict";i("ecdd")},ce72:function(e,t,i){"use strict";i("1123")},d298:function(e,t,i){},e0df:function(e,t,i){},ecdd:function(e,t,i){},f8b5:function(e,t,i){"use strict";i("1a01")},fd35:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("message-dialog",{attrs:{title:"確認信息",content:"是否在關閉前保存修改？",show:e.isSaveDialogVisible,operatButtonText:"放棄修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isSaveDialogVisible=t},operating:e.closeDialog,confirm:e.saveAndClose}}),e._v(" "),e.show?i("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.readyShow,expression:"!readyShow"}],staticClass:"office-preview"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.readyShow,expression:"readyShow"}],staticClass:"preview-block"},[i("div",{staticClass:"close-bar",on:{click:e.beforeClose}},[i("svg-icon",{staticClass:"preview-close",attrs:{"icon-class":"close"}})],1),e._v(" "),i("div",{staticClass:"wrapper"},["pdf"===e.fileType?i("pdf-preview",{attrs:{file:e.file,shareId:e.shareId,"file-url":e.fileUrl},on:{onReady:e.onReady}}):"drawio"===e.fileType?i("drawio",{directives:[{name:"show",rawName:"v-show",value:e.fileReday,expression:"fileReday"}],attrs:{file:e.file,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,onReady:e.onReady,onClose:e.close}}):"mind"===e.fileType?i("my-mind-editor",{attrs:{file:e.file,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,onReady:e.onReady,onClose:e.close}}):i("only-office-editor",{ref:"officeEditor",attrs:{file:e.file,"file-url":e.fileUrl,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,manualSave:e.manualSave,onClose:e.close,onReady:e.onReady}})],1)])]):e._e()],1)},a=[],s=(i("7f7f"),i("6762"),i("2fdb"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("di",[i("div",{staticClass:"component-only-office"},[i("div",{staticClass:"placeholder",attrs:{id:this.id}})])])}),o=[],r=i("5cfc"),l=i("2690"),d=i("9dce"),c={name:"OnlyOfficeEditor",props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},fileUrl:{type:String,default:""},code:{type:String,default:""},shareId:{type:String,default:""},file:{type:Object,default:function(){return{}}},readOnly:{type:Boolean,default:!1},documentKey:Function},data:function(){return{docEditor:null,saved:!0}},beforeDestroy:function(){null!==this.docEditor&&(this.docEditor.destroyEditor(),this.docEditor=null)},computed:{fileType:function(){return this.getType(this.file.suffix)}},watch:{"file.id":{handler:function(e){var t=this;if(e){var i=l["a"].officeApiUrl();$J.loadScript($J.apiUrl(i),(function(e){if(null!==e)return t.$emit("onClose"),void d["a"].$emit("loadFileFaild");t.$store.state.user.token&&t.$store.state.user.userId===t.file.userId?r["a"].getFileInfoById(t.file.id).then((function(e){t.file=e.data,t.loadFile()})):r["a"].getPublicFileInfoById(t.file.id,t.shareId).then((function(e){t.file=e.data,t.loadFile()}))}))}},immediate:!0}},mounted:function(){var e=this;d["a"].$on("previewSaveAndClose",(function(){e.requestClose()}))},destroyed:function(){d["a"].$off("previewSaveAndClose")},methods:{getType:function(e){switch(e){case"doc":return"docx";case"word":return"docx";case"excel":return"xlsx";case"xls":return"xlsx";case"ppt":return"pptx"}return e},loadFile:function(){var e=this;null!==this.docEditor&&(this.docEditor.destroyEditor(),this.docEditor=null),this.fileUrl=window.location.origin+l["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token),this.readOnly&&window.shareId&&(this.fileUrl=window.location.origin+l["a"].publicPreviewUrl(this.file.id,window.shareId));var t="".concat(new Date(this.file.updateDate).getTime(),"-").concat(this.file.id),i=l["a"].officeCallBackUrl(this.$store.getters.token,this.file.id),n={document:{fileType:this.fileType,key:t,title:this.file.name,url:this.fileUrl},editorConfig:{mode:"edit",lang:"zh",user:{id:this.$store.state.user.userId,name:this.$store.state.user.name},customization:{logo:null,autosave:!1,comments:!0,compactHeader:!1,compactToolbar:!1,compatibleFeatures:!1,forcesave:!1,help:!1,hideRightMenu:!1,hideRulers:!1,submitForm:!1,about:null,feedback:!1},callbackUrl:i}};if(this.$pc||(n.type="mobile"),this.readOnly&&(n.editorConfig.mode="view",n.editorConfig.callbackUrl=null,!n.editorConfig.user.id)){var a=$J.getStorageInt("visitor");a||(a=$J.randNum(1e3,99999),$J.setStorage("viewer",a)),n.editorConfig.user.id="visitor_"+a,n.editorConfig.user.name="Visitor_"+a}n.events={onAppReady:this.onAppReady,onDocumentReady:this.onDocumentReady,onDocumentStateChange:this.onDocumentStateChange},this.$nextTick((function(){e.docEditor=new DocsAPI.DocEditor(e.id,n)}))},onAppReady:function(){this.$emit("onReady"),console.log("onAppReady")},onDocumentReady:function(){console.log("onDocumentReady");var e=document.querySelector(".component-only-office"),t=e.getElementsByTagName("iframe")[0].contentWindow.document;if(!this.$pc){e.style.top="5rem",t.querySelector(".navbar.main-navbar.navbar-with-logo").style.height="0";var i=t.getElementById("editor-navbar");console.log(i)}var n=t.querySelector(".extra .logo");n.style.display="none";var a=t.getElementById("left-btn-about");a.style.display="none",this.saveBtnDoc=t.getElementById("slot-btn-dt-save").getElementsByTagName("button")[0]},onDocumentStateChange:function(){this.saved=this.saveBtnDoc.classList.contains("disabled"),this.$emit("onEdit",this.saved)},requestClose:function(){this.$emit("manualSave")}}},u=c,h=i("2877"),f=Object(h["a"])(u,s,o,!1,null,"00bd100e",null),m=f.exports,p=i("5a87"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"pdf-office"},[i("iframe",{ref:"pdfIframe",attrs:{name:"PDF Preview",title:e.file.name,src:e.fileUrl}})])])},g=[],b={name:"PdfPreview",props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},fileUrl:{type:String,default:""},file:{type:Object,default:function(){return{}}}},data:function(){return{}},mounted:function(){this.iframeLoad()},methods:{iframeLoad:function(){var e=this.$refs.pdfIframe,t=this;e.attachEvent?e.attachEvent("onload",(function(){t.$emit("onReady")})):e.onload=function(){t.$emit("onReady")}}}},y=b,w=(i("407b"),Object(h["a"])(y,v,g,!1,null,"42b31d40",null)),x=w.exports,T=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"drawio-content",style:{top:e.readOnly?"0":"2.5rem"}},[i("div",{staticClass:"drawio-title"},[i("div",{staticClass:"drawio-title-name",style:{color:e.saved?"":"#ff8200"}},[e._v(e._s(e.title))]),e._v(" "),i("div",{staticClass:"drawio-save"},[e.saved?e._e():i("el-button",{attrs:{size:"mini",loading:e.saveBtnUpdating},on:{click:e.save}},[e._v("保存")])],1)]),e._v(" "),i("iframe",{ref:"myFlow",staticClass:"drawio-iframe",attrs:{src:e.url,title:e.file.name}})])},_=[],C=i("021e"),k={name:"Drawio",props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:""},readOnly:{type:Boolean,default:!1}},data:function(){return{url:null,bakData:"",xml:"",saveBtnUpdating:!1,title:this.file.name,saved:!0,reday:!1}},created:function(){var e="zh",t=this.readOnly?1:0,i=this.readOnly?0:1,n="kennedy",a=this.file.name?encodeURIComponent(this.file.name):"",s="?title=".concat(a,"&chrome=").concat(i,"&lightbox=").concat(t,"&ui=").concat(n,"&lang=").concat(e,"&offline=1&pwa=0&embed=1&noLangIcon=1&noExitBtn=1&noSaveBtn=1&saveAndExit=0&spin=1&proto=json");this.url=$J.apiUrl("../drawio/webapp/".concat(s))},mounted:function(){d["a"].$on("previewSaveAndClose",this.saveAndClose),window.addEventListener("message",this.handleMessage)},beforeDestroy:function(){window.removeEventListener("message",this.handleMessage)},destroyed:function(){d["a"].$off("previewSaveAndClose")},watch:{"file.id":{handler:function(e){var t=this;if(e){this.xml="";var i="previewText";this.readOnly&&(i="sharePreviewText"),r["a"][i]({shareId:this.shareId,fileId:this.file.id,id:this.file.id,path:encodeURI(this.file.path),username:this.$store.state.user.name}).then((function(e){t.file.path=e.data.path,t.xml=e.data.contentText,t.bakData!==e.data.contentText&&(t.bakData=e.data.contentText,t.updateContent())}))}},immediate:!0,deep:!0}},methods:{saveAndClose:function(){this.save(),this.$emit("onClose")},updateContent:function(){this.$refs.myFlow.contentWindow.postMessage(JSON.stringify({action:"load",autosave:1,xml:this.bakData}),"*")},save:function(){this.saved||this.update(this.xml)},update:function(e){var t=this;this.saveBtnUpdating=!0,C["a"].editMarkdownByPath({relativePath:encodeURI(this.file.path+this.file.name),userId:this.$store.state.user.userId,username:this.$store.state.user.name,contentText:e}).then((function(){t.saveBtnUpdating=!1,t.saved=!0,t.title=t.file.name,t.$emit("onEdit",t.saved)})).catch((function(){t.saveBtnUpdating=!1}))},handleMessage:function(e){var t=this.$refs.myFlow.contentWindow;if(e.source===t){var i=$J.jsonParse(e.data);switch(i.event){case"init":this.reday=!0,this.$emit("onReady"),this.updateContent();var n=this.$refs.myFlow.contentWindow.document,a=n.querySelector(".geMenubarContainer .geMenubar").childNodes[5];a.style.display="none";break;case"load":this.xml.length<1&&t.postMessage(JSON.stringify({action:"template"}),"*");break;case"autosave":this.bakData=i.xml,this.xml=i.xml,this.saved=!1,this.title="*".concat(this.file.name),this.$emit("onEdit",this.saved);break;case"save":this.save();break}}}}},S=k,$=(i("c466"),Object(h["a"])(S,T,_,!1,null,"4899f89e",null)),L=$.exports,I=i("2723"),P={name:"OfficePreview",components:{Drawio:L,PdfPreview:x,MessageDialog:p["a"],OnlyOfficeEditor:m,MyMindEditor:I["a"]},props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},status:{type:Boolean,default:!1}},data:function(){return{fileUrl:"",pc:this.$pc,show:this.status,readyShow:!1,readOnly:!0,isSaveDialogVisible:!1,saved:!0,previewDocument:{},delayClosing:{},fileReday:!1}},computed:{fileType:function(){return this.getType(this.file.suffix)}},mounted:function(){document.addEventListener("keyup",this.escape)},destroyed:function(){document.removeEventListener("keyup",this.escape)},watch:{status:function(e){var t=this;if(e){this.show=!0,this.$nextTick((function(){t.previewDocument=document.querySelector(".preview-block")})),this.checkReadOnly(this.file.userId);var i=this;this.delayClosing=setTimeout((function(){i.readyShow||i.loadFileFaild()}),6e3)}}},methods:{escape:function(e){"Escape"===e.code&&this.beforeClose()},getType:function(e){switch(e){case"drawio":return"drawio";case"pdf":return"pdf";case"mind":return"mind";default:return"office"}},loadFileFaild:function(){this.close(),d["a"].$emit("loadFileFaild"),this.readyShow=!0},beforeClose:function(){this.saved?this.close():this.isSaveDialogVisible=!0},close:function(){clearTimeout(this.delayClosing),this.show=!1,this.readyShow=!1,this.$emit("update:status",!1)},onReady:function(){var e=this;this.saved=!0,this.readyShow=!0,this.fileReday=!0,["drawio","office"].includes(this.fileType)&&(this.previewDocument.style.zIndex=9999,this.$nextTick((function(){var t=e;setTimeout((function(){t.previewDocument.style.zIndex=2001}),200)})))},onEdit:function(e){this.saved=e,e?window.addEventListener("onbeforeunload",this.onbeforeunload):window.removeEventListener("onbeforeunload",this.onbeforeunload)},onbeforeunload:function(e){e.returnValue="文件未保存, 確定退出嗎?"},closeDialog:function(){this.isSaveDialogVisible=!1,this.close()},saveAndClose:function(){d["a"].$emit("previewSaveAndClose"),this.isSaveDialogVisible=!1},manualSave:function(){this.$message.info("請手動保存")},checkReadOnly:function(e){this.$store.state.user.token&&this.$store.state.user.userId===e&&(this.readOnly=!1),this.$pc||"office"!==this.fileType||(this.readOnly=!0,this.$nextTick((function(){var e=document.querySelector(".office-preview .close-bar");e.style.right="2.5rem",e.style.float="left",e.style.transform="rotate(225deg)"}))),this.fileUrl=window.location.origin+l["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token),this.readOnly&&window.shareId&&(this.fileUrl=window.location.origin+l["a"].publicPreviewUrl(this.file.id,window.shareId))}}},D=P,E=(i("9a09"),Object(h["a"])(D,n,a,!1,null,"15ad279d",null));t["a"]=E.exports}}]);